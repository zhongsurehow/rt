<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æœºå˜ - å®Œæ•´å››äººå¯¹æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            min-height: 100vh;
            overflow-x: auto;
            color: #333;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 80px auto auto auto auto;
            grid-template-areas: 
                "header"
                "player-info"
                "game-area"
                "right-panel"
                "bottom-panel";
            min-height: 100vh;
            gap: 20px;
            padding: 15px;
            max-width: 100vw;
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ */
        .header {
            grid-area: header;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .game-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .game-status {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .status-value {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }

        /* ç©å®¶ä¿¡æ¯åŒºåŸŸ */
        .player-info-area {
            grid-area: player-info;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            min-height: 400px;
        }

        .player-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .player-info {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 18px;
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            margin-bottom: 8px;
        }

        .player-info.active {
            border-left-color: #e74c3c;
            box-shadow: 0 6px 25px rgba(231,76,60,0.3);
            transform: translateX(5px);
        }

        .player-name {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
        }

        .stat-item {
            background: rgba(52,152,219,0.1);
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            grid-area: game-area;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            min-height: 600px;
        }

        /* å…«å¦åœ°å›¾ */
        .bagua-map {
            width: min(90vw, calc(100% - 60px));
            height: 500px;
            max-width: 1000px;
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            padding: 30px;
            background: 
                radial-gradient(circle at center, rgba(255,215,0,0.1) 0%, transparent 70%),
                linear-gradient(135deg, rgba(139,69,19,0.8) 0%, rgba(160,82,45,0.6) 100%);
            border-radius: 25px;
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.2),
                inset 0 2px 0 rgba(255,255,255,0.3);
            border: 4px solid rgba(255,215,0,0.4);
            backdrop-filter: blur(3px);
        }

        /* å…«å¦ä½ç½® */
        .bagua-position {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* å„å¦ä½çš„èƒŒæ™¯è‰² */
        .bagua-position[data-position="qian"] { background: linear-gradient(135deg, rgba(255,215,0,0.85), rgba(255,193,7,0.7)); }
        .bagua-position[data-position="dui"] { background: linear-gradient(135deg, rgba(255,255,255,0.85), rgba(248,249,250,0.7)); }
        .bagua-position[data-position="li"] { background: linear-gradient(135deg, rgba(220,53,69,0.85), rgba(255,99,71,0.7)); }
        .bagua-position[data-position="zhen"] { background: linear-gradient(135deg, rgba(40,167,69,0.85), rgba(34,139,34,0.7)); }
        .bagua-position[data-position="xun"] { background: linear-gradient(135deg, rgba(144,238,144,0.85), rgba(152,251,152,0.7)); }
        .bagua-position[data-position="kan"] { background: linear-gradient(135deg, rgba(0,123,255,0.85), rgba(30,144,255,0.7)); }
        .bagua-position[data-position="gen"] { background: linear-gradient(135deg, rgba(139,69,19,0.85), rgba(160,82,45,0.7)); }
        .bagua-position[data-position="kun"] { background: linear-gradient(135deg, rgba(255,193,7,0.85), rgba(255,215,0,0.7)); }

        .bagua-position::after {
            content: attr(data-name);
            font-size: 14px;
            font-weight: bold;
            color: rgba(0,0,0,0.8);
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            margin-top: 5px;
        }

        .bagua-position:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* å…«å¦ç¬¦å·æ ·å¼ */
        .bagua-symbol {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 2px;
        }

        .bagua-name {
            font-size: 14px;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 1px;
        }

        .bagua-element {
            font-size: 10px;
            color: #7f8c8d;
            font-style: italic;
        }

        .center-text {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* å…«å¦ä½ç½®ç‰¹æ®Šé¢œè‰² */
        .bagua-position[data-position="qian"] .bagua-symbol { color: #f39c12; } /* ä¹¾-é‡‘ */
        .bagua-position[data-position="kun"] .bagua-symbol { color: #8b4513; } /* å¤-åœŸ */
        .bagua-position[data-position="zhen"] .bagua-symbol { color: #2ecc71; } /* éœ‡-æœ¨ */
        .bagua-position[data-position="xun"] .bagua-symbol { color: #27ae60; } /* å·½-æœ¨ */
        .bagua-position[data-position="kan"] .bagua-symbol { color: #3498db; } /* å-æ°´ */
        .bagua-position[data-position="li"] .bagua-symbol { color: #e74c3c; } /* ç¦»-ç« */
        .bagua-position[data-position="gen"] .bagua-symbol { color: #95a5a6; } /* è‰®-åœŸ */
        .bagua-position[data-position="dui"] .bagua-symbol { color: #f1c40f; } /* å…‘-é‡‘ */

        /* å¤ªæå›¾ - ä¼ ç»Ÿè®¾è®¡ä¼˜åŒ–ç‰ˆ */
        .center-taiji {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: 
                linear-gradient(90deg, #1a1a1a 0%, #1a1a1a 50%, #f8f8f8 50%, #f8f8f8 100%);
            box-shadow: 
                0 0 20px rgba(0,0,0,0.3),
                inset 0 0 8px rgba(0,0,0,0.1),
                0 0 40px rgba(255,215,0,0.2);
            border: 3px solid rgba(255,215,0,0.6);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(1px);
            animation: taijRotate 120s linear infinite;
            z-index: 5;
            overflow: hidden;
            position: relative;
            opacity: 0.9;
        }

        /* ä¸ŠåŠåœ†ï¼ˆé˜³é±¼å¤´éƒ¨ï¼‰ */
        .center-taiji::before {
            content: '';
            position: absolute;
            top: 0;
            left: 25%;
            width: 50%;
            height: 50%;
            background: #000;
            border-radius: 0 60px 60px 0;
            transform-origin: 0 100%;
        }

        /* ä¸‹åŠåœ†ï¼ˆé˜´é±¼å¤´éƒ¨ï¼‰ */
        .center-taiji::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 25%;
            width: 50%;
            height: 50%;
            background: #fff;
            border-radius: 60px 0 0 60px;
            transform-origin: 100% 0;
        }

        .center-taiji:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 
                0 0 40px rgba(0,0,0,0.5),
                inset 0 0 15px rgba(0,0,0,0.2),
                0 0 80px rgba(255,215,0,0.4);
        }

        /* é˜´é˜³é±¼çš„çœ¼ç› */
        .taiji-eye-white {
            position: absolute;
            top: 30%;
            left: 50%;
            width: 16%;
            height: 16%;
            background: #f8f8f8;
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 2;
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        .taiji-eye-black {
            position: absolute;
            bottom: 30%;
            left: 50%;
            width: 16%;
            height: 16%;
            background: #1a1a1a;
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 2;
            box-shadow: 0 0 3px rgba(255,255,255,0.3);
        }

        @keyframes taijRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes taijPulse {
            0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        /* æ–¹ä½æ ‡ç­¾ */
        .bagua-container::before {
            content: 'å—';
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            font-weight: 900;
            color: #d63031;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(214,48,49,0.5);
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(214,48,49,0.3);
        }

        .bagua-container::after {
            content: 'åŒ—';
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            font-weight: 900;
            color: #0984e3;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(9,132,227,0.5);
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(9,132,227,0.3);
        }

        .direction-label-west {
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: 900;
            color: #fdcb6e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(253,203,110,0.5);
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(253,203,110,0.3);
        }

        .direction-label-east {
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: 900;
            color: #00b894;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(0,184,148,0.5);
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(0,184,148,0.3);
        }

        /* ç©å®¶æ£‹å­ */
        .player-piece {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            cursor: pointer;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .player-piece.player1 { 
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.4);
        }
        .player-piece.player2 { 
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.4);
        }
        .player-piece.player3 { 
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 2px 10px rgba(46, 204, 113, 0.4);
        }
        .player-piece.player4 { 
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 2px 10px rgba(243, 156, 18, 0.4);
        }

        .player-piece:hover {
            transform: scale(1.3) translateZ(0);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .player-piece.moving {
            animation: moveGlow 0.6s ease-in-out;
            transform: scale(1.2);
        }

        @keyframes moveGlow {
             0% { 
                 box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                 transform: scale(1);
             }
             50% { 
                 box-shadow: 0 8px 25px rgba(255,255,255,0.6);
                 transform: scale(1.4);
             }
             100% { 
                 box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                 transform: scale(1);
             }
         }

         @keyframes fadeInOut {
             0% { 
                 opacity: 0;
                 transform: translateX(-50%) translateY(-10px);
             }
             20% { 
                 opacity: 1;
                 transform: translateX(-50%) translateY(0);
             }
             80% { 
                 opacity: 1;
                 transform: translateX(-50%) translateY(0);
             }
             100% { 
                 opacity: 0;
                 transform: translateX(-50%) translateY(-10px);
             }
         }

        /* æŠ€èƒ½å¡ç‰Œæ ·å¼ */
        .card-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .skill-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .skill-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52,152,219,0.3);
            border-color: #2980b9;
        }

        .skill-card.selected {
            border-color: #e74c3c;
            background: linear-gradient(135deg, rgba(231,76,60,0.1), rgba(192,57,43,0.05));
        }

        .card-name {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .card-cost {
            font-size: 10px;
            color: #7f8c8d;
        }

        .skill-card[data-skill="move"] { border-left: 4px solid #2ecc71; }
            .skill-card[data-skill="attack"] { border-left: 4px solid #e74c3c; }
            .skill-card[data-skill="defend"] { border-left: 4px solid #3498db; }
            .skill-card[data-skill="special"] { border-left: 4px solid #9b59b6; }

            /* å¡ç‰Œå‰©ä½™æ•°é‡æ˜¾ç¤º */
            .card-remaining {
                font-size: 11px;
                color: #666;
                margin-top: 4px;
                font-weight: normal;
            }

            /* åŒºåŸŸæ ‡é¢˜æ ·å¼ */
            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                padding: 15px 20px;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                border-radius: 12px;
                border: 2px solid #ffd700;
                box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
            }

            .section-header h3 {
                margin: 0;
                color: #ffd700;
                font-size: 1.3em;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }

            .card-info {
                display: flex;
                align-items: center;
                gap: 20px;
            }

            .card-count {
                color: #3498db;
                font-weight: bold;
                font-size: 1.1em;
                background: rgba(52, 152, 219, 0.1);
                padding: 8px 15px;
                border-radius: 20px;
                border: 1px solid #3498db;
            }

            .card-count-detail {
                display: flex;
                flex-direction: column;
                gap: 4px;
                text-align: center;
                font-size: 0.9em;
            }

            .card-count-detail > div {
                padding: 2px 8px;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.1);
                transition: all 0.3s ease;
            }

            .card-count-detail > div:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: scale(1.05);
            }

            .btn-sm {
                padding: 10px 20px;
                font-size: 1em;
                border-radius: 25px;
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }

            .btn-info {
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white;
                position: relative;
                overflow: hidden;
            }

            .btn-info::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                transition: left 0.5s ease;
            }

            .btn-info:hover::before {
                left: 100%;
            }

            .btn-info:hover {
                background: linear-gradient(135deg, #2980b9, #3498db);
                transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
            }

            /* å¡ç‰Œåœ¨å…«å¦åœ°å›¾ä¸Šçš„æ˜¾ç¤ºæ•ˆæœ */
            .card-on-map {
                position: absolute;
                width: 60px;
                height: 80px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 8px;
                border: 2px solid #fff;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                font-weight: bold;
                text-align: center;
                z-index: 1000;
                pointer-events: none;
                transform: scale(0);
                opacity: 0;
                transition: all 0.3s ease;
            }

            .card-on-map.show {
                transform: scale(1);
                opacity: 1;
            }

            .card-on-map.hide {
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }

            .card-on-map .card-icon {
                font-size: 20px;
                margin-bottom: 4px;
            }

            .card-on-map .card-name {
                font-size: 10px;
                line-height: 1;
            }

            /* ä¸åŒæŠ€èƒ½å¡ç‰Œçš„é¢œè‰² */
            .card-on-map[data-skill="move"] {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            }

            .card-on-map[data-skill="attack"] {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            }

            .card-on-map[data-skill="defend"] {
                background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            }

            .card-on-map[data-skill="special"] {
                background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            }

            /* å¡ç‰Œä½¿ç”¨æ—¶çš„å…‰æ•ˆ */
            .card-effect {
                position: absolute;
                width: 100px;
                height: 100px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
                pointer-events: none;
                z-index: 999;
                transform: scale(0);
                opacity: 0;
                animation: cardEffect 1s ease-out;
            }

            @keyframes cardEffect {
                0% {
                    transform: scale(0);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.2);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(2);
                    opacity: 0;
                }
            }

        /* å¸®åŠ©ä¿¡æ¯æ ·å¼ */
        .help-info {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .help-item {
            margin-bottom: 10px;
            font-size: 11px;
            line-height: 1.3;
        }

        .help-item:last-child {
            margin-bottom: 0;
        }

        .help-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 2px;
        }

        .help-item p {
            color: #7f8c8d;
            margin: 0;
            padding-left: 8px;
        }

        /* å³ä¾§æ§åˆ¶é¢æ¿ */
        .right-panel {
            grid-area: right-panel;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* åº•éƒ¨è®°å½•é¢æ¿ */
        .bottom-panel {
            grid-area: bottom-panel;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            min-height: 200px;
        }

        .player-log {
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            padding: 20px;
            border-top: 5px solid #3498db;
            min-height: 120px;
        }

        .player-log.active {
            border-top-color: #e74c3c;
            box-shadow: 0 2px 10px rgba(231,76,60,0.2);
        }

        .log-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .log-entry {
            font-size: 12px;
            color: #495057;
            margin-bottom: 6px;
            padding: 8px 12px;
            background: rgba(52,152,219,0.08);
            border-radius: 6px;
            border-left: 3px solid #3498db;
            transition: all 0.2s ease;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .log-entry:hover {
            background: rgba(52,152,219,0.12);
            transform: translateX(2px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .log-entry.recent {
            background: rgba(231,76,60,0.1);
            border-left-color: #e74c3c;
            color: #2c3e50;
            font-weight: bold;
            animation: highlight 0.5s ease-in-out;
        }

        /* æŠ€èƒ½ä½¿ç”¨æ—¥å¿—æ ·å¼ */
        .log-entry.skill {
            background: rgba(155,89,182,0.1);
            border-left-color: #9b59b6;
            color: #6c3483;
        }

        .log-entry.skill .skill-name {
            font-weight: bold;
            color: #8e44ad;
        }

        .log-entry.skill .energy-cost {
            color: #e67e22;
            font-size: 11px;
        }

        .log-entry.skill .effects {
            color: #27ae60;
            font-size: 11px;
        }

        .log-entry.skill .bonuses {
            color: #f39c12;
            font-size: 11px;
            font-style: italic;
        }

        /* çŠ¶æ€å˜åŒ–æ—¥å¿—æ ·å¼ */
        .log-entry.status {
            background: rgba(46,204,113,0.1);
            border-left-color: #2ecc71;
            color: #1e8449;
        }

        .log-entry.status.negative {
            background: rgba(231,76,60,0.1);
            border-left-color: #e74c3c;
            color: #c0392b;
        }

        .log-entry.status .status-change {
            font-weight: bold;
        }

        .log-entry.status .status-value {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.05);
            padding: 1px 4px;
            border-radius: 3px;
        }

        /* ç§»åŠ¨æ—¥å¿—æ ·å¼ */
        .log-entry.movement {
            background: rgba(52,152,219,0.1);
            border-left-color: #3498db;
            color: #2980b9;
        }

        .log-entry.movement .position {
            font-weight: bold;
            color: #1abc9c;
        }

        /* æˆ˜æ–—æ—¥å¿—æ ·å¼ */
        .log-entry.combat {
            background: rgba(231,76,60,0.1);
            border-left-color: #e74c3c;
            color: #c0392b;
        }

        .log-entry.combat .damage {
            font-weight: bold;
            color: #e74c3c;
        }

        .log-entry.combat .target {
            color: #8e44ad;
            font-weight: bold;
        }

        /* ç³»ç»Ÿæ¶ˆæ¯æ ·å¼ */
        .log-entry.system {
            background: rgba(149,165,166,0.1);
            border-left-color: #95a5a6;
            color: #7f8c8d;
            font-style: italic;
        }

        /* ç‰¹æ®Šæ•ˆæœ */
        @keyframes highlight {
            0% { background: rgba(255,193,7,0.3); }
            50% { background: rgba(255,193,7,0.5); }
            100% { background: rgba(231,76,60,0.1); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-entry.new {
            animation: slideIn 0.3s ease-out;
        }

        /* æ—¥å¿—å›¾æ ‡ */
        .log-entry::before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 6px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.6;
        }

        .log-entry.skill::before {
            content: 'âš¡';
            background: none;
            font-size: 12px;
        }

        .log-entry.status::before {
            content: 'ğŸ“Š';
            background: none;
            font-size: 12px;
        }

        .log-entry.movement::before {
            content: 'ğŸš¶';
            background: none;
            font-size: 12px;
        }

        .log-entry.combat::before {
            content: 'âš”ï¸';
            background: none;
            font-size: 12px;
        }

        .log-entry.system::before {
            content: 'ğŸ”§';
            background: none;
            font-size: 12px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 250px 1fr 250px;
            }
            .bagua-map {
                width: 400px;
                height: 400px;
            }
            .center-taiji {
                width: 100px;
                height: 100px;
            }
        }

        @media (max-width: 900px) {
            .game-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
                grid-template-areas: 
                    "header"
                    "left-panel"
                    "game-area"
                    "right-panel"
                    "bottom-panel";
            }
            .bagua-map {
                width: 350px;
                height: 350px;
            }
        }

        /* èƒœåˆ©åŠ¨ç”»æ•ˆæœ */
        @keyframes victoryPulse {
            0% { transform: scale(1); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
            25% { transform: scale(1.02); box-shadow: 0 8px 30px rgba(52, 152, 219, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 12px 40px rgba(231, 76, 60, 0.3); }
            75% { transform: scale(1.02); box-shadow: 0 8px 30px rgba(46, 204, 113, 0.3); }
            100% { transform: scale(1); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        }

        @keyframes firework {
            0% {
                transform: scale(1);
                opacity: 1;
                box-shadow: 0 0 0 0 currentColor;
            }
            50% {
                transform: scale(3);
                opacity: 0.8;
                box-shadow: 0 0 20px 10px currentColor;
            }
            100% {
                transform: scale(5);
                opacity: 0;
                box-shadow: 0 0 30px 15px transparent;
            }
        }

        /* æ¨¡æ€çª—å£æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            margin: 2% auto;
            padding: 0;
            border: 2px solid #ffd700;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            padding: 20px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8em;
            font-weight: bold;
        }

        .close {
            color: #1a1a2e;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
            transform: scale(1.2);
        }
        
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            font-size: 12px;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-1px);
        }

        .modal-body {
            padding: 20px;
        }

        .gallery-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ffd700;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: #ffd700;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            font-size: 1.1em;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            font-weight: bold;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 215, 0, 0.2);
        }

        .gallery-tab-content {
            display: none;
        }

        .gallery-tab-content.active {
            display: block;
        }

        .gallery-tab-content h3 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .gallery-card {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .gallery-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .gallery-card:hover::before {
            left: 100%;
        }

        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .gallery-card.move {
            border-color: #3498db;
        }

        .gallery-card.attack {
            border-color: #e74c3c;
        }

        .gallery-card.defend {
            border-color: #2ecc71;
        }

        .gallery-card.special {
            border-color: #9b59b6;
        }

        .gallery-card.advanced {
            border-color: #f39c12;
        }

        .gallery-card.legendary {
            border-color: #ffd700;
            background: linear-gradient(135deg, #2c3e50, #34495e, #2c3e50);
        }
        
        .gallery-card.hexagram {
            border-color: #f39c12;
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .gallery-card.hexagram.qian {
            border-color: #ffd700;
            background: linear-gradient(135deg, #ffd700, #ffb347);
        }
        
        .gallery-card.hexagram.kun {
            border-color: #8b4513;
            background: linear-gradient(135deg, #8b4513, #a0522d);
        }
        
        .gallery-card.hexagram.complex {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
        
        .hexagram-info {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid #f39c12;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #f39c12;
        }
        
        .hexagram-note {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #3498db;
            font-style: italic;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .card-description {
            color: #ecf0f1;
            text-align: left;
            line-height: 1.6;
        }

        .card-description p {
            margin: 8px 0;
        }

        .card-description strong {
            color: #ffd700;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .gallery-tabs {
                flex-direction: column;
            }

            .tab-btn {
                margin: 2px 0;
                border-radius: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-layout">
        <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
        <div class="header">
            <div class="game-title">å¤©æœºå˜ - å››äººå¯¹æˆ˜</div>
            <div class="game-status">
                <div class="status-item">
                    <div class="status-label">å½“å‰å›åˆ</div>
                    <div class="status-value" id="current-round">1</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å½“å‰ç©å®¶</div>
                    <div class="status-value" id="current-player">ç©å®¶1</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å½“å‰å­£èŠ‚</div>
                    <div class="status-value" id="current-season">æ˜¥</div>
                </div>
                <div class="status-item">
                    <div class="status-label">äº”è¡Œä¸»å¯¼</div>
                    <div class="status-value" id="current-wuxing">æœ¨</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å¤©å¹²åœ°æ”¯</div>
                    <div class="status-value" id="current-ganzhi">ç”²å­</div>
                </div>
                <div class="status-item">
                    <div class="status-label">èŠ‚æ°”</div>
                    <div class="status-value" id="current-jieqi">ç«‹æ˜¥</div>
                </div>
                <div class="status-item">
                    <div class="status-label">é˜´é˜³</div>
                    <div class="status-value" id="current-yinyang">é˜³</div>
                </div>
                <div class="status-item">
                    <div class="status-label">æ¸¸æˆçŠ¶æ€</div>
                    <div class="status-value" id="game-state">å‡†å¤‡ä¸­</div>
                </div>
            </div>
        </div>



        <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
        <div class="game-area">
            <div class="bagua-container" style="position: relative;">
                <!-- å…«å¦åœ°å›¾ -->
                <div class="bagua-map">
                    <!-- ç¬¬ä¸€è¡Œ -->
                    <div class="bagua-position" data-position="xun" data-name="å·½â˜´" onclick="moveToPosition('xun')">
                        <div class="bagua-symbol">â˜´</div>
                        <div class="bagua-name">å·½</div>
                        <div class="bagua-element">é£</div>
                    </div>
                    <div class="bagua-position" data-position="li" data-name="ç¦»â˜²" onclick="moveToPosition('li')">
                        <div class="bagua-symbol">â˜²</div>
                        <div class="bagua-name">ç¦»</div>
                        <div class="bagua-element">ç«</div>
                    </div>
                    <div class="bagua-position" data-position="kun" data-name="å¤â˜·" onclick="moveToPosition('kun')">
                        <div class="bagua-symbol">â˜·</div>
                        <div class="bagua-name">å¤</div>
                        <div class="bagua-element">åœ°</div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œ -->
                    <div class="bagua-position" data-position="zhen" data-name="éœ‡â˜³" onclick="moveToPosition('zhen')">
                        <div class="bagua-symbol">â˜³</div>
                        <div class="bagua-name">éœ‡</div>
                        <div class="bagua-element">é›·</div>
                    </div>
                    <div class="bagua-position center-position" data-position="center" data-name="ä¸­å¿ƒ">
                        <div class="center-text">å¤ªæ</div>
                    </div>
                    <div class="bagua-position" data-position="dui" data-name="å…‘â˜±" onclick="moveToPosition('dui')">
                        <div class="bagua-symbol">â˜±</div>
                        <div class="bagua-name">å…‘</div>
                        <div class="bagua-element">æ³½</div>
                    </div>
                    
                    <!-- ç¬¬ä¸‰è¡Œ -->
                    <div class="bagua-position" data-position="gen" data-name="è‰®â˜¶" onclick="moveToPosition('gen')">
                        <div class="bagua-symbol">â˜¶</div>
                        <div class="bagua-name">è‰®</div>
                        <div class="bagua-element">å±±</div>
                    </div>
                    <div class="bagua-position" data-position="kan" data-name="åâ˜µ" onclick="moveToPosition('kan')">
                        <div class="bagua-symbol">â˜µ</div>
                        <div class="bagua-name">å</div>
                        <div class="bagua-element">æ°´</div>
                    </div>
                    <div class="bagua-position" data-position="qian" data-name="ä¹¾â˜°" onclick="moveToPosition('qian')">
                        <div class="bagua-symbol">â˜°</div>
                        <div class="bagua-name">ä¹¾</div>
                        <div class="bagua-element">å¤©</div>
                    </div>
                    
                    <!-- å¤ªæå›¾ -->
                    <div class="center-taiji" onclick="moveToCenter()">
                        <div class="taiji-eye-white"></div>
                        <div class="taiji-eye-black"></div>
                    </div>
                </div>
                
                <!-- æ–¹ä½æ ‡ç­¾ -->
                <div class="direction-label-west">è¥¿</div>
                <div class="direction-label-east">ä¸œ</div>
                
                <!-- ç©å®¶æ£‹å­ -->
                <div class="player-piece player1" id="player1-piece" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">1</div>
                <div class="player-piece player2" id="player2-piece" style="top: 20%; left: 80%; transform: translate(-50%, -50%);">2</div>
                <div class="player-piece player3" id="player3-piece" style="top: 80%; left: 20%; transform: translate(-50%, -50%);">3</div>
                <div class="player-piece player4" id="player4-piece" style="top: 50%; left: 20%; transform: translate(-50%, -50%);">4</div>
            </div>
        </div>

        <!-- å³ä¾§æ§åˆ¶é¢æ¿ -->
        <div class="right-panel">
            <div class="control-section">
                <h3>æ¸¸æˆæ§åˆ¶</h3>
                <button class="btn btn-success" onclick="startFourPlayerDemo()" id="start-demo-btn">å¼€å§‹å››äººæ¼”ç¤º</button>
                <button class="btn btn-primary" onclick="nextTurn()" id="next-turn-btn">ä¸‹ä¸€å›åˆ</button>
                <button class="btn btn-warning" onclick="pauseGame()" id="pause-btn">æš‚åœæ¸¸æˆ</button>
                <button class="btn btn-danger" onclick="resetGame()" id="reset-btn">é‡ç½®æ¸¸æˆ</button>
            </div>
            
            <div class="control-section">
                <h3>æ¼”ç¤ºè®¾ç½®</h3>
                <button class="btn btn-primary" onclick="setAutoPlay(true)">è‡ªåŠ¨æ¼”ç¤º</button>
                <button class="btn btn-primary" onclick="setAutoPlay(false)">æ‰‹åŠ¨æ§åˆ¶</button>
                <button class="btn btn-primary" onclick="changeSpeed('fast')">å¿«é€Ÿæ¼”ç¤º</button>
                <button class="btn btn-primary" onclick="changeSpeed('slow')">æ…¢é€Ÿæ¼”ç¤º</button>
            </div>
            
            <div class="control-section">
                <div class="section-header">
                    <h3>æŠ€èƒ½å¡ç‰Œ</h3>
                    <div class="card-info">
                        <span id="remaining-cards" class="card-count">å‰©ä½™: 20å¼ </span>
                        <button class="btn btn-info btn-sm" onclick="showCardGallery()">ğŸ“š å¡ç‰Œå›¾é‰´</button>
                    </div>
                </div>
                <div class="card-container">
                    <div class="skill-card" data-skill="move" onclick="selectSkill('move')">
                        <div class="card-name">ç§»åŠ¨</div>
                        <div class="card-cost">æ¶ˆè€—: 10èƒ½é‡</div>
                        <div class="card-remaining" id="move-remaining">å‰©ä½™: 5å¼ </div>
                    </div>
                    <div class="skill-card" data-skill="attack" onclick="selectSkill('attack')">
                        <div class="card-name">æ”»å‡»</div>
                        <div class="card-cost">æ¶ˆè€—: 20èƒ½é‡</div>
                        <div class="card-remaining" id="attack-remaining">å‰©ä½™: 5å¼ </div>
                    </div>
                    <div class="skill-card" data-skill="defend" onclick="selectSkill('defend')">
                        <div class="card-name">é˜²å¾¡</div>
                        <div class="card-cost">æ¶ˆè€—: 15èƒ½é‡</div>
                        <div class="card-remaining" id="defend-remaining">å‰©ä½™: 5å¼ </div>
                    </div>
                    <div class="skill-card" data-skill="special" onclick="selectSkill('special')">
                        <div class="card-name">ç‰¹æŠ€</div>
                        <div class="card-cost">æ¶ˆè€—: 30èƒ½é‡</div>
                        <div class="card-remaining" id="special-remaining">å‰©ä½™: 5å¼ </div>
                    </div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>æ“ä½œæç¤º</h3>
                <div class="help-info">
                    <div class="help-item">
                        <strong>ğŸ¯ å¦‚ä½•æ¸¸æˆï¼š</strong>
                        <p>ç‚¹å‡»å…«å¦ä½ç½®ç§»åŠ¨è§’è‰²</p>
                    </div>
                    <div class="help-item">
                        <strong>ğŸƒ æŠ€èƒ½å¡ç‰Œï¼š</strong>
                        <p>é€‰æ‹©æŠ€èƒ½å¡ç‰Œä½¿ç”¨ä¸åŒèƒ½åŠ›</p>
                    </div>
                    <div class="help-item">
                        <strong>âš¡ èƒ½é‡ç³»ç»Ÿï¼š</strong>
                        <p>æ¯ä¸ªæŠ€èƒ½æ¶ˆè€—ä¸åŒèƒ½é‡</p>
                    </div>
                    <div class="help-item">
                        <strong>ğŸŒ¸ ä¼ ç»Ÿå…ƒç´ ï¼š</strong>
                        <p>è§‚å¯Ÿå­£èŠ‚ã€äº”è¡Œã€å¤©å¹²åœ°æ”¯å˜åŒ–</p>
                    </div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>æ¸¸æˆä¿¡æ¯</h3>
                <div style="font-size: 12px; color: #666; line-height: 1.4;">
                    <p><strong>å½“å‰é˜¶æ®µ:</strong> <span id="current-phase">å‡†å¤‡é˜¶æ®µ</span></p>
                    <p><strong>æ€»å›åˆæ•°:</strong> <span id="total-rounds">0</span></p>
                    <p><strong>æ¼”ç¤ºé€Ÿåº¦:</strong> <span id="demo-speed">æ­£å¸¸</span></p>
                    <p><strong>è‡ªåŠ¨æ¨¡å¼:</strong> <span id="auto-mode">å…³é—­</span></p>
                </div>
            </div>
        </div>

        <!-- ç©å®¶ä¿¡æ¯åŒºåŸŸ -->
        <div class="player-info-area">
            <div class="panel-title">ç©å®¶ä¿¡æ¯</div>
            <div class="player-info-grid">
                <div class="player-info active" id="player1-info">
                    <div class="player-name">ç©å®¶1 (äººç±»)</div>
                    <div class="player-stats">
                        <div class="stat-item">ç”Ÿå‘½: <span id="p1-health">100</span></div>
                        <div class="stat-item">èƒ½é‡: <span id="p1-energy">50</span></div>
                        <div class="stat-item">ä½ç½®: <span id="p1-position">ä¸­å¿ƒ</span></div>
                        <div class="stat-item">çŠ¶æ€: <span id="p1-status">æ­£å¸¸</span></div>
                    </div>
                </div>
                <div class="player-info" id="player2-info">
                    <div class="player-name">AI-æ™ºè€…</div>
                    <div class="player-stats">
                        <div class="stat-item">ç”Ÿå‘½: <span id="p2-health">100</span></div>
                        <div class="stat-item">èƒ½é‡: <span id="p2-energy">50</span></div>
                        <div class="stat-item">ä½ç½®: <span id="p2-position">ä¹¾</span></div>
                        <div class="stat-item">çŠ¶æ€: <span id="p2-status">æ­£å¸¸</span></div>
                    </div>
                </div>
                <div class="player-info" id="player3-info">
                    <div class="player-name">AI-è´¤äºº</div>
                    <div class="player-stats">
                        <div class="stat-item">ç”Ÿå‘½: <span id="p3-health">100</span></div>
                        <div class="stat-item">èƒ½é‡: <span id="p3-energy">50</span></div>
                        <div class="stat-item">ä½ç½®: <span id="p3-position">å¤</span></div>
                        <div class="stat-item">çŠ¶æ€: <span id="p3-status">æ­£å¸¸</span></div>
                    </div>
                </div>
                <div class="player-info" id="player4-info">
                    <div class="player-name">AI-å­¦è€…</div>
                    <div class="player-stats">
                        <div class="stat-item">ç”Ÿå‘½: <span id="p4-health">100</span></div>
                        <div class="stat-item">èƒ½é‡: <span id="p4-energy">50</span></div>
                        <div class="stat-item">ä½ç½®: <span id="p4-position">éœ‡</span></div>
                        <div class="stat-item">çŠ¶æ€: <span id="p4-status">æ­£å¸¸</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ç©å®¶è®°å½•é¢æ¿ -->
        <div class="bottom-panel">
            <div class="player-log active" id="player1-log">
                <div class="log-title">ç©å®¶1 æ“ä½œè®°å½•</div>
                <div class="log-entry recent">æ¸¸æˆå¼€å§‹ï¼Œä½äºä¸­å¿ƒä½ç½®</div>
                <div class="log-entry">ç­‰å¾…å…¶ä»–ç©å®¶å‡†å¤‡...</div>
            </div>
            <div class="player-log" id="player2-log">
                <div class="log-title">ç©å®¶2 æ“ä½œè®°å½•</div>
                <div class="log-entry">AIæ™ºè€…å·²å‡†å¤‡å°±ç»ª</div>
                <div class="log-entry">é€‰æ‹©ä¹¾ä½ä½œä¸ºèµ·å§‹ä½ç½®</div>
            </div>
            <div class="player-log" id="player3-log">
                <div class="log-title">ç©å®¶3 æ“ä½œè®°å½•</div>
                <div class="log-entry">AIè´¤äººå·²å‡†å¤‡å°±ç»ª</div>
                <div class="log-entry">é€‰æ‹©å¤ä½ä½œä¸ºèµ·å§‹ä½ç½®</div>
            </div>
            <div class="player-log" id="player4-log">
                <div class="log-title">ç©å®¶4 æ“ä½œè®°å½•</div>
                <div class="log-entry">AIå­¦è€…å·²å‡†å¤‡å°±ç»ª</div>
                <div class="log-entry">é€‰æ‹©éœ‡ä½ä½œä¸ºèµ·å§‹ä½ç½®</div>
            </div>
        </div>
    </div>

    <!-- å¡ç‰Œå›¾é‰´æ¨¡æ€çª—å£ -->
    <div id="cardGalleryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“š å¡ç‰Œå›¾é‰´</h2>
                <div class="header-buttons">
                    <button class="btn btn-sm btn-warning" onclick="resetCardInventory()" title="é‡ç½®æ‰€æœ‰å¡ç‰Œåº“å­˜">
                        ğŸ”„ é‡ç½®åº“å­˜
                    </button>
                    <span class="close" onclick="closeCardGallery()">&times;</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="gallery-tabs">
                    <button class="tab-btn active" onclick="showGalleryTab('basic')">åŸºç¡€å¡ç‰Œ</button>
                    <button class="tab-btn" onclick="showGalleryTab('hexagram')">64å¦å¡ç‰Œ</button>
                    <button class="tab-btn" onclick="showGalleryTab('advanced')">é«˜çº§å¡ç‰Œ</button>
                    <button class="tab-btn" onclick="showGalleryTab('special')">ç‰¹æ®Šå¡ç‰Œ</button>
                </div>
                
                <div id="basic-cards" class="gallery-tab-content active">
                    <h3>åŸºç¡€æŠ€èƒ½å¡ç‰Œ</h3>
                    <div class="gallery-grid">
                        <div class="gallery-card move">
                            <div class="card-icon">ğŸš¶</div>
                            <div class="card-title">ç§»åŠ¨å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>10èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>ç§»åŠ¨åˆ°ç›¸é‚»çš„å…«å¦ä½ç½®</p>
                                <p><strong>è¯´æ˜ï¼š</strong>åŸºç¡€ç§»åŠ¨æŠ€èƒ½ï¼Œå¯ä»¥åœ¨å…«å¦é˜µä¸­è‡ªç”±ç§»åŠ¨</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card attack">
                            <div class="card-icon">âš”ï¸</div>
                            <div class="card-title">æ”»å‡»å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>20èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å¯¹ç›®æ ‡é€ æˆä¼¤å®³</p>
                                <p><strong>è¯´æ˜ï¼š</strong>åŸºç¡€æ”»å‡»æŠ€èƒ½ï¼Œä¼¤å®³å—äº”è¡Œç›¸å…‹å½±å“</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card defend">
                            <div class="card-icon">ğŸ›¡ï¸</div>
                            <div class="card-title">é˜²å¾¡å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>15èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æå‡é˜²å¾¡åŠ›ï¼Œå‡å°‘å—åˆ°çš„ä¼¤å®³</p>
                                <p><strong>è¯´æ˜ï¼š</strong>åŸºç¡€é˜²å¾¡æŠ€èƒ½ï¼ŒæŒç»­ä¸€å›åˆ</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card special">
                            <div class="card-icon">âœ¨</div>
                            <div class="card-title">ç‰¹æŠ€å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>30èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ ¹æ®å½“å‰ä½ç½®è§¦å‘ç‰¹æ®Šæ•ˆæœ</p>
                                <p><strong>è¯´æ˜ï¼š</strong>é«˜çº§æŠ€èƒ½ï¼Œæ•ˆæœéšå…«å¦ä½ç½®å˜åŒ–</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="hexagram-cards" class="gallery-tab-content">
                    <h3>64å¦å¡ç‰Œ</h3>
                    <div class="hexagram-info">
                        <p>å¤©æœºå˜æ¸¸æˆçš„æ ¸å¿ƒå¡ç‰Œç³»ç»Ÿï¼ŒåŸºäºã€Šæ˜“ç»ã€‹64å¦è®¾è®¡ï¼Œæ¯å¦éƒ½æœ‰ç‹¬ç‰¹çš„æ•ˆæœå’Œæˆ˜ç•¥ä»·å€¼ã€‚</p>
                    </div>
                    <div class="gallery-grid">
                        <!-- ä¹¾å¦ç³»åˆ— -->
                        <div class="gallery-card hexagram qian">
                            <div class="card-icon">â˜°</div>
                            <div class="card-title">ä¹¾å¦ - å¤©</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>60èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å¤§å¹…æå‡æ”»å‡»åŠ›ï¼Œè·å¾—"å¤©å¨"çŠ¶æ€</p>
                                <p><strong>å¦è±¡ï¼š</strong>ä¹¾ä¸ºå¤©ï¼Œåˆšå¥ä¸­æ­£</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è‡³åˆšè‡³é˜³ä¹‹å¦ï¼Œè±¡å¾é¢†å¯¼åŠ›å’Œåˆ›é€ åŠ›</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram kun">
                            <div class="card-icon">â˜·</div>
                            <div class="card-title">å¤å¦ - åœ°</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>50èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å¤§å¹…æå‡é˜²å¾¡åŠ›ï¼Œè·å¾—"åšå¾·"çŠ¶æ€</p>
                                <p><strong>å¦è±¡ï¼š</strong>å¤ä¸ºåœ°ï¼ŒæŸ”é¡ºæ‰¿è½½</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è‡³æŸ”è‡³é˜´ä¹‹å¦ï¼Œè±¡å¾åŒ…å®¹å’Œæ‰¿è½½</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram zhen">
                            <div class="card-icon">â˜³</div>
                            <div class="card-title">éœ‡å¦ - é›·</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>45èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>éœ‡æ…‘æ•Œäººï¼Œé™ä½å…¶è¡ŒåŠ¨åŠ›</p>
                                <p><strong>å¦è±¡ï¼š</strong>éœ‡ä¸ºé›·ï¼ŒåŠ¨è€Œæœ‰å¨</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾éœ‡åŠ¨ã€è§‰é†’å’Œè¡ŒåŠ¨åŠ›</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram xun">
                            <div class="card-icon">â˜´</div>
                            <div class="card-title">å·½å¦ - é£</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>40èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æå‡ç§»åŠ¨é€Ÿåº¦ï¼Œå¯ç©¿è¶Šéšœç¢</p>
                                <p><strong>å¦è±¡ï¼š</strong>å·½ä¸ºé£ï¼Œå…¥è€Œæœ‰åº</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾æ¸—é€ã€çµæ´»å’Œé€‚åº”</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram kan">
                            <div class="card-icon">â˜µ</div>
                            <div class="card-title">åå¦ - æ°´</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>35èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ²»ç–—è‡ªèº«ï¼Œæ¸…é™¤è´Ÿé¢çŠ¶æ€</p>
                                <p><strong>å¦è±¡ï¼š</strong>åä¸ºæ°´ï¼Œé™©è€Œæœ‰ä¿¡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾æ™ºæ…§ã€æµåŠ¨å’Œå…‹æœå›°éš¾</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram li">
                            <div class="card-icon">â˜²</div>
                            <div class="card-title">ç¦»å¦ - ç«</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>55èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>é€ æˆç«ç„°ä¼¤å®³ï¼Œé™„åŠ ç‡ƒçƒ§æ•ˆæœ</p>
                                <p><strong>å¦è±¡ï¼š</strong>ç¦»ä¸ºç«ï¼Œæ˜è€Œæœ‰ç¤¼</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾å…‰æ˜ã€çƒ­æƒ…å’Œæ–‡æ˜</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram gen">
                            <div class="card-icon">â˜¶</div>
                            <div class="card-title">è‰®å¦ - å±±</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>30èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>è¿›å…¥é˜²å¾¡çŠ¶æ€ï¼Œå…ç–«ä¸‹æ¬¡æ”»å‡»</p>
                                <p><strong>å¦è±¡ï¼š</strong>è‰®ä¸ºå±±ï¼Œæ­¢è€Œæœ‰æ—¶</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾ç¨³å®šã€åšæŒå’Œé€‚æ—¶åœæ­¢</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram dui">
                            <div class="card-icon">â˜±</div>
                            <div class="card-title">å…‘å¦ - æ³½</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>25èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ¢å¤èƒ½é‡ï¼Œæå‡é˜Ÿå‹å£«æ°”</p>
                                <p><strong>å¦è±¡ï¼š</strong>å…‘ä¸ºæ³½ï¼Œæ‚¦è€Œæœ‰èŠ‚</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾å–œæ‚¦ã€äº¤æµå’Œæ”¶è·</p>
                            </div>
                        </div>
                        
                        <!-- å¤åˆå¦ç¤ºä¾‹ -->
                        <div class="gallery-card hexagram complex">
                            <div class="card-icon">â˜°â˜·</div>
                            <div class="card-title">æ³°å¦ - å¤©åœ°äº¤</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>70èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å¤©åœ°å’Œè°ï¼Œå…¨å±æ€§å¤§å¹…æå‡</p>
                                <p><strong>å¦è±¡ï¼š</strong>å¤©åœ°ç›¸äº¤ï¼Œé€šæ³°ä¹‹è±¡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾å’Œè°ã€ç¹è£å’Œå¹³è¡¡</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram complex">
                            <div class="card-icon">â˜·â˜°</div>
                            <div class="card-title">å¦å¦ - å¤©åœ°å¦</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>20èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>é˜»æ–­æ•Œäººè¡ŒåŠ¨ï¼Œé€ æˆæ··ä¹±çŠ¶æ€</p>
                                <p><strong>å¦è±¡ï¼š</strong>å¤©åœ°ä¸äº¤ï¼Œé—­å¡ä¹‹è±¡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾é˜»å¡ã€å›°éš¾å’Œå˜é©å‰çš„å‡†å¤‡</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram complex">
                            <div class="card-icon">â˜³â˜µ</div>
                            <div class="card-title">å±¯å¦ - é›·æ°´å±¯</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>40èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>ç§¯è“„åŠ›é‡ï¼Œä¸‹å›åˆæ•ˆæœç¿»å€</p>
                                <p><strong>å¦è±¡ï¼š</strong>é›·æ°´ç›¸æ¿€ï¼Œå±¯ç§¯ä¹‹è±¡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾ç§¯ç´¯ã€å‡†å¤‡å’Œç­‰å¾…æ—¶æœº</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card hexagram complex">
                            <div class="card-icon">â˜µâ˜¶</div>
                            <div class="card-title">è’™å¦ - æ°´å±±è’™</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>15èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å­¦ä¹ æ•ŒäººæŠ€èƒ½ï¼Œè·å¾—å…¶èƒ½åŠ›</p>
                                <p><strong>å¦è±¡ï¼š</strong>æ°´å±±ç›¸ä¾ï¼Œå¯è’™ä¹‹è±¡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>è±¡å¾å­¦ä¹ ã€å¯å‘å’Œæˆé•¿</p>
                            </div>
                        </div>
                    </div>
                    <div class="hexagram-note">
                        <p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œåªå±•ç¤ºäº†éƒ¨åˆ†ä»£è¡¨æ€§å¦è±¡ã€‚å®Œæ•´çš„64å¦ç³»ç»ŸåŒ…å«æ‰€æœ‰å¯èƒ½çš„å¦è±¡ç»„åˆï¼Œæ¯ä¸ªéƒ½æœ‰ç‹¬ç‰¹çš„æˆ˜ç•¥ä»·å€¼å’Œä½¿ç”¨æ—¶æœºã€‚</p>
                    </div>
                </div>
                
                <div id="advanced-cards" class="gallery-tab-content">
                    <h3>é«˜çº§å¡ç‰Œ</h3>
                    <div class="gallery-grid">
                        <div class="gallery-card advanced">
                            <div class="card-icon">ğŸŒŸ</div>
                            <div class="card-title">é“æ³•å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>50èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ–½å±•å¼ºå¤§çš„é“æ³•æ”»å‡»</p>
                                <p><strong>è¯´æ˜ï¼š</strong>å¨åŠ›å·¨å¤§ï¼Œä½†æ¶ˆè€—å¾ˆé«˜</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card advanced">
                            <div class="card-icon">ğŸ”„</div>
                            <div class="card-title">å˜å¦å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>40èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ”¹å˜å½“å‰çš„äº”è¡Œå±æ€§</p>
                                <p><strong>è¯´æ˜ï¼š</strong>å¯ä»¥æ‰­è½¬æˆ˜å±€çš„å…³é”®å¡ç‰Œ</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card advanced">
                            <div class="card-icon">âš¡</div>
                            <div class="card-title">èšæ°”å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>0èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>æ¢å¤30ç‚¹èƒ½é‡</p>
                                <p><strong>è¯´æ˜ï¼š</strong>å…³é”®æ—¶åˆ»çš„èƒ½é‡è¡¥å……</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="special-cards" class="gallery-tab-content">
                    <h3>ç‰¹æ®Šå¡ç‰Œ</h3>
                    <div class="gallery-grid">
                        <div class="gallery-card legendary">
                            <div class="card-icon">ğŸ‰</div>
                            <div class="card-title">é¾™è„‰å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>100èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>å¬å”¤é¾™è„‰ä¹‹åŠ›ï¼Œé€ æˆèŒƒå›´ä¼¤å®³</p>
                                <p><strong>è¯´æ˜ï¼š</strong>ä¼ è¯´çº§å¡ç‰Œï¼Œå¨åŠ›æ— ç©·</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card legendary">
                            <div class="card-icon">ğŸŒ™</div>
                            <div class="card-title">é˜´é˜³å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>80èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>åˆ‡æ¢é˜´é˜³çŠ¶æ€ï¼Œè·å¾—ç‰¹æ®ŠåŠ æˆ</p>
                                <p><strong>è¯´æ˜ï¼š</strong>ç¨€æœ‰å¡ç‰Œï¼Œæ”¹å˜æ¸¸æˆèŠ‚å¥</p>
                            </div>
                        </div>
                        
                        <div class="gallery-card legendary">
                            <div class="card-icon">ğŸ­</div>
                            <div class="card-title">å¥‡é—¨å¡</div>
                            <div class="card-description">
                                <p><strong>æ¶ˆè€—ï¼š</strong>60èƒ½é‡</p>
                                <p><strong>æ•ˆæœï¼š</strong>éšæœºè§¦å‘å¥‡é—¨éç”²æ•ˆæœ</p>
                                <p><strong>è¯´æ˜ï¼š</strong>ç¥ç§˜å¡ç‰Œï¼Œæ•ˆæœä¸å¯é¢„æµ‹</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        class TianJiBianGame {
            constructor() {
                this.currentPlayer = 1;
                this.currentRound = 1;
                this.gameState = 'ready';
                this.autoPlay = false;
                this.demoSpeed = 'normal';
                this.isRunning = false;
                this.currentSeason = 0; // 0=æ˜¥, 1=å¤, 2=ç§‹, 3=å†¬
                this.currentWuxing = 0; // 0=æœ¨, 1=ç«, 2=åœŸ, 3=é‡‘, 4=æ°´
                this.seasons = ['æ˜¥', 'å¤', 'ç§‹', 'å†¬'];
                this.wuxingElements = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
                this.wuxingColors = ['#2ecc71', '#e74c3c', '#f39c12', '#f1c40f', '#3498db'];
                
                // å¤©å¹²åœ°æ”¯ç³»ç»Ÿ
                this.tiangan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
                this.dizhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
                this.currentGanzhiIndex = 0;
                
                // äºŒåå››èŠ‚æ°”
                this.jieqi = [
                    'ç«‹æ˜¥', 'é›¨æ°´', 'æƒŠè›°', 'æ˜¥åˆ†', 'æ¸…æ˜', 'è°·é›¨',
                    'ç«‹å¤', 'å°æ»¡', 'èŠ’ç§', 'å¤è‡³', 'å°æš‘', 'å¤§æš‘',
                    'ç«‹ç§‹', 'å¤„æš‘', 'ç™½éœ²', 'ç§‹åˆ†', 'å¯’éœ²', 'éœœé™',
                    'ç«‹å†¬', 'å°é›ª', 'å¤§é›ª', 'å†¬è‡³', 'å°å¯’', 'å¤§å¯’'
                ];
                this.currentJieqiIndex = 0;
                
                // é˜´é˜³ç³»ç»Ÿ
                this.yinyang = ['é˜³', 'é˜´'];
                this.currentYinYang = 0; // 0ä¸ºé˜³ï¼Œ1ä¸ºé˜´
                
                // å…«å¦æ–¹ä½å½±å“
                this.baguaEffects = {
                    'qian': { 
                        name: 'ä¹¾', 
                        element: 'é‡‘', 
                        effect: 'å¢å¼ºé¢†å¯¼åŠ›', 
                        bonus: { health: 2, energy: 3 },
                        guaci: 'ä¹¾ï¼šå…ƒäº¨åˆ©è´',
                        meaning: 'å¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯',
                        symbol: 'â˜°'
                    },
                    'kun': { 
                        name: 'å¤', 
                        element: 'åœŸ', 
                        effect: 'å¢å¼ºåŒ…å®¹åŠ›', 
                        bonus: { health: 4, energy: 1 },
                        guaci: 'å¤ï¼šå…ƒäº¨ï¼Œåˆ©ç‰é©¬ä¹‹è´',
                        meaning: 'åœ°åŠ¿å¤ï¼Œå›å­ä»¥åšå¾·è½½ç‰©',
                        symbol: 'â˜·'
                    },
                    'zhen': { 
                        name: 'éœ‡', 
                        element: 'æœ¨', 
                        effect: 'å¢å¼ºè¡ŒåŠ¨åŠ›', 
                        bonus: { health: 1, energy: 4 },
                        guaci: 'éœ‡ï¼šäº¨ï¼Œéœ‡æ¥è™©è™©',
                        meaning: 'é›·å£°éœ‡åŠ¨ï¼Œä¸‡ç‰©å¤è‹',
                        symbol: 'â˜³'
                    },
                    'xun': { 
                        name: 'å·½', 
                        element: 'æœ¨', 
                        effect: 'å¢å¼ºé€‚åº”åŠ›', 
                        bonus: { health: 2, energy: 3 },
                        guaci: 'å·½ï¼šå°äº¨ï¼Œåˆ©æœ‰æ”¸å¾€',
                        meaning: 'é£è¡Œå¤©ä¸‹ï¼Œæ— æ‰€ä¸å…¥',
                        symbol: 'â˜´'
                    },
                    'kan': { 
                        name: 'å', 
                        element: 'æ°´', 
                        effect: 'å¢å¼ºæ™ºæ…§åŠ›', 
                        bonus: { health: 1, energy: 5 },
                        guaci: 'åï¼šä¹ åï¼Œæœ‰å­š',
                        meaning: 'æ°´æµä¸æ¯ï¼Œæ™ºæ…§å¦‚æ¸Š',
                        symbol: 'â˜µ'
                    },
                    'li': { 
                        name: 'ç¦»', 
                        element: 'ç«', 
                        effect: 'å¢å¼ºæ´å¯ŸåŠ›', 
                        bonus: { health: 3, energy: 2 },
                        guaci: 'ç¦»ï¼šåˆ©è´ï¼Œäº¨',
                        meaning: 'ç«å…‰æ˜ç…§ï¼Œæ´å¯Ÿä¸‡ç‰©',
                        symbol: 'â˜²'
                    },
                    'gen': { 
                        name: 'è‰®', 
                        element: 'åœŸ', 
                        effect: 'å¢å¼ºç¨³å®šåŠ›', 
                        bonus: { health: 5, energy: 0 },
                        guaci: 'è‰®ï¼šè‰®å…¶èƒŒï¼Œä¸è·å…¶èº«',
                        meaning: 'å±±æ­¢å¦‚ç£ï¼Œç¨³é‡ä¸ç§»',
                        symbol: 'â˜¶'
                    },
                    'dui': { 
                        name: 'å…‘', 
                        element: 'é‡‘', 
                        effect: 'å¢å¼ºäº¤æµåŠ›', 
                        bonus: { health: 2, energy: 3 },
                        guaci: 'å…‘ï¼šäº¨ï¼Œåˆ©è´',
                        meaning: 'æ³½æ¶¦ä¸‡ç‰©ï¼Œå’Œæ‚¦äº¤æµ',
                        symbol: 'â˜±'
                    },
                    'center': { 
                        name: 'ä¸­å®«', 
                        element: 'åœŸ', 
                        effect: 'å¹³è¡¡è°ƒå’Œ', 
                        bonus: { health: 3, energy: 3 },
                        guaci: 'å¤ªæï¼šæ— æè€Œå¤ªæ',
                        meaning: 'é˜´é˜³è°ƒå’Œï¼Œä¸‡ç‰©ä¹‹æº',
                        symbol: 'â˜¯'
                    }
                };
                
                // æŠ€èƒ½ç³»ç»Ÿ
                this.selectedSkill = null;
                this.skillCosts = { move: 10, attack: 20, defend: 15, special: 30 };
                this.players = {
                    1: { 
                        name: 'ç©å®¶1 (äººç±»)', 
                        type: 'human', 
                        position: 'center', 
                        health: 100, 
                        energy: 50, 
                        status: 'æ­£å¸¸',
                        personality: {
                            name: 'å¹³è¡¡ä¿®è¡Œè€…',
                            symbol: 'ğŸ®',
                            traits: ['å¹³è¡¡', 'é€‚åº”', 'å…¨é¢'],
                            description: 'è¿½æ±‚é˜´é˜³å¹³è¡¡çš„ä¿®è¡Œè€…'
                        }
                    },
                    2: { 
                        name: 'AI-æ™ºè€…', 
                        type: 'ai', 
                        position: 'qian', 
                        health: 100, 
                        energy: 50, 
                        status: 'æ­£å¸¸',
                        personality: {
                            name: 'å¤©è¡Œæ™ºè€…',
                            symbol: 'ğŸ§ ',
                            traits: ['æ™ºæ…§', 'é¢†å¯¼', 'åˆšå¥'],
                            description: 'å¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯',
                            preferredActions: ['é«˜çº§æŠ€èƒ½', 'æ”»å‡»æŠ€èƒ½', 'é¢†å¯¼æŠ€èƒ½'],
                            avoidActions: ['é˜²å¾¡æŠ€èƒ½', 'æ¢å¤æŠ€èƒ½'],
                            riskTolerance: 0.8,
                            aggressiveness: 0.9
                        }
                    },
                    3: { 
                        name: 'AI-è´¤äºº', 
                        type: 'ai', 
                        position: 'kun', 
                        health: 100, 
                        energy: 50, 
                        status: 'æ­£å¸¸',
                        personality: {
                            name: 'åšå¾·è´¤è€…',
                            symbol: 'ğŸ’š',
                            traits: ['åŒ…å®¹', 'ç¨³é‡', 'å®ˆæŠ¤'],
                            description: 'åœ°åŠ¿å¤ï¼Œå›å­ä»¥åšå¾·è½½ç‰©',
                            preferredActions: ['é˜²å¾¡æŠ€èƒ½', 'æ¢å¤æŠ€èƒ½', 'è¾…åŠ©æŠ€èƒ½'],
                            avoidActions: ['æ”»å‡»æŠ€èƒ½', 'å†’é™©æŠ€èƒ½'],
                            riskTolerance: 0.3,
                            aggressiveness: 0.2
                        }
                    },
                    4: { 
                        name: 'AI-å­¦è€…', 
                        type: 'ai', 
                        position: 'zhen', 
                        health: 100, 
                        energy: 50, 
                        status: 'æ­£å¸¸',
                        personality: {
                            name: 'é›·åŠ¨å­¦è€…',
                            symbol: 'âš¡',
                            traits: ['æ•æ·', 'åˆ›æ–°', 'çªç ´'],
                            description: 'éœ‡ä¸ºé›·ï¼ŒåŠ¨è€Œæœ‰å¨',
                            preferredActions: ['ç§»åŠ¨æŠ€èƒ½', 'çªå‡»æŠ€èƒ½', 'å˜åŒ–æŠ€èƒ½'],
                            avoidActions: ['é™æ€æŠ€èƒ½', 'æŒç»­æŠ€èƒ½'],
                            riskTolerance: 0.7,
                            aggressiveness: 0.6
                        }
                    }
                };
                this.initializeGame();
            }

            initializeGame() {
                // åˆå§‹åŒ–å¡ç‰Œç³»ç»Ÿ
                CardInventory.init();
                PlayerHands.init();
                
                // ç«‹å³æ›´æ–°æ‰€æœ‰ç©å®¶çš„ä¿¡æ¯æ˜¾ç¤º
                for (let i = 1; i <= 4; i++) {
                    this.updatePlayerInfo(i);
                }
                this.updateDisplay();
                this.logAction(1, 'ğŸ® å¹³è¡¡ä¿®è¡Œè€…å·²å‡†å¤‡å°±ç»ªï¼Œæ‰‹ç‰Œï¼š' + PlayerHands.getHandSize('player1') + 'å¼ ');
                this.logAction(2, 'ğŸ§  æ™ºæ…§å­¦è€…å·²å‡†å¤‡å°±ç»ªï¼Œæ‰‹ç‰Œï¼š' + PlayerHands.getHandSize('player2') + 'å¼ ');
                this.logAction(3, 'ğŸ’š å…»ç”Ÿå¤§å¸ˆå·²å‡†å¤‡å°±ç»ª');
                this.logAction(4, 'âš¡ èƒ½é‡ä¸“å®¶å·²å‡†å¤‡å°±ç»ª');
                
                // æ˜¾ç¤ºå¡ç‰Œåº“å­˜ä¿¡æ¯
                this.logAction(1, `ğŸ“¦ å¡ç‰Œåº“å­˜ï¼šå‰©ä½™${CardInventory.getTotalRemaining()}å¼ ï¼Œå·²ç”¨${CardInventory.getTotalUsed()}å¼ `);
                
                // æ›´æ–°ç•Œé¢ä¸Šçš„å¡ç‰Œæ•°é‡æ˜¾ç¤º
                updateCardCounts();
            }

            startFourPlayerDemo() {
                if (this.isRunning) {
                    this.pauseGame();
                    return;
                }
                
                this.isRunning = true;
                this.gameState = 'playing';
                this.updateDisplay();
                this.logAction(this.currentPlayer, 'å››äººæ¼”ç¤ºå¼€å§‹ï¼');
                
                document.getElementById('start-demo-btn').textContent = 'åœæ­¢æ¼”ç¤º';
                document.getElementById('start-demo-btn').className = 'btn btn-danger';
                
                if (this.autoPlay) {
                    this.runAutoDemo();
                }
            }

            runAutoDemo() {
                if (!this.isRunning) return;
                
                const speed = this.demoSpeed === 'fast' ? 1000 : this.demoSpeed === 'slow' ? 3000 : 2000;
                
                setTimeout(() => {
                    this.nextTurn();
                    if (this.isRunning && this.autoPlay) {
                        this.runAutoDemo();
                    }
                }, speed);
            }

            nextTurn() {
                if (!this.isRunning) return;
                
                // æ‰§è¡Œå½“å‰ç©å®¶çš„è¡ŒåŠ¨
                this.executePlayerAction(this.currentPlayer);
                
                // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç©å®¶
                this.currentPlayer = this.currentPlayer % 4 + 1;
                
                // å¦‚æœå›åˆ°ç©å®¶1ï¼Œå¢åŠ å›åˆæ•°
                if (this.currentPlayer === 1) {
                    this.currentRound++;
                    
                    // æ¯3å›åˆå˜åŒ–å­£èŠ‚
                    if (this.currentRound % 3 === 0) {
                        this.currentSeason = (this.currentSeason + 1) % 4;
                        this.logAction(0, `å­£èŠ‚å˜åŒ–ï¼š${this.seasons[this.currentSeason]}`);
                    }
                    
                    // æ¯2å›åˆå˜åŒ–äº”è¡Œ
                    if (this.currentRound % 2 === 0) {
                        this.currentWuxing = (this.currentWuxing + 1) % 5;
                        this.logAction(0, `äº”è¡Œä¸»å¯¼å˜åŒ–ï¼š${this.wuxingElements[this.currentWuxing]}`);
                        this.updateWuxingDisplay();
                    }
                    
                    // æ¯å›åˆå¤©å¹²åœ°æ”¯å˜åŒ–
                    this.currentGanzhiIndex = (this.currentGanzhiIndex + 1) % 60;
                    
                    // æ¯4å›åˆèŠ‚æ°”å˜åŒ–
                    if (this.currentRound % 4 === 0) {
                        this.currentJieqiIndex = (this.currentJieqiIndex + 1) % 24;
                        this.logAction(0, `èŠ‚æ°”å˜åŒ–ï¼š${this.jieqi[this.currentJieqiIndex]}`);
                    }
                    
                    // æ¯2å›åˆé˜´é˜³å˜åŒ–
                    if (this.currentRound % 2 === 0) {
                        this.currentYinYang = (this.currentYinYang + 1) % 2;
                        this.logAction(0, `é˜´é˜³è½¬æ¢ï¼š${this.yinyang[this.currentYinYang]}æ—¶`);
                    }
                }
                
                this.updateDisplay();
                
                // æ£€æŸ¥æ¸¸æˆç»“æŸæ¡ä»¶
                const winner = this.checkVictoryConditions();
                if (winner) {
                    this.endGame(winner);
                } else if (this.currentRound > 40) {
                    // è¶…è¿‡40å›åˆï¼ŒæŒ‰åˆ†æ•°åˆ¤æ–­èƒœè´Ÿï¼ˆä»20å›åˆæå‡ï¼‰
                    this.endGame(this.determineWinnerByScore());
                }
            }

            executePlayerAction(playerId) {
                const player = this.players[playerId];
                const personality = player.personality;
                
                // åŸºäºæ€§æ ¼ç‰¹å¾çš„æ™ºèƒ½å†³ç­–ç³»ç»Ÿ
                let availableActions = [];
                
                // æ ¹æ®AIæ€§æ ¼ç‰¹å¾é€‰æ‹©è¡ŒåŠ¨åå¥½
                if (playerId === 2) { // å¤©è¡Œæ™ºè€… - æ”»å‡»å‹
                    availableActions = [
                        { name: 'ä¹¾å¦æ”»å‡»', cost: 40, type: 'attack', effect: 'å¼ºåŠ›æ”»å‡»', priority: 0.9 },
                        { name: 'å¤©é›·æ— å¦„', cost: 50, type: 'special', effect: 'é›·éœ†ä¸‡é’§', priority: 0.8 },
                        { name: 'é¾™æˆ˜äºé‡', cost: 60, type: 'ultimate', effect: 'ç»ˆææŠ€èƒ½', priority: 0.7 },
                        { name: 'å›å­è‡ªå¼º', cost: 30, type: 'buff', effect: 'è‡ªæˆ‘å¼ºåŒ–', priority: 0.6 },
                        { name: 'åŸºç¡€è°ƒæ¯', cost: 0, type: 'recover', effect: 'æ¢å¤èƒ½é‡', priority: 0.2 }
                    ];
                } else if (playerId === 3) { // åšå¾·è´¤è€… - é˜²å¾¡å‹
                    availableActions = [
                        { name: 'å¤å¾·è½½ç‰©', cost: 35, type: 'defense', effect: 'å¼ºåŒ–é˜²å¾¡', priority: 0.9 },
                        { name: 'åšå¾·æ²»ç–—', cost: 25, type: 'heal', effect: 'æ¢å¤ç”Ÿå‘½', priority: 0.8 },
                        { name: 'å¤§åœ°åº‡æŠ¤', cost: 45, type: 'shield', effect: 'æŠ¤ç›¾æŠ€èƒ½', priority: 0.7 },
                        { name: 'åŒ…å®¹ä¸‡ç‰©', cost: 20, type: 'support', effect: 'è¾…åŠ©æŠ€èƒ½', priority: 0.6 },
                        { name: 'åŸºç¡€è°ƒæ¯', cost: 0, type: 'recover', effect: 'æ¢å¤èƒ½é‡', priority: 0.5 }
                    ];
                } else if (playerId === 4) { // é›·åŠ¨å­¦è€… - æ•æ·å‹
                    availableActions = [
                        { name: 'éœ‡é›·ç–¾è¡Œ', cost: 30, type: 'move', effect: 'å¿«é€Ÿç§»åŠ¨', priority: 0.9 },
                        { name: 'é›·ç”µçªå‡»', cost: 35, type: 'rush', effect: 'çªå‡»æ”»å‡»', priority: 0.8 },
                        { name: 'ä¸‡ç‰©å¤è‹', cost: 40, type: 'change', effect: 'çŠ¶æ€å˜åŒ–', priority: 0.7 },
                        { name: 'éœ‡åŠ¨å…«æ–¹', cost: 25, type: 'aoe', effect: 'èŒƒå›´æŠ€èƒ½', priority: 0.6 },
                        { name: 'åŸºç¡€è°ƒæ¯', cost: 0, type: 'recover', effect: 'æ¢å¤èƒ½é‡', priority: 0.3 }
                    ];
                } else { // ç©å®¶1 - å¹³è¡¡å‹
                    availableActions = [
                        { name: 'å¤ªæå¹³è¡¡', cost: 35, type: 'balance', effect: 'å¹³è¡¡è°ƒå’Œ', priority: 0.7 },
                        { name: 'é˜´é˜³è°ƒå’Œ', cost: 30, type: 'harmony', effect: 'çŠ¶æ€è°ƒæ•´', priority: 0.6 },
                        { name: 'ä¸­åº¸ä¹‹é“', cost: 25, type: 'moderate', effect: 'ç¨³å¥å‘å±•', priority: 0.5 },
                        { name: 'åŸºç¡€è°ƒæ¯', cost: 0, type: 'recover', effect: 'æ¢å¤èƒ½é‡', priority: 0.4 }
                    ];
                }
                
                // æ™ºèƒ½å†³ç­–ï¼šæ ¹æ®å½“å‰çŠ¶æ€å’Œæ€§æ ¼ç‰¹å¾é€‰æ‹©æœ€ä½³è¡ŒåŠ¨
                let selectedAction = null;
                
                // ç­›é€‰å¯ç”¨è¡ŒåŠ¨ï¼ˆèƒ½é‡è¶³å¤Ÿï¼‰
                const affordableActions = availableActions.filter(action => player.energy >= action.cost);
                
                if (affordableActions.length === 0) {
                    // èƒ½é‡ä¸è¶³ï¼Œä½¿ç”¨åŸºç¡€è°ƒæ¯
                    selectedAction = { name: 'åŸºç¡€è°ƒæ¯', cost: 0, type: 'recover', effect: 'æ¢å¤èƒ½é‡' };
                } else {
                    // æ ¹æ®æ€§æ ¼ç‰¹å¾å’Œå½“å‰çŠ¶æ€è¿›è¡Œæ™ºèƒ½é€‰æ‹©
                    if (personality && personality.riskTolerance) {
                        // é«˜é£é™©å®¹å¿åº¦çš„AIæ›´å€¾å‘äºé€‰æ‹©é«˜æ¶ˆè€—æŠ€èƒ½
                        if (personality.riskTolerance > 0.7 && player.energy > 50) {
                            selectedAction = affordableActions.find(action => action.cost > 40) || affordableActions[0];
                        } else if (personality.riskTolerance < 0.4 && player.health < 60) {
                            // ä½é£é™©å®¹å¿åº¦ä¸”ç”Ÿå‘½å€¼ä½æ—¶ä¼˜å…ˆæ¢å¤
                            selectedAction = affordableActions.find(action => action.type === 'heal' || action.type === 'defense') || affordableActions[0];
                        } else {
                            // æ ¹æ®ä¼˜å…ˆçº§é€‰æ‹©
                            selectedAction = affordableActions.reduce((best, current) => 
                                current.priority > best.priority ? current : best
                            );
                        }
                    } else {
                        // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨è¡ŒåŠ¨
                        selectedAction = affordableActions[0];
                    }
                }
                
                // ä¸ºæ¯ä¸ªç©å®¶å®šä¹‰ä¸åŒçš„è¡Œä¸ºåå¥½å’ŒåŠ¨ä½œæ± ï¼ˆä¿æŒåŸæœ‰é€»è¾‘å…¼å®¹æ€§ï¼‰
                const playerActionPreferences = {
                    1: { // ç©å®¶1 - å¹³è¡¡å‹
                        actions: [
                            { name: 'ä¿®ç‚¼å†…åŠŸ', healthGain: 5, energyGain: 3, energyCost: 0, type: 'cultivation' },
                            { name: 'å‚æ‚Ÿå¤©æœº', healthGain: 3, energyGain: 5, energyCost: 3, type: 'wisdom' },
                            { name: 'è°ƒæ¯å…»ç¥', healthGain: 8, energyGain: 2, energyCost: 0, type: 'meditation' }
                        ],
                        personality: 'å¹³è¡¡ä¿®è¡Œè€…'
                    },
                    2: { // AIæ™ºè€… - æ™ºæ…§å‹
                        actions: [
                            { name: 'å‚æ‚Ÿå¤©æœº', healthGain: 3, energyGain: 5, energyCost: 3, type: 'wisdom' },
                            { name: 'ç ”è¯»å¤ç±', healthGain: 2, energyGain: 7, energyCost: 4, type: 'study' },
                            { name: 'æ¨æ¼”å¦è±¡', healthGain: 1, energyGain: 9, energyCost: 6, type: 'divination' },
                            { name: 'å†¥æƒ³æ‚Ÿé“', healthGain: 4, energyGain: 6, energyCost: 2, type: 'enlightenment' }
                        ],
                        personality: 'æ™ºæ…§å­¦è€…'
                    },
                    3: { // AIè´¤äºº - æ¢å¤å‹
                        actions: [
                            { name: 'è°ƒæ¯å…»ç¥', healthGain: 8, energyGain: 2, energyCost: 0, type: 'meditation' },
                            { name: 'ä¿®ç‚¼å†…åŠŸ', healthGain: 5, energyGain: 3, energyCost: 0, type: 'cultivation' },
                            { name: 'é™å¿ƒç–—ä¼¤', healthGain: 12, energyGain: 1, energyCost: 0, type: 'healing' },
                            { name: 'å¤ªæå…»ç”Ÿ', healthGain: 6, energyGain: 4, energyCost: 1, type: 'taiji' }
                        ],
                        personality: 'å…»ç”Ÿå¤§å¸ˆ'
                    },
                    4: { // AIå­¦è€… - èƒ½é‡å‹
                        actions: [
                            { name: 'ç»ƒæ°”åŒ–ç¥', healthGain: 2, energyGain: 8, energyCost: 5, type: 'energy' },
                            { name: 'æ–½å±•ç¥é€š', healthGain: 1, energyGain: 12, energyCost: 8, type: 'magic' },
                            { name: 'èšæ°”å‡ç¥', healthGain: 3, energyGain: 10, energyCost: 6, type: 'focus' },
                            { name: 'ç‚¼åŒ–çœŸå…ƒ', healthGain: 2, energyGain: 15, energyCost: 10, type: 'alchemy' }
                        ],
                        personality: 'èƒ½é‡ä¸“å®¶'
                    }
                };
                
                // ä½¿ç”¨æ–°çš„æ™ºèƒ½å†³ç­–ç³»ç»Ÿ
                const action = selectedAction ? {
                    name: selectedAction.name,
                    healthGain: selectedAction.type === 'heal' ? 15 : (selectedAction.type === 'defense' ? 5 : 3),
                    energyGain: selectedAction.type === 'recover' ? 20 : 2,
                    energyCost: selectedAction.cost,
                    type: selectedAction.type,
                    effect: selectedAction.effect
                } : { name: 'åŸºç¡€è°ƒæ¯', healthGain: 3, energyGain: 20, energyCost: 0, type: 'basic' };
                
                // ä¸ºæ¯ä¸ªç©å®¶æ·»åŠ ä¸ªæ€§åŒ–çš„è¡ŒåŠ¨å‰ç¼€
                const personalityPrefixes = {
                    1: 'ğŸ®',
                    2: 'ğŸ§ ',
                    3: 'ğŸ’š',
                    4: 'âš¡'
                };
                
                const positions = ['qian', 'kun', 'zhen', 'xun', 'kan', 'li', 'gen', 'dui', 'center'];
                
                // è®°å½•è¡ŒåŠ¨å‰çš„çŠ¶æ€
                const oldHealth = player.health;
                const oldEnergy = player.energy;
                const oldPosition = player.position;
                
                // æ‰§è¡Œè¡ŒåŠ¨æ•ˆæœ
                if (player.energy >= action.energyCost) {
                    player.health = Math.min(200, player.health + action.healthGain);
                    player.energy = Math.min(150, player.energy + action.energyGain - action.energyCost);
                    
                    // å­£èŠ‚åŠ æˆæ•ˆæœ
                    const seasonBonus = this.getSeasonBonus(action.name);
                    
                    // å…«å¦æ–¹ä½åŠ æˆæ•ˆæœ
                    const baguaBonus = this.baguaEffects[player.position]?.bonus || { health: 0, energy: 0 };
                    
                    // é˜´é˜³åŠ æˆï¼ˆé˜³æ—¶å¢å¼ºæ”»å‡»æ€§è¡ŒåŠ¨ï¼Œé˜´æ—¶å¢å¼ºæ¢å¤æ€§è¡ŒåŠ¨ï¼‰
                    const yinyangBonus = this.getYinYangBonus(action.name);
                    
                    const totalHealthGain = seasonBonus.health + baguaBonus.health + yinyangBonus.health;
                    const totalEnergyGain = seasonBonus.energy + baguaBonus.energy + yinyangBonus.energy;
                    
                    if (totalHealthGain > 0 || totalEnergyGain > 0) {
                        player.health = Math.min(200, player.health + totalHealthGain);
                        player.energy = Math.min(150, player.energy + totalEnergyGain);
                        
                        // è®°å½•åŠ æˆä¿¡æ¯
                        const bonuses = [];
                        if (seasonBonus.health > 0 || seasonBonus.energy > 0) {
                            bonuses.push(`${this.seasons[this.currentSeason]}å­£åŠ æˆ`);
                        }
                        if (baguaBonus.health > 0 || baguaBonus.energy > 0) {
                            bonuses.push(`${this.baguaEffects[player.position].name}ä½åŠ æˆ`);
                        }
                        if (yinyangBonus.health > 0 || yinyangBonus.energy > 0) {
                            bonuses.push(`${this.yinyang[this.currentYinYang]}æ—¶åŠ æˆ`);
                        }
                        
                        // ä½¿ç”¨æ–°çš„è¯¦ç»†æ—¥å¿—è®°å½•
                        const effects = [`ç”Ÿå‘½+${action.healthGain + totalHealthGain}`, `èƒ½é‡+${action.energyGain + totalEnergyGain}`];
                        this.logSkillUsage(playerId, action.name, action.energyCost, effects, bonuses);
                    } else {
                        const effects = [`ç”Ÿå‘½+${action.healthGain}`, `èƒ½é‡+${action.energyGain}`];
                        this.logSkillUsage(playerId, action.name, action.energyCost, effects);
                    }
                    
                    // è®°å½•çŠ¶æ€å˜åŒ–
                    if (player.health !== oldHealth) {
                        this.logStatusChange(playerId, 'health', oldHealth, player.health, action.name);
                    }
                    if (player.energy !== oldEnergy - action.energyCost + action.energyGain) {
                        this.logStatusChange(playerId, 'energy', oldEnergy, player.energy, action.name);
                    }
                } else {
                    // èƒ½é‡ä¸è¶³ï¼Œåªèƒ½è¿›è¡ŒåŸºç¡€æ¢å¤
                    const energyBefore = player.energy;
                    player.energy = Math.min(150, player.energy + 2);
                    this.logSkillUsage(playerId, 'åŸºç¡€è°ƒæ¯', 0, ['èƒ½é‡+2']);
                    this.logStatusChange(playerId, 'energy', energyBefore, player.energy, 'èƒ½é‡ä¸è¶³');
                }
                
                // åŸºäºæ€§æ ¼ç‰¹å¾çš„æ™ºèƒ½ç§»åŠ¨
                const shouldMove = Math.random() < (personality.riskTolerance / 10); // é£é™©å®¹å¿åº¦å½±å“ç§»åŠ¨é¢‘ç‡
                
                if (shouldMove) {
                    // æ ¹æ®æ€§æ ¼é€‰æ‹©åå¥½ä½ç½®
                    let preferredPositions = [];
                    if (personality.name === 'å¤©è¡Œæ™ºè€…') {
                        preferredPositions = ['qian', 'center']; // åå¥½ä¹¾ä½å’Œä¸­å®«
                    } else if (personality.name === 'åšå¾·è´¤è€…') {
                        preferredPositions = ['kun', 'gen']; // åå¥½å¤ä½å’Œè‰®ä½
                    } else if (personality.name === 'é›·åŠ¨å­¦è€…') {
                        preferredPositions = ['zhen', 'xun']; // åå¥½éœ‡ä½å’Œå·½ä½
                    } else {
                        preferredPositions = ['kan', 'li', 'dui']; // å¹³è¡¡ä¿®è¡Œè€…åå¥½å…¶ä»–ä½ç½®
                    }
                    
                    const availablePositions = preferredPositions.filter(pos => pos !== player.position);
                    if (availablePositions.length > 0) {
                        const newPosition = availablePositions[Math.floor(Math.random() * availablePositions.length)];
                        const effects = [`è·å¾—${this.baguaEffects[newPosition].name}ä½åŠ æˆ`];
                        this.logMovementAction(playerId, player.position, newPosition, effects);
                        player.position = newPosition;
                        this.movePlayerPiece(playerId, newPosition);
                    }
                }
                
                // åŸºäºæ€§æ ¼ç‰¹å¾çš„äº‹ä»¶å½±å“ï¼ˆæ¨¡æ‹Ÿä¸åŒæ€§æ ¼å¯¹ç¯å¢ƒçš„é€‚åº”æ€§ï¼‰
                const eventChance = Math.random();
                if (eventChance < 0.3) { // 30%æ¦‚ç‡å‘ç”Ÿäº‹ä»¶
                    let eventType = '';
                    let energyChange = 0;
                    let healthChange = 0;
                    
                    // æ ¹æ®æ€§æ ¼ç‰¹å¾ç¡®å®šäº‹ä»¶ç±»å‹å’Œå½±å“
                    if (personality.riskTolerance > 7) {
                        // é«˜é£é™©å®¹å¿åº¦ï¼šå¯èƒ½è·å¾—æ›´å¤§æ”¶ç›Šæˆ–æŸå¤±
                        eventType = 'å†’é™©äº‹ä»¶';
                        energyChange = Math.floor(Math.random() * 31) - 15; // -15åˆ°+15
                        healthChange = Math.floor(Math.random() * 21) - 10; // -10åˆ°+10
                    } else if (personality.riskTolerance < 4) {
                        // ä½é£é™©å®¹å¿åº¦ï¼šå˜åŒ–è¾ƒå°ä½†æ›´ç¨³å®š
                        eventType = 'ç¨³å¥äº‹ä»¶';
                        energyChange = Math.floor(Math.random() * 11) - 5; // -5åˆ°+5
                        healthChange = Math.floor(Math.random() * 7) - 3; // -3åˆ°+3
                    } else {
                        // ä¸­ç­‰é£é™©å®¹å¿åº¦ï¼šå¹³è¡¡çš„å˜åŒ–
                        eventType = 'å¹³è¡¡äº‹ä»¶';
                        energyChange = Math.floor(Math.random() * 21) - 10; // -10åˆ°+10
                        healthChange = Math.floor(Math.random() * 11) - 5; // -5åˆ°+5
                    }
                    
                    if (energyChange !== 0) {
                        const oldEnergyRandom = player.energy;
                        player.energy = Math.max(0, Math.min(150, player.energy + energyChange));
                        if (player.energy !== oldEnergyRandom) {
                            this.logStatusChange(playerId, 'energy', oldEnergyRandom, player.energy, eventType);
                        }
                    }
                    
                    if (healthChange !== 0) {
                        const oldHealthRandom = player.health;
                        player.health = Math.max(0, Math.min(200, player.health + healthChange));
                        if (player.health !== oldHealthRandom) {
                            this.logStatusChange(playerId, 'health', oldHealthRandom, player.health, eventType);
                        }
                    }
                }
                
                this.updatePlayerInfo(playerId);
            }

            movePlayerPiece(playerId, position) {
                const piece = document.getElementById(`player${playerId}-piece`);
                if (!piece) return;
                
                // ä¿®æ­£çš„ä¹å®«æ ¼ä½ç½®åæ ‡ï¼Œç¡®ä¿è§’è‰²åœ¨æ ¼å­å†…
                const positions = {
                    'center': { top: '50%', left: '50%' },
                    'qian': { top: '75%', left: '75%' },    // å³ä¸‹ - ä¹¾
                    'kun': { top: '25%', left: '75%' },     // å³ä¸Š - å¤  
                    'zhen': { top: '50%', left: '25%' },    // å·¦ä¸­ - éœ‡
                    'xun': { top: '25%', left: '25%' },     // å·¦ä¸Š - å·½
                    'kan': { top: '75%', left: '50%' },     // ä¸‹ä¸­ - å
                    'li': { top: '25%', left: '50%' },      // ä¸Šä¸­ - ç¦»
                    'gen': { top: '75%', left: '25%' },     // å·¦ä¸‹ - è‰®
                    'dui': { top: '50%', left: '75%' }      // å³ä¸­ - å…‘
                };
                
                if (positions[position]) {
                    // æ·»åŠ ç§»åŠ¨åŠ¨ç”»ç±»
                    piece.classList.add('moving');
                    
                    // è®¾ç½®æ–°ä½ç½®
                    piece.style.top = positions[position].top;
                    piece.style.left = positions[position].left;
                    piece.style.transform = 'translate(-50%, -50%)';
                    
                    // ç§»é™¤åŠ¨ç”»ç±»
                    setTimeout(() => {
                        piece.classList.remove('moving');
                    }, 600);
                    
                    // æ·»åŠ ä½ç½®å˜åŒ–çš„è§†è§‰æç¤º
                    const positionName = this.baguaEffects[position]?.name || position;
                    this.showMoveEffect(piece, `ç§»åŠ¨åˆ°${positionName}`);
                }
            }

            showMoveEffect(piece, text) {
                // åˆ›å»ºç§»åŠ¨æç¤ºæ–‡å­—
                const moveText = document.createElement('div');
                moveText.textContent = text;
                moveText.style.cssText = `
                    position: absolute;
                    top: -40px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    white-space: nowrap;
                    z-index: 1000;
                    animation: fadeInOut 2s ease-in-out;
                `;
                
                piece.appendChild(moveText);
                
                // 2ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    if (moveText.parentNode) {
                        moveText.parentNode.removeChild(moveText);
                    }
                }, 2000);
            }

            pauseGame() {
                this.isRunning = !this.isRunning;
                const btn = document.getElementById('start-demo-btn');
                if (this.isRunning) {
                    btn.textContent = 'åœæ­¢æ¼”ç¤º';
                    btn.className = 'btn btn-danger';
                    this.gameState = 'playing';
                    if (this.autoPlay) {
                        this.runAutoDemo();
                    }
                } else {
                    btn.textContent = 'ç»§ç»­æ¼”ç¤º';
                    btn.className = 'btn btn-success';
                    this.gameState = 'paused';
                }
                this.updateDisplay();
            }

            resetGame() {
                this.isRunning = false;
                this.currentPlayer = 1;
                this.currentRound = 1;
                this.gameState = 'ready';
                
                // é‡ç½®å¡ç‰Œç³»ç»Ÿ
                CardInventory.reset();
                PlayerHands.reset();
                
                // é‡ç½®ç©å®¶çŠ¶æ€
                Object.keys(this.players).forEach(id => {
                    this.players[id].health = 100;
                    this.players[id].energy = 50;
                    this.players[id].status = 'æ­£å¸¸';
                });
                
                // é‡ç½®ç©å®¶ä½ç½®
                this.movePlayerPiece(1, 'center');
                this.movePlayerPiece(2, 'qian');
                this.movePlayerPiece(3, 'kun');
                this.movePlayerPiece(4, 'zhen');
                
                // æ¸…ç©ºæ—¥å¿—
                for (let i = 1; i <= 4; i++) {
                    const log = document.getElementById(`player${i}-log`);
                    log.innerHTML = `<div class="log-title">${this.players[i].name} æ“ä½œè®°å½•</div>`;
                }
                
                document.getElementById('start-demo-btn').textContent = 'å¼€å§‹å››äººæ¼”ç¤º';
                document.getElementById('start-demo-btn').className = 'btn btn-success';
                
                this.updateDisplay();
                this.logAction(1, 'æ¸¸æˆå·²é‡ç½®');
            }

            setAutoPlay(auto) {
                this.autoPlay = auto;
                document.getElementById('auto-mode').textContent = auto ? 'å¼€å¯' : 'å…³é—­';
                if (auto && this.isRunning) {
                    this.runAutoDemo();
                }
            }

            changeSpeed(speed) {
                this.demoSpeed = speed;
                const speedText = speed === 'fast' ? 'å¿«é€Ÿ' : speed === 'slow' ? 'æ…¢é€Ÿ' : 'æ­£å¸¸';
                document.getElementById('demo-speed').textContent = speedText;
            }

            checkVictoryConditions() {
                // æ£€æŸ¥å„ç§èƒœåˆ©æ¡ä»¶ï¼ˆè°ƒæ•´åçš„å¹³è¡¡é˜ˆå€¼ï¼‰
                for (let playerId = 1; playerId <= 4; playerId++) {
                    const player = this.players[playerId];
                    
                    // ç”Ÿå‘½å€¼èƒœåˆ©ï¼šç”Ÿå‘½å€¼è¾¾åˆ°250ï¼ˆä»150æå‡ï¼‰
                    if (player.health >= 250) {
                        return { player: player, reason: 'ç”Ÿå‘½å€¼è¾¾åˆ°250ç‚¹', type: 'ç”Ÿå‘½èƒœåˆ©' };
                    }
                    
                    // èƒ½é‡èƒœåˆ©ï¼šèƒ½é‡è¾¾åˆ°200ï¼ˆä»100æå‡ï¼‰
                    if (player.energy >= 200) {
                        return { player: player, reason: 'èƒ½é‡è¾¾åˆ°200ç‚¹', type: 'èƒ½é‡èƒœåˆ©' };
                    }
                    
                    // é“è¡Œèƒœåˆ©ï¼šé“è¡Œè¾¾åˆ°180ï¼ˆä»100æå‡ï¼‰
                    const daoXing = this.calculateDaoXing(playerId);
                    if (daoXing >= 180) {
                        return { player: player, reason: `é“è¡Œè¾¾åˆ°${daoXing}ç‚¹`, type: 'é“è¡Œèƒœåˆ©' };
                    }
                }
                
                // æ£€æŸ¥æ·˜æ±°èƒœåˆ©ï¼šåªå‰©ä¸€ä¸ªç©å®¶ç”Ÿå‘½å€¼å¤§äº0
                const alivePlayers = Object.values(this.players).filter(p => p.health > 0);
                if (alivePlayers.length === 1) {
                    return { player: alivePlayers[0], reason: 'æœ€åå­˜æ´»è€…', type: 'ç”Ÿå­˜èƒœåˆ©' };
                }
                
                return null;
            }
            
            calculateDaoXing(playerId) {
                const player = this.players[playerId];
                // åŸºäºå¤šä¸ªå› ç´ è®¡ç®—é“è¡Œï¼ˆä¼˜åŒ–åçš„å¹³è¡¡å…¬å¼ï¼‰
                let daoXing = 0;
                
                // åŸºç¡€é“è¡Œï¼ˆé™ä½å›åˆå¢é•¿é€Ÿåº¦ï¼‰
                daoXing += Math.floor(this.currentRound * 0.8);
                
                // ç”Ÿå‘½å€¼åŠ æˆï¼ˆé™ä½å½±å“ï¼‰
                daoXing += Math.floor(player.health / 20);
                
                // èƒ½é‡åŠ æˆï¼ˆé™ä½å½±å“ï¼‰
                daoXing += Math.floor(player.energy / 10);
                
                // ä½ç½®åŠ æˆï¼ˆä¸­å¿ƒä½ç½®æœ‰é¢å¤–é“è¡Œï¼Œä½†é™ä½æ•°å€¼ï¼‰
                if (player.position === 'center') {
                    daoXing += 5;
                }
                
                // è¡ŒåŠ¨åŠ æˆï¼ˆåŸºäºç©å®¶å®é™…è¡ŒåŠ¨è·å¾—é“è¡Œï¼‰
                const actionBonus = this.calculateActionBonus(playerId);
                daoXing += actionBonus;
                
                // éšæœºä¿®è¡ŒåŠ æˆï¼ˆå‡å°‘éšæœºæ€§ï¼‰
                daoXing += Math.floor(Math.random() * 8);
                
                return Math.max(0, daoXing);
            }
            
            calculateActionBonus(playerId) {
                // åŸºäºç©å®¶è¡ŒåŠ¨è®¡ç®—é“è¡ŒåŠ æˆ
                let bonus = 0;
                const player = this.players[playerId];
                
                // æŠ€èƒ½ä½¿ç”¨åŠ æˆ
                if (player.lastAction && player.lastAction.includes('æŠ€èƒ½')) {
                    bonus += 2;
                }
                
                // ç§»åŠ¨ç­–ç•¥åŠ æˆ
                if (player.lastAction && player.lastAction.includes('ç§»åŠ¨')) {
                    bonus += 1;
                }
                
                // é˜²å¾¡ç­–ç•¥åŠ æˆ
                if (player.lastAction && player.lastAction.includes('é˜²å¾¡')) {
                    bonus += 1;
                }
                
                return bonus;
            }
            
            determineWinnerByScore() {
                let bestPlayer = null;
                let bestScore = -1;
                
                for (let playerId = 1; playerId <= 4; playerId++) {
                    const player = this.players[playerId];
                    const score = this.calculatePlayerScore(playerId);
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestPlayer = { player: player, reason: `ç»¼åˆå¾—åˆ†${bestScore}ç‚¹æœ€é«˜`, type: 'ç»¼åˆèƒœåˆ©', score: bestScore };
                    }
                }
                
                return bestPlayer;
            }
            
            calculatePlayerScore(playerId) {
                const player = this.players[playerId];
                let score = 0;
                
                // ç”Ÿå‘½å€¼å¾—åˆ†
                score += player.health;
                
                // èƒ½é‡å¾—åˆ†
                score += player.energy * 2;
                
                // é“è¡Œå¾—åˆ†
                score += this.calculateDaoXing(playerId);
                
                // ä½ç½®å¾—åˆ†
                const positionScores = {
                    'center': 20, 'qian': 15, 'kun': 15, 'zhen': 10, 
                    'xun': 10, 'kan': 10, 'li': 10, 'gen': 5, 'dui': 5
                };
                score += positionScores[player.position] || 0;
                
                return score;
            }

            endGame(winner = null) {
                this.isRunning = false;
                this.gameState = 'finished';
                this.updateDisplay();
                
                // æ·»åŠ èƒœåˆ©åŠ¨ç”»æ•ˆæœ
                this.showVictoryAnimation();
                
                if (winner) {
                    this.announceWinner(winner);
                } else {
                    this.logAction(0, 'æ¸¸æˆç»“æŸï¼å¹³å±€');
                }
                
                document.getElementById('start-demo-btn').textContent = 'æ¸¸æˆç»“æŸ';
                document.getElementById('start-demo-btn').className = 'btn btn-warning';
                document.getElementById('start-demo-btn').disabled = true;
                
                setTimeout(() => {
                    document.getElementById('start-demo-btn').disabled = false;
                    document.getElementById('start-demo-btn').textContent = 'å¼€å§‹æ–°æ¸¸æˆ';
                    document.getElementById('start-demo-btn').className = 'btn btn-success';
                }, 5000);
            }

            showVictoryAnimation() {
                // åˆ›å»ºèƒœåˆ©åŠ¨ç”»æ•ˆæœ
                const gameBoard = document.querySelector('.game-board');
                if (gameBoard) {
                    gameBoard.style.animation = 'victoryPulse 2s ease-in-out';
                    
                    // 2ç§’åç§»é™¤åŠ¨ç”»
                    setTimeout(() => {
                        gameBoard.style.animation = '';
                    }, 2000);
                }
                
                // æ·»åŠ çƒŸèŠ±æ•ˆæœ
                this.createFireworks();
            }

            createFireworks() {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const firework = document.createElement('div');
                        firework.style.position = 'fixed';
                        firework.style.width = '4px';
                        firework.style.height = '4px';
                        firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        firework.style.borderRadius = '50%';
                        firework.style.left = Math.random() * window.innerWidth + 'px';
                        firework.style.top = Math.random() * window.innerHeight + 'px';
                        firework.style.pointerEvents = 'none';
                        firework.style.zIndex = '9999';
                        firework.style.animation = 'firework 1.5s ease-out forwards';
                        
                        document.body.appendChild(firework);
                        
                        setTimeout(() => {
                            if (document.body.contains(firework)) {
                                document.body.removeChild(firework);
                            }
                        }, 1500);
                    }, i * 200);
                }
            }
            
            announceWinner(winner) {
                const message = `ğŸ‰ ${winner.player.name} è·å¾—èƒœåˆ©ï¼`;
                const reason = `ğŸ† èƒœåˆ©ç±»å‹ï¼š${winner.type}`;
                const detail = `ğŸ“Š èƒœåˆ©åŸå› ï¼š${winner.reason}`;
                
                this.logAction(0, message);
                this.logAction(0, reason);
                this.logAction(0, detail);
                
                // åœ¨æ¸¸æˆçŠ¶æ€ä¸­æ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
                document.getElementById('game-state').textContent = `${winner.player.name} ${winner.type}è·èƒœï¼`;
                document.getElementById('game-state').style.color = '#e74c3c';
                document.getElementById('game-state').style.fontWeight = 'bold';
                
                // æ˜¾ç¤ºè¯¦ç»†çš„èƒœåˆ©ç»Ÿè®¡
                this.showVictoryStats(winner);
            }
            
            showVictoryStats(winner) {
                const stats = [];
                stats.push(`ğŸ† èƒœåˆ©è€…ï¼š${winner.player.name}`);
                stats.push(`ğŸ¯ èƒœåˆ©ç±»å‹ï¼š${winner.type}`);
                stats.push(`ğŸ“ˆ èƒœåˆ©åŸå› ï¼š${winner.reason}`);
                stats.push(`â° æ¸¸æˆå›åˆï¼š${this.currentRound}`);
                stats.push(`ğŸŒ¸ å½“å‰å­£èŠ‚ï¼š${this.seasons[this.currentSeason]}`);
                stats.push(`âš¡ å½“å‰äº”è¡Œï¼š${this.wuxingElements[this.currentWuxing]}`);
                
                // æ˜¾ç¤ºæ‰€æœ‰ç©å®¶çš„æœ€ç»ˆçŠ¶æ€
                stats.push(`\nğŸ“Š æœ€ç»ˆçŠ¶æ€ï¼š`);
                for (let playerId = 1; playerId <= 4; playerId++) {
                    const player = this.players[playerId];
                    const score = this.calculatePlayerScore(playerId);
                    const daoXing = this.calculateDaoXing(playerId);
                    stats.push(`${player.name}: ç”Ÿå‘½${player.health} èƒ½é‡${player.energy} é“è¡Œ${daoXing} æ€»åˆ†${score}`);
                }
                
                // åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
                stats.forEach(stat => this.logAction(0, stat));
            }

            updateDisplay() {
                document.getElementById('current-round').textContent = this.currentRound;
                document.getElementById('current-player').textContent = this.players[this.currentPlayer].name;
                
                // å¢å¼ºå››å­£æ˜¾ç¤º
                const seasonElement = document.getElementById('current-season');
                const seasonIcons = ['ğŸŒ¸', 'â˜€ï¸', 'ğŸ‚', 'â„ï¸'];
                const seasonColors = ['#2ecc71', '#f39c12', '#e67e22', '#3498db'];
                seasonElement.innerHTML = `${seasonIcons[this.currentSeason]} ${this.seasons[this.currentSeason]}å­£`;
                seasonElement.style.color = seasonColors[this.currentSeason];
                seasonElement.style.fontWeight = 'bold';
                seasonElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.3)';
                
                // å¢å¼ºäº”è¡Œæ˜¾ç¤º
                const wuxingElement = document.getElementById('current-wuxing');
                const wuxingIcons = ['ğŸŒ³', 'ğŸ”¥', 'ğŸ”ï¸', 'âš¡', 'ğŸ’§'];
                const wuxingColors = ['#27ae60', '#e74c3c', '#f39c12', '#f1c40f', '#3498db'];
                wuxingElement.innerHTML = `${wuxingIcons[this.currentWuxing]} ${this.wuxingElements[this.currentWuxing]}`;
                wuxingElement.style.color = wuxingColors[this.currentWuxing];
                wuxingElement.style.fontWeight = 'bold';
                wuxingElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.3)';
                document.getElementById('game-state').textContent = this.getGameStateText();
                document.getElementById('current-phase').textContent = this.getPhaseText();
                document.getElementById('total-rounds').textContent = this.currentRound - 1;
                
                // æ›´æ–°å¤©å¹²åœ°æ”¯å’ŒèŠ‚æ°”æ˜¾ç¤º
                const ganzhiText = this.tiangan[this.currentGanzhiIndex % 10] + this.dizhi[this.currentGanzhiIndex % 12];
                const ganzhiElement = document.getElementById('current-ganzhi');
                ganzhiElement.innerHTML = `ğŸ“… ${ganzhiText}`;
                ganzhiElement.style.color = '#8e44ad';
                ganzhiElement.style.fontWeight = 'bold';
                
                const jieqiElement = document.getElementById('current-jieqi');
                jieqiElement.innerHTML = `ğŸŒ™ ${this.jieqi[this.currentJieqiIndex]}`;
                jieqiElement.style.color = '#34495e';
                jieqiElement.style.fontWeight = 'bold';
                
                // æ›´æ–°é˜´é˜³æ˜¾ç¤º
                const yinyangElement = document.getElementById('current-yinyang');
                const yinyangIcons = ['â˜€ï¸', 'ğŸŒ™'];
                const yinyangColors = ['#f39c12', '#34495e'];
                yinyangElement.innerHTML = `${yinyangIcons[this.currentYinYang]} ${this.yinyang[this.currentYinYang]}`;
                yinyangElement.style.color = yinyangColors[this.currentYinYang];
                yinyangElement.style.fontWeight = 'bold';
                yinyangElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.3)';
                
                // æ›´æ–°ç©å®¶ä¿¡æ¯é¢æ¿çš„æ´»è·ƒçŠ¶æ€
                for (let i = 1; i <= 4; i++) {
                    const info = document.getElementById(`player${i}-info`);
                    const log = document.getElementById(`player${i}-log`);
                    if (i === this.currentPlayer) {
                        info.classList.add('active');
                        log.classList.add('active');
                    } else {
                        info.classList.remove('active');
                        log.classList.remove('active');
                    }
                    this.updatePlayerInfo(i);
                }
            }

            updateWuxingDisplay() {
                const wuxingElement = document.getElementById('current-wuxing');
                wuxingElement.style.color = this.wuxingColors[this.currentWuxing];
                wuxingElement.style.textShadow = `0 0 10px ${this.wuxingColors[this.currentWuxing]}`;
            }

            updatePlayerInfo(playerId) {
                const player = this.players[playerId];
                document.getElementById(`p${playerId}-health`).textContent = player.health;
                document.getElementById(`p${playerId}-energy`).textContent = player.energy;
                document.getElementById(`p${playerId}-position`).textContent = this.getPositionName(player.position);
                document.getElementById(`p${playerId}-status`).textContent = player.status;
            }

            getPositionName(position) {
                const names = {
                    'center': 'ä¸­å¿ƒ',
                    'qian': 'ä¹¾',
                    'kun': 'å¤',
                    'zhen': 'éœ‡',
                    'xun': 'å·½',
                    'kan': 'å',
                    'li': 'ç¦»',
                    'gen': 'è‰®',
                    'dui': 'å…‘'
                };
                return names[position] || position;
            }

            getGameStateText() {
                const states = {
                    'ready': 'å‡†å¤‡ä¸­',
                    'playing': 'è¿›è¡Œä¸­',
                    'paused': 'å·²æš‚åœ',
                    'finished': 'å·²ç»“æŸ'
                };
                return states[this.gameState] || this.gameState;
            }

            getPhaseText() {
                if (this.gameState === 'ready') return 'å‡†å¤‡é˜¶æ®µ';
                if (this.gameState === 'finished') return 'ç»“æŸé˜¶æ®µ';
                if (this.currentRound <= 3) return 'å¼€å±€é˜¶æ®µ';
                if (this.currentRound <= 7) return 'ä¸­å±€é˜¶æ®µ';
                return 'ç»ˆå±€é˜¶æ®µ';
            }

            getSeasonBonus(actionName) {
                const seasonBonuses = {
                    0: { // æ˜¥å­£ - ç”Ÿæœºå‹ƒå‹ƒï¼Œæ¢å¤åŠ æˆ
                        'ä¿®ç‚¼å†…åŠŸ': { health: 3, energy: 1 },
                        'è°ƒæ¯å…»ç¥': { health: 4, energy: 1 },
                        'å†¥æƒ³æ‚Ÿé“': { health: 2, energy: 2 }
                    },
                    1: { // å¤å­£ - é˜³æ°”æ—ºç››ï¼Œèƒ½é‡åŠ æˆ
                        'ç»ƒæ°”åŒ–ç¥': { health: 1, energy: 4 },
                        'æ–½å±•ç¥é€š': { health: 0, energy: 5 },
                        'å‚æ‚Ÿå¤©æœº': { health: 1, energy: 3 }
                    },
                    2: { // ç§‹å­£ - æ”¶è·å­£èŠ‚ï¼Œå¹³è¡¡å‘å±•
                        'å‚æ‚Ÿå¤©æœº': { health: 2, energy: 3 },
                        'å†¥æƒ³æ‚Ÿé“': { health: 3, energy: 2 },
                        'ä¿®ç‚¼å†…åŠŸ': { health: 2, energy: 2 }
                    },
                    3: { // å†¬å­£ - è›°ä¼å…»ç²¾ï¼Œå†…åŠŸåŠ æˆ
                        'ä¿®ç‚¼å†…åŠŸ': { health: 5, energy: 0 },
                        'è°ƒæ¯å…»ç¥': { health: 6, energy: 0 },
                        'å†¥æƒ³æ‚Ÿé“': { health: 4, energy: 1 }
                    }
                };
                
                const currentSeasonBonuses = seasonBonuses[this.currentSeason] || {};
                return currentSeasonBonuses[actionName] || { health: 0, energy: 0 };
            }

            getYinYangBonus(actionName) {
                const yinyangBonuses = {
                    0: { // é˜³æ—¶ - å¢å¼ºä¸»åŠ¨æ€§è¡ŒåŠ¨
                        'ç»ƒæ°”åŒ–ç¥': { health: 1, energy: 2 },
                        'æ–½å±•ç¥é€š': { health: 0, energy: 3 },
                        'å‚æ‚Ÿå¤©æœº': { health: 1, energy: 2 }
                    },
                    1: { // é˜´æ—¶ - å¢å¼ºæ¢å¤æ€§è¡ŒåŠ¨
                        'ä¿®ç‚¼å†…åŠŸ': { health: 2, energy: 1 },
                        'è°ƒæ¯å…»ç¥': { health: 3, energy: 1 },
                        'å†¥æƒ³æ‚Ÿé“': { health: 2, energy: 2 }
                    }
                };
                
                const currentYinYangBonuses = yinyangBonuses[this.currentYinYang] || {};
                return currentYinYangBonuses[actionName] || { health: 0, energy: 0 };
            }

            logAction(playerId, action) {
                // åªå‘æŒ‡å®šç©å®¶çš„æ—¥å¿—ä¸­æ·»åŠ è®°å½•
                if (playerId >= 1 && playerId <= 4) {
                    this.addLogEntry(playerId, action, false);
                } else if (playerId === 0) {
                    // ç³»ç»Ÿæ¶ˆæ¯åªæ˜¾ç¤ºåœ¨å½“å‰ç©å®¶çš„è®°å½•ä¸­ï¼Œé¿å…é‡å¤
                    this.addLogEntry(this.currentPlayer, action, true);
                }
            }

            // å¢å¼ºçš„æˆ˜æ–—æ—¥å¿—è®°å½•æ–¹æ³•
            logCombatAction(attackerId, targetId, skillName, damage, effects = []) {
                const attacker = this.players[attackerId];
                const target = targetId ? this.players[targetId] : null;
                const attackerName = attacker ? attacker.name : `ç©å®¶${attackerId}`;
                const targetName = target ? target.name : (targetId ? `ç©å®¶${targetId}` : 'æ‰€æœ‰æ•Œäºº');
                
                let message = `ğŸ—¡ï¸ ${attackerName} å¯¹ ${targetName} ä½¿ç”¨äº†ã€${skillName}ã€‘`;
                
                if (damage > 0) {
                    message += `ï¼Œé€ æˆ ${damage} ç‚¹ä¼¤å®³`;
                }
                
                if (effects && effects.length > 0) {
                    message += `ï¼Œäº§ç”Ÿæ•ˆæœï¼š${effects.join('ã€')}`;
                }
                
                // è®°å½•åˆ°æ‰€æœ‰ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(0, message);
                
                // å¦‚æœæœ‰ç›®æ ‡ï¼Œè®°å½•ç›®æ ‡çš„çŠ¶æ€å˜åŒ–
                if (target && damage > 0) {
                    const healthAfter = target.health;
                    this.logAction(0, `ğŸ’” ${targetName} ç”Ÿå‘½å€¼ï¼š${healthAfter + damage} â†’ ${healthAfter}`);
                }
            }

            // è®°å½•æŠ€èƒ½ä½¿ç”¨è¯¦æƒ…
            logSkillUsage(playerId, skillName, energyCost, effects = [], bonuses = []) {
                const player = this.players[playerId];
                const playerName = player ? player.name : `ç©å®¶${playerId}`;
                
                // ä¸ªæ€§åŒ–å‰ç¼€
                const personalityPrefixes = {
                    1: 'ğŸ®',
                    2: 'ğŸ§ ', 
                    3: 'ğŸ’š',
                    4: 'âš¡'
                };
                
                const prefix = personalityPrefixes[playerId] || 'âœ¨';
                let message = `${prefix} ${playerName} ä½¿ç”¨æŠ€èƒ½ã€${skillName}ã€‘`;
                
                // æ·»åŠ ä½¿ç”¨åŸå› åˆ†æ
                const reason = this.getSkillUsageReason(player, skillName, energyCost);
                if (reason) {
                    message += ` (${reason})`;
                }
                
                if (energyCost > 0) {
                    message += `ï¼Œæ¶ˆè€— ${energyCost} èƒ½é‡`;
                }
                
                if (effects && effects.length > 0) {
                    message += `ï¼Œäº§ç”Ÿæ•ˆæœï¼š${effects.join('ã€')}`;
                }
                
                if (bonuses && bonuses.length > 0) {
                    message += `ï¼Œè·å¾—åŠ æˆï¼š${bonuses.join('ã€')}`;
                }
                
                // è®°å½•åˆ°å¯¹åº”ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(playerId, message);
                
                // è®°å½•è¯¦ç»†çš„èƒ½é‡å˜åŒ–åŸå› 
                if (energyCost > 0 && player) {
                    const energyBefore = player.energy + energyCost;
                    const energyAfter = player.energy;
                    this.logAction(playerId, `âš¡ èƒ½é‡å˜åŒ–ï¼š${energyBefore} â†’ ${energyAfter} (æŠ€èƒ½æ¶ˆè€—)`);
                }
            }

            // è·å–æŠ€èƒ½ä½¿ç”¨åŸå› 
            getSkillUsageReason(player, skillName, energyCost) {
                if (!player) return '';
                
                const reasons = [];
                
                // åˆ†æç”Ÿå‘½å€¼çŠ¶å†µ
                if (player.health < 30) {
                    reasons.push('ç”Ÿå‘½å€¼è¾ƒä½');
                } else if (player.health > 80) {
                    reasons.push('ç”Ÿå‘½å€¼å……è¶³');
                }
                
                // åˆ†æèƒ½é‡çŠ¶å†µ
                if (player.energy < 20) {
                    reasons.push('èƒ½é‡ä¸è¶³');
                } else if (player.energy > 70) {
                    reasons.push('èƒ½é‡å……æ²›');
                }
                
                // åˆ†ææŠ€èƒ½ç±»å‹
                if (skillName.includes('æ¢å¤') || skillName.includes('è°ƒæ¯')) {
                    reasons.push('æ¢å¤çŠ¶æ€');
                } else if (skillName.includes('æ”»å‡»') || skillName.includes('ä¼¤å®³')) {
                    reasons.push('ä¸»åŠ¨æ”»å‡»');
                } else if (skillName.includes('é˜²å¾¡') || skillName.includes('æŠ¤ç›¾')) {
                    reasons.push('é˜²å¾¡ç­–ç•¥');
                }
                
                return reasons.length > 0 ? reasons.join('ï¼Œ') : '';
            }

            // è®°å½•ä½ç½®ç§»åŠ¨å’Œæ•ˆæœ
            logMovementAction(playerId, fromPosition, toPosition, effects = []) {
                const player = this.players[playerId];
                const playerName = player ? player.name : `ç©å®¶${playerId}`;
                const fromName = this.getPositionName(fromPosition);
                const toName = this.getPositionName(toPosition);
                
                // ä¸ªæ€§åŒ–å‰ç¼€
                const personalityPrefixes = {
                    1: 'ğŸ®',
                    2: 'ğŸ§ ', 
                    3: 'ğŸ’š',
                    4: 'âš¡'
                };
                
                const prefix = personalityPrefixes[playerId] || 'ğŸš¶';
                let message = `${prefix} ${playerName} ä»ã€${fromName}ã€‘ç§»åŠ¨åˆ°ã€${toName}ã€‘`;
                
                // æ·»åŠ ç§»åŠ¨åŸå› åˆ†æ
                const moveReason = this.getMovementReason(player, fromPosition, toPosition);
                if (moveReason) {
                    message += ` (${moveReason})`;
                }
                
                if (effects && effects.length > 0) {
                    message += `ï¼Œè§¦å‘æ•ˆæœï¼š${effects.join('ã€')}`;
                }
                
                // è®°å½•åˆ°å¯¹åº”ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(playerId, message);
                
                // è®°å½•ä½ç½®å±æ€§å˜åŒ–
                this.logPositionBenefits(playerId, toPosition);
            }

            // è·å–ç§»åŠ¨åŸå› 
            getMovementReason(player, fromPos, toPos) {
                if (!player) return '';
                
                const reasons = [];
                
                // åˆ†æä½ç½®å±æ€§
                const positionData = {
                    'qian': { element: 'é‡‘', direction: 'è¥¿åŒ—', benefit: 'é¢†å¯¼åŠ›' },
                    'kun': { element: 'åœŸ', direction: 'è¥¿å—', benefit: 'åŒ…å®¹åŠ›' },
                    'zhen': { element: 'æœ¨', direction: 'ä¸œ', benefit: 'è¡ŒåŠ¨åŠ›' },
                    'xun': { element: 'æœ¨', direction: 'ä¸œå—', benefit: 'æ¸—é€åŠ›' },
                    'kan': { element: 'æ°´', direction: 'åŒ—', benefit: 'æ™ºæ…§åŠ›' },
                    'li': { element: 'ç«', direction: 'å—', benefit: 'æ´å¯ŸåŠ›' },
                    'gen': { element: 'åœŸ', direction: 'ä¸œåŒ—', benefit: 'ç¨³å®šåŠ›' },
                    'dui': { element: 'é‡‘', direction: 'è¥¿', benefit: 'äº¤æµåŠ›' }
                };
                
                const toData = positionData[toPos];
                if (toData) {
                    // æ ¹æ®ç©å®¶çŠ¶æ€åˆ†æç§»åŠ¨åŸå› 
                    if (player.health < 50 && toData.element === 'åœŸ') {
                        reasons.push('å¯»æ±‚ç¨³å®šæ¢å¤');
                    } else if (player.energy < 30 && toData.element === 'æ°´') {
                        reasons.push('è¡¥å……æ™ºæ…§èƒ½é‡');
                    } else if (toData.element === 'ç«') {
                        reasons.push('å¢å¼ºæ´å¯ŸåŠ›');
                    } else if (toData.element === 'æœ¨') {
                        reasons.push('æå‡è¡ŒåŠ¨åŠ›');
                    } else if (toData.element === 'é‡‘') {
                        reasons.push('å¼ºåŒ–å†³ç­–åŠ›');
                    }
                }
                
                return reasons.length > 0 ? reasons.join('ï¼Œ') : 'æˆ˜ç•¥è°ƒæ•´';
            }

            // è®°å½•ä½ç½®æ”¶ç›Š
            logPositionBenefits(playerId, position) {
                const positionData = {
                    'qian': { element: 'é‡‘', direction: 'è¥¿åŒ—', benefit: 'é¢†å¯¼åŠ›+2' },
                    'kun': { element: 'åœŸ', direction: 'è¥¿å—', benefit: 'åŒ…å®¹åŠ›+2' },
                    'zhen': { element: 'æœ¨', direction: 'ä¸œ', benefit: 'è¡ŒåŠ¨åŠ›+2' },
                    'xun': { element: 'æœ¨', direction: 'ä¸œå—', benefit: 'æ¸—é€åŠ›+2' },
                    'kan': { element: 'æ°´', direction: 'åŒ—', benefit: 'æ™ºæ…§åŠ›+2' },
                    'li': { element: 'ç«', direction: 'å—', benefit: 'æ´å¯ŸåŠ›+2' },
                    'gen': { element: 'åœŸ', direction: 'ä¸œåŒ—', benefit: 'ç¨³å®šåŠ›+2' },
                    'dui': { element: 'é‡‘', direction: 'è¥¿', benefit: 'äº¤æµåŠ›+2' }
                };
                
                const data = positionData[position];
                if (data) {
                    this.logAction(playerId, `ğŸ“ ä½ç½®æ”¶ç›Šï¼š${data.element}å±æ€§ ${data.direction}æ–¹ä½ è·å¾—${data.benefit}`);
                }
            }

            // è®°å½•çŠ¶æ€å˜åŒ–
            logStatusChange(playerId, statusType, oldValue, newValue, reason = '') {
                const player = this.players[playerId];
                const playerName = player ? player.name : `ç©å®¶${playerId}`;
                
                const statusIcons = {
                    'health': 'â¤ï¸',
                    'energy': 'âš¡',
                    'dao': 'ğŸŒŸ',
                    'position': 'ğŸ“'
                };
                
                const icon = statusIcons[statusType] || 'ğŸ“Š';
                const change = newValue - oldValue;
                const changeText = change > 0 ? `+${change}` : `${change}`;
                
                let message = `${icon} ${playerName} ${this.getStatusName(statusType)}å˜åŒ–ï¼š${oldValue} â†’ ${newValue} (${changeText})`;
                
                // æ·»åŠ è¯¦ç»†çš„å˜åŒ–åŸå› 
                const detailedReason = this.getDetailedChangeReason(statusType, change, reason);
                if (detailedReason) {
                    message += ` - ${detailedReason}`;
                }
                
                // æ·»åŠ çŠ¶æ€è¯„ä¼°
                const statusAssessment = this.getStatusAssessment(statusType, newValue);
                if (statusAssessment) {
                    message += ` [${statusAssessment}]`;
                }
                
                // è®°å½•åˆ°å¯¹åº”ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(playerId, message);
            }

            // è·å–è¯¦ç»†çš„å˜åŒ–åŸå› 
            getDetailedChangeReason(statusType, change, originalReason) {
                const reasons = [];
                
                if (originalReason) {
                    reasons.push(originalReason);
                }
                
                // æ ¹æ®çŠ¶æ€ç±»å‹å’Œå˜åŒ–é‡æ·»åŠ å…·ä½“åŸå› 
                if (statusType === 'health') {
                    if (change > 0) {
                        reasons.push('æ¢å¤æ•ˆæœ');
                    } else if (change < 0) {
                        reasons.push('å—åˆ°ä¼¤å®³');
                    }
                } else if (statusType === 'energy') {
                    if (change > 0) {
                        reasons.push('èƒ½é‡è¡¥å……');
                    } else if (change < 0) {
                        reasons.push('æŠ€èƒ½æ¶ˆè€—');
                    }
                } else if (statusType === 'dao') {
                    if (change > 0) {
                        reasons.push('ä¿®ä¸ºæå‡');
                    }
                }
                
                return reasons.join('ï¼Œ');
            }

            // è·å–çŠ¶æ€è¯„ä¼°
            getStatusAssessment(statusType, value) {
                if (statusType === 'health') {
                    if (value >= 80) return 'çŠ¶æ€è‰¯å¥½';
                    if (value >= 50) return 'çŠ¶æ€ä¸€èˆ¬';
                    if (value >= 20) return 'çŠ¶æ€è¾ƒå·®';
                    return 'å±é™©çŠ¶æ€';
                } else if (statusType === 'energy') {
                    if (value >= 70) return 'èƒ½é‡å……æ²›';
                    if (value >= 40) return 'èƒ½é‡é€‚ä¸­';
                    if (value >= 15) return 'èƒ½é‡ä¸è¶³';
                    return 'èƒ½é‡æ¯ç«­';
                }
                return '';
            }

            // è·å–çŠ¶æ€åç§°
            getStatusName(statusType) {
                const names = {
                    'health': 'ç”Ÿå‘½å€¼',
                    'energy': 'èƒ½é‡',
                    'dao': 'é“è¡Œ',
                    'position': 'ä½ç½®'
                };
                return names[statusType] || statusType;
            }

            // è®°å½•å¡ç‰Œé€‰æ‹©
            logCardSelection(playerId, skillType, player) {
                const playerName = player ? player.name : `ç©å®¶${playerId}`;
                const skillName = this.getSkillName(skillType);
                
                // ä¸ªæ€§åŒ–å‰ç¼€
                const personalityPrefixes = {
                    1: 'ğŸ®',
                    2: 'ğŸ§ ', 
                    3: 'ğŸ’š',
                    4: 'âš¡'
                };
                
                const prefix = personalityPrefixes[playerId] || 'ğŸ´';
                let message = `${prefix} ${playerName} é€‰æ‹©æŠ€èƒ½å¡ã€${skillName}ã€‘`;
                
                // åˆ†æé€‰æ‹©åŸå› 
                const selectionReason = this.getCardSelectionReason(player, skillType);
                if (selectionReason) {
                    message += ` (${selectionReason})`;
                }
                
                // æ·»åŠ å¡ç‰Œå±æ€§ä¿¡æ¯
                const cardInfo = this.getCardInfo(skillType);
                if (cardInfo) {
                    message += ` - ${cardInfo}`;
                }
                
                // è®°å½•åˆ°å¯¹åº”ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(playerId, message);
                
                // è®°å½•å‰©ä½™å¡ç‰Œæ•°é‡
                const remaining = cardInventory.getRemaining(skillType);
                this.logAction(playerId, `ğŸ“¦ å¡ç‰Œåº“å­˜ï¼š${skillName}å‰©ä½™ ${remaining} å¼ `);
            }

            // è·å–å¡ç‰Œé€‰æ‹©åŸå› 
            getCardSelectionReason(player, skillType) {
                if (!player) return '';
                
                const reasons = [];
                
                // æ ¹æ®ç©å®¶çŠ¶æ€åˆ†æé€‰æ‹©åŸå› 
                if (skillType === 'move') {
                    if (player.health < 50) {
                        reasons.push('å¯»æ±‚æœ‰åˆ©ä½ç½®');
                    } else {
                        reasons.push('æˆ˜ç•¥å¸ƒå±€');
                    }
                } else if (skillType === 'attack') {
                    if (player.energy > 60) {
                        reasons.push('èƒ½é‡å……è¶³ï¼Œä¸»åŠ¨å‡ºå‡»');
                    } else {
                        reasons.push('æˆ˜æœ¯éœ€è¦');
                    }
                } else if (skillType === 'defend') {
                    if (player.health < 40) {
                        reasons.push('ç”Ÿå‘½å€¼è¾ƒä½ï¼Œé˜²å¾¡ä¼˜å…ˆ');
                    } else {
                        reasons.push('ç¨³å¥ç­–ç•¥');
                    }
                } else if (skillType === 'special') {
                    if (player.energy > 70) {
                        reasons.push('èƒ½é‡å……æ²›ï¼Œä½¿ç”¨ç‰¹æŠ€');
                    } else {
                        reasons.push('å…³é”®æ—¶åˆ»');
                    }
                }
                
                return reasons.join('ï¼Œ');
            }

            // è®°å½•çœŸå®å¡ç‰Œä½¿ç”¨
            logRealCardUsage(playerId, card, player) {
                const playerName = player ? player.name : `ç©å®¶${playerId}`;
                
                // ä¸ªæ€§åŒ–å‰ç¼€
                const personalityPrefixes = {
                    1: 'ğŸ®',
                    2: 'ğŸ§ ', 
                    3: 'ğŸ’š',
                    4: 'âš¡'
                };
                
                const prefix = personalityPrefixes[playerId] || 'ğŸ´';
                let message = `${prefix} ${playerName} æ‰“å‡ºã€${card.name}ã€‘`;
                
                // æ·»åŠ å¡ç‰Œæ•ˆæœä¿¡æ¯
                if (card.effect) {
                    message += ` - ${card.effect}`;
                }
                
                // æ·»åŠ å¦è±¡ä¿¡æ¯
                if (card.gua) {
                    message += ` (${card.gua}å¦)`;
                }
                
                // è®°å½•åˆ°å¯¹åº”ç©å®¶çš„æ—¥å¿—ä¸­
                this.logAction(playerId, message);
                
                // è®°å½•æ‰‹ç‰ŒçŠ¶æ€
                const currentPlayerId = `player${playerId}`;
                const handSize = PlayerHands.getHandSize(currentPlayerId);
                this.logAction(playerId, `ğŸƒ å½“å‰æ‰‹ç‰Œï¼š${handSize}å¼ `);
            }

            // æ›´æ–°å¡ç‰Œåº“å­˜æ˜¾ç¤º
            updateCardInventoryDisplay() {
                // æ›´æ–°æ€»ä½“åº“å­˜ä¿¡æ¯
                const totalRemaining = CardInventory.getTotalRemaining();
                const totalUsed = CardInventory.getTotalUsed();
                
                // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºåº“å­˜ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ç›¸åº”çš„å…ƒç´ ï¼‰
                const inventoryElement = document.getElementById('card-inventory');
                if (inventoryElement) {
                    inventoryElement.innerHTML = `
                        <div class="inventory-info">
                            <h4>ğŸ“¦ å¡ç‰Œåº“å­˜</h4>
                            <p>å‰©ä½™ï¼š${totalRemaining}å¼ </p>
                            <p>å·²ç”¨ï¼š${totalUsed}å¼ </p>
                            <div class="type-breakdown">
                                <span>ç§»åŠ¨ï¼š${CardInventory.getRemaining('move')}å¼ </span>
                                <span>æ”»å‡»ï¼š${CardInventory.getRemaining('attack')}å¼ </span>
                                <span>é˜²å¾¡ï¼š${CardInventory.getRemaining('defend')}å¼ </span>
                                <span>ç‰¹æŠ€ï¼š${CardInventory.getRemaining('special')}å¼ </span>
                            </div>
                        </div>
                    `;
                }
                
                // è®°å½•åˆ°å½“å‰ç©å®¶æ—¥å¿—
                this.logAction(this.currentPlayer, `ğŸ“Š åº“å­˜æ›´æ–°ï¼šå‰©ä½™${totalRemaining}å¼ ï¼Œå·²ç”¨${totalUsed}å¼ `);
                
                // æ›´æ–°ç•Œé¢ä¸Šçš„å¡ç‰Œæ•°é‡æ˜¾ç¤º
                updateCardCounts();
            }

            // è·å–å¡ç‰Œä¿¡æ¯
            getCardInfo(skillType) {
                const cardData = {
                    'move': { cost: '10èƒ½é‡', effect: 'ä½ç½®ç§»åŠ¨+å±æ€§åŠ æˆ' },
                    'attack': { cost: '20èƒ½é‡', effect: 'é€ æˆä¼¤å®³+æˆ˜æ–—ä¼˜åŠ¿' },
                    'defend': { cost: '15èƒ½é‡', effect: 'é˜²å¾¡æå‡+çŠ¶æ€ä¿æŠ¤' },
                    'special': { cost: '30èƒ½é‡', effect: 'ç‰¹æ®Šæ•ˆæœ+å¼ºåŠ›åŠ æˆ' }
                };
                
                const data = cardData[skillType];
                if (data) {
                    return `æ¶ˆè€—${data.cost}ï¼Œ${data.effect}`;
                }
                return '';
            }

            // è·å–æŠ€èƒ½åç§°
            getSkillName(skillType) {
                const skillNames = {
                    'move': 'ç§»åŠ¨',
                    'attack': 'æ”»å‡»',
                    'defend': 'é˜²å¾¡',
                    'special': 'ç‰¹æŠ€'
                };
                return skillNames[skillType] || skillType;
            }

            // åœ¨å…«å¦åœ°å›¾ä¸Šæ˜¾ç¤ºå¡ç‰Œ
            showCardOnMap(skillType, position, duration = 2000) {
                const baguaContainer = document.querySelector('.bagua-container');
                if (!baguaContainer) return;

                // åˆ›å»ºå¡ç‰Œå…ƒç´ 
                const cardElement = document.createElement('div');
                cardElement.className = 'card-on-map';
                cardElement.setAttribute('data-skill', skillType);

                // è®¾ç½®å¡ç‰Œå†…å®¹
                const skillIcons = {
                    'move': 'ğŸš¶',
                    'attack': 'âš”ï¸',
                    'defend': 'ğŸ›¡ï¸',
                    'special': 'âœ¨'
                };

                const skillNames = {
                    'move': 'ç§»åŠ¨',
                    'attack': 'æ”»å‡»',
                    'defend': 'é˜²å¾¡',
                    'special': 'ç‰¹æŠ€'
                };

                cardElement.innerHTML = `
                    <div class="card-icon">${skillIcons[skillType] || 'ğŸ´'}</div>
                    <div class="card-name">${skillNames[skillType] || 'æŠ€èƒ½'}</div>
                `;

                // è·å–ç›®æ ‡ä½ç½®çš„åæ ‡
                const targetPosition = this.getPositionElement(position);
                if (!targetPosition) return;

                const rect = targetPosition.getBoundingClientRect();
                const containerRect = baguaContainer.getBoundingClientRect();

                // è®¾ç½®å¡ç‰Œä½ç½®ï¼ˆç›¸å¯¹äºå…«å¦å®¹å™¨ï¼‰
                cardElement.style.left = `${rect.left - containerRect.left + rect.width/2 - 30}px`;
                cardElement.style.top = `${rect.top - containerRect.top + rect.height/2 - 40}px`;

                // æ·»åŠ åˆ°å…«å¦å®¹å™¨
                baguaContainer.appendChild(cardElement);

                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    cardElement.classList.add('show');
                }, 50);

                // æ·»åŠ å…‰æ•ˆ
                this.addCardEffect(position);

                // è‡ªåŠ¨éšè—
                setTimeout(() => {
                    cardElement.classList.add('hide');
                    setTimeout(() => {
                        if (cardElement.parentNode) {
                            cardElement.parentNode.removeChild(cardElement);
                        }
                    }, 300);
                }, duration);
            }

            // æ·»åŠ å¡ç‰Œä½¿ç”¨å…‰æ•ˆ
            addCardEffect(position) {
                const baguaContainer = document.querySelector('.bagua-container');
                const targetPosition = this.getPositionElement(position);
                if (!baguaContainer || !targetPosition) return;

                const effectElement = document.createElement('div');
                effectElement.className = 'card-effect';

                const rect = targetPosition.getBoundingClientRect();
                const containerRect = baguaContainer.getBoundingClientRect();

                effectElement.style.left = `${rect.left - containerRect.left + rect.width/2 - 50}px`;
                effectElement.style.top = `${rect.top - containerRect.top + rect.height/2 - 50}px`;

                baguaContainer.appendChild(effectElement);

                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (effectElement.parentNode) {
                        effectElement.parentNode.removeChild(effectElement);
                    }
                }, 1000);
            }

            // è·å–ä½ç½®å¯¹åº”çš„DOMå…ƒç´ 
            getPositionElement(position) {
                // æ”¯æŒæ•°å­—å’Œå­—ç¬¦ä¸²ä½ç½®
                const positionMap = {
                    // æ•°å­—ä½ç½®æ˜ å°„
                    0: '.bagua-position[data-position="center"]', // ä¸­å¿ƒ
                    1: '.bagua-position[data-position="xun"]',    // å·½
                    2: '.bagua-position[data-position="li"]',     // ç¦»
                    3: '.bagua-position[data-position="kun"]',    // å¤
                    4: '.bagua-position[data-position="dui"]',    // å…‘
                    5: '.bagua-position[data-position="qian"]',   // ä¹¾
                    6: '.bagua-position[data-position="kan"]',    // å
                    7: '.bagua-position[data-position="gen"]',    // è‰®
                    8: '.bagua-position[data-position="zhen"]',   // éœ‡
                    // å­—ç¬¦ä¸²ä½ç½®æ˜ å°„
                    'center': '.bagua-position[data-position="center"]',
                    'xun': '.bagua-position[data-position="xun"]',
                    'li': '.bagua-position[data-position="li"]',
                    'kun': '.bagua-position[data-position="kun"]',
                    'dui': '.bagua-position[data-position="dui"]',
                    'qian': '.bagua-position[data-position="qian"]',
                    'kan': '.bagua-position[data-position="kan"]',
                    'gen': '.bagua-position[data-position="gen"]',
                    'zhen': '.bagua-position[data-position="zhen"]'
                };

                const selector = positionMap[position];
                return selector ? document.querySelector(selector) : null;
            }

            addLogEntry(playerId, action, isSystem = false, logType = 'default') {
                const log = document.getElementById(`player${playerId}-log`);
                const entry = document.createElement('div');
                
                // ç¡®å®šæ—¥å¿—ç±»å‹
                let entryType = 'default';
                if (isSystem) {
                    entryType = 'system';
                } else if (action.includes('âš¡') && (action.includes('ä½¿ç”¨') || action.includes('æŠ€èƒ½'))) {
                    entryType = 'skill';
                } else if (action.includes('â¤ï¸') || action.includes('âš¡') || action.includes('ğŸ“Š')) {
                    entryType = 'status';
                    if (action.includes('â†’') && action.includes('-')) {
                        entryType += ' negative';
                    }
                } else if (action.includes('ğŸš¶') || action.includes('ç§»åŠ¨')) {
                    entryType = 'movement';
                } else if (action.includes('âš”ï¸') || action.includes('æ”»å‡»') || action.includes('ä¼¤å®³')) {
                    entryType = 'combat';
                } else if (action.includes('ğŸ”§') || action.includes('ç³»ç»Ÿ')) {
                    entryType = 'system';
                }
                
                // è®¾ç½®åŸºç¡€ç±»å
                entry.className = `log-entry ${entryType} recent new`;
                
                // åˆ›å»ºç»“æ„åŒ–å†…å®¹
                const timeSpan = document.createElement('span');
                timeSpan.className = 'log-time';
                timeSpan.textContent = new Date().toLocaleTimeString();
                
                const contentSpan = document.createElement('span');
                contentSpan.className = 'log-content';
                
                // æ ¹æ®ç±»å‹æ ¼å¼åŒ–å†…å®¹
                if (entryType === 'skill') {
                    this.formatSkillLog(contentSpan, action);
                } else if (entryType.includes('status')) {
                    this.formatStatusLog(contentSpan, action);
                } else if (entryType === 'movement') {
                    this.formatMovementLog(contentSpan, action);
                } else if (entryType === 'combat') {
                    this.formatCombatLog(contentSpan, action);
                } else {
                    contentSpan.textContent = action;
                }
                
                entry.appendChild(timeSpan);
                entry.appendChild(document.createTextNode(': '));
                entry.appendChild(contentSpan);
                
                // ç§»é™¤ä¹‹å‰çš„recentç±»
                const oldRecent = log.querySelector('.log-entry.recent');
                if (oldRecent && oldRecent !== entry) {
                    oldRecent.classList.remove('recent');
                }
                
                log.appendChild(entry);
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    entry.classList.remove('new');
                }, 300);
                
                // ä¿æŒæ—¥å¿—æ»šåŠ¨åˆ°åº•éƒ¨
                log.scrollTop = log.scrollHeight;
                
                // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
                const entries = log.querySelectorAll('.log-entry');
                if (entries.length > 12) {
                    entries[0].remove();
                }
            }

            // æ ¼å¼åŒ–æŠ€èƒ½æ—¥å¿—
            formatSkillLog(container, action) {
                const parts = action.split('ï¼ˆ');
                if (parts.length > 1) {
                    const skillPart = parts[0];
                    const effectPart = parts[1].replace('ï¼‰', '');
                    
                    const skillSpan = document.createElement('span');
                    skillSpan.className = 'skill-name';
                    skillSpan.textContent = skillPart;
                    
                    const effectSpan = document.createElement('span');
                    effectSpan.className = 'effects';
                    effectSpan.textContent = ` (${effectPart})`;
                    
                    container.appendChild(skillSpan);
                    container.appendChild(effectSpan);
                } else {
                    container.textContent = action;
                }
            }

            // æ ¼å¼åŒ–çŠ¶æ€æ—¥å¿—
            formatStatusLog(container, action) {
                const parts = action.split('ï¼š');
                if (parts.length > 1) {
                    const namePart = parts[0];
                    const valuePart = parts[1];
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'status-change';
                    nameSpan.textContent = namePart + 'ï¼š';
                    
                    const valueSpan = document.createElement('span');
                    valueSpan.className = 'status-value';
                    valueSpan.textContent = valuePart;
                    
                    container.appendChild(nameSpan);
                    container.appendChild(valueSpan);
                } else {
                    container.textContent = action;
                }
            }

            // æ ¼å¼åŒ–ç§»åŠ¨æ—¥å¿—
            formatMovementLog(container, action) {
                const positionRegex = /ã€([^ã€‘]+)ã€‘/g;
                let formattedAction = action;
                let match;
                
                while ((match = positionRegex.exec(action)) !== null) {
                    const positionSpan = `<span class="position">${match[1]}</span>`;
                    formattedAction = formattedAction.replace(match[0], positionSpan);
                }
                
                container.innerHTML = formattedAction;
            }

            // æ ¼å¼åŒ–æˆ˜æ–—æ—¥å¿—
            formatCombatLog(container, action) {
                // æŸ¥æ‰¾ä¼¤å®³æ•°å€¼
                const damageRegex = /(\d+)/g;
                let formattedAction = action;
                let match;
                
                while ((match = damageRegex.exec(action)) !== null) {
                    const damageSpan = `<span class="damage">${match[1]}</span>`;
                    formattedAction = formattedAction.replace(match[0], damageSpan);
                }
                
                container.innerHTML = formattedAction;
            }
        }

        // å…¨å±€å‡½æ•°
        let game;

        function startFourPlayerDemo() {
            game.startFourPlayerDemo();
        }

        function nextTurn() {
            game.nextTurn();
        }

        function pauseGame() {
            game.pauseGame();
        }

        function resetGame() {
            game.resetGame();
        }

        function setAutoPlay(auto) {
            game.setAutoPlay(auto);
        }

        function changeSpeed(speed) {
            game.changeSpeed(speed);
        }

        function moveToPosition(position) {
            if (game.isRunning && game.currentPlayer === 1) {
                const oldPosition = game.players[1].position;
                game.players[1].position = position;
                game.movePlayerPiece(1, position);
                
                // ä½¿ç”¨å¢å¼ºçš„ç§»åŠ¨æ—¥å¿—è®°å½•
                const effects = [];
                const baguaEffect = game.baguaEffects[position];
                if (baguaEffect) {
                    effects.push(`${baguaEffect.name}ä½åŠ æˆ`);
                }
                
                game.logMovementAction(1, oldPosition, position, effects);
                game.updatePlayerInfo(1);
            }
        }

        function moveToCenter() {
            moveToPosition('center');
        }

        // çœŸå®å¡ç‰Œé€‰æ‹©å‡½æ•°
        function selectSkill(skillType) {
            if (!game || !game.isRunning) {
                alert('æ¸¸æˆæœªå¼€å§‹ï¼');
                return;
            }
            
            const currentPlayerId = `player${game.currentPlayer}`;
            const playerHand = PlayerHands.getHand(currentPlayerId);
            
            // æŸ¥æ‰¾ç©å®¶æ‰‹ç‰Œä¸­æŒ‡å®šç±»å‹çš„å¡ç‰Œ
            const availableCards = playerHand.filter(card => card.type === skillType);
            
            if (availableCards.length === 0) {
                alert(`æ‰‹ç‰Œä¸­æ²¡æœ‰${getSkillName(skillType)}ç±»å‹çš„å¡ç‰Œï¼`);
                return;
            }
            
            // å¦‚æœæœ‰å¤šå¼ åŒç±»å‹å¡ç‰Œï¼Œé€‰æ‹©ç¬¬ä¸€å¼ ï¼ˆåç»­å¯ä»¥æ‰©å±•ä¸ºè®©ç©å®¶é€‰æ‹©ï¼‰
            const selectedCard = availableCards[0];
            const cardIndex = playerHand.indexOf(selectedCard);
            
            // æ‰“å‡ºå¡ç‰Œ
            const playedCard = PlayerHands.playCard(currentPlayerId, cardIndex);
            
            if (playedCard) {
                // ç§»é™¤ä¹‹å‰é€‰ä¸­çš„å¡ç‰Œ
                document.querySelectorAll('.skill-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // é€‰ä¸­å½“å‰å¡ç‰Œ
                document.querySelector(`[data-skill="${skillType}"]`).classList.add('selected');
                
                game.selectedSkill = skillType;
                game.selectedCard = playedCard;
                
                // è®°å½•è¯¦ç»†çš„å¡ç‰Œä½¿ç”¨ä¿¡æ¯
                const currentPlayer = game.players[game.currentPlayer];
                if (currentPlayer) {
                    game.logRealCardUsage(game.currentPlayer, playedCard, currentPlayer);
                    
                    // åœ¨å…«å¦åœ°å›¾ä¸Šæ˜¾ç¤ºé€‰ä¸­çš„å¡ç‰Œ
                    game.showCardOnMap(skillType, currentPlayer.position, 1500);
                    
                    // æŠ½ä¸€å¼ æ–°å¡è¡¥å……æ‰‹ç‰Œ
                    const newCard = PlayerHands.drawCard(currentPlayerId);
                    if (newCard) {
                        game.logAction(game.currentPlayer, `ğŸ´ æŠ½å–æ–°å¡ï¼š${newCard.name}`);
                    }
                    
                    // æ›´æ–°å¡ç‰Œåº“å­˜æ˜¾ç¤º
                    game.updateCardInventoryDisplay();
                }
            }
        }

        function getSkillName(skillType) {
            const skillNames = {
                move: 'ç§»åŠ¨',
                attack: 'æ”»å‡»',
                defend: 'é˜²å¾¡',
                special: 'ç‰¹æŠ€'
            };
            return skillNames[skillType] || skillType;
        }

        // å…¨å±€å¡ç‰Œåº“å­˜ç®¡ç†ç³»ç»Ÿ
        const CardInventory = {
            // å…·ä½“çš„å¡ç‰Œæ•°æ® - åŸºäº64å¦ç³»ç»Ÿ
            cardDatabase: {
                move: [
                    { id: 'qian_move', name: 'ä¹¾Â·å¤©è¡Œå¥', gua: 'ä¹¾', effect: 'ç§»åŠ¨+2æ ¼ï¼Œè·å¾—5ç‚¹èƒ½é‡', power: 3 },
                    { id: 'kun_move', name: 'å¤Â·åšå¾·è½½ç‰©', gua: 'å¤', effect: 'ç§»åŠ¨+1æ ¼ï¼Œè·å¾—10ç‚¹ç”Ÿå‘½', power: 2 },
                    { id: 'zhen_move', name: 'éœ‡Â·é›·åŠ¨ä¹å¤©', gua: 'éœ‡', effect: 'ç§»åŠ¨+3æ ¼ï¼Œéœ‡æ…‘æ•Œäºº', power: 4 },
                    { id: 'xun_move', name: 'å·½Â·é£è¡Œè‰åƒ', gua: 'å·½', effect: 'ç§»åŠ¨+2æ ¼ï¼Œå¯ç©¿è¶Šéšœç¢', power: 3 },
                    { id: 'kan_move', name: 'åÂ·æ°´æµä¸æ¯', gua: 'å', effect: 'ç§»åŠ¨+2æ ¼ï¼Œæ¢å¤5ç‚¹èƒ½é‡', power: 3 },
                    { id: 'li_move', name: 'ç¦»Â·ç«å…‰ç…§è€€', gua: 'ç¦»', effect: 'ç§»åŠ¨+1æ ¼ï¼Œç…§äº®å‘¨å›´', power: 2 },
                    { id: 'gen_move', name: 'è‰®Â·å±±æ­¢å¦‚å²³', gua: 'è‰®', effect: 'ç§»åŠ¨+1æ ¼ï¼Œè·å¾—é˜²å¾¡åŠ æˆ', power: 2 },
                    { id: 'dui_move', name: 'å…‘Â·æ³½æ¶¦ä¸‡ç‰©', gua: 'å…‘', effect: 'ç§»åŠ¨+2æ ¼ï¼Œæ²»ç–—5ç‚¹ç”Ÿå‘½', power: 3 }
                ],
                attack: [
                    { id: 'qian_attack', name: 'ä¹¾Â·é¾™æˆ˜äºé‡', gua: 'ä¹¾', effect: 'é€ æˆ25ç‚¹ä¼¤å®³', power: 5 },
                    { id: 'kun_attack', name: 'å¤Â·åœ°è£‚å±±å´©', gua: 'å¤', effect: 'é€ æˆ20ç‚¹ä¼¤å®³ï¼Œé™ä½æ•Œäººé˜²å¾¡', power: 4 },
                    { id: 'zhen_attack', name: 'éœ‡Â·é›·éœ†ä¸‡é’§', gua: 'éœ‡', effect: 'é€ æˆ30ç‚¹ä¼¤å®³ï¼Œæœ‰çœ©æ™•æ•ˆæœ', power: 6 },
                    { id: 'xun_attack', name: 'å·½Â·é£å·æ®‹äº‘', gua: 'å·½', effect: 'é€ æˆ15ç‚¹ä¼¤å®³ï¼Œè¿å‡»2æ¬¡', power: 4 },
                    { id: 'kan_attack', name: 'åÂ·æ°´æ·¹ä¸ƒå†›', gua: 'å', effect: 'é€ æˆ20ç‚¹ä¼¤å®³ï¼Œå‡é€Ÿæ•Œäºº', power: 4 },
                    { id: 'li_attack', name: 'ç¦»Â·çƒˆç«ç„šå¤©', gua: 'ç¦»', effect: 'é€ æˆ22ç‚¹ä¼¤å®³ï¼ŒæŒç»­ç‡ƒçƒ§', power: 5 },
                    { id: 'gen_attack', name: 'è‰®Â·å±±å´©åœ°è£‚', gua: 'è‰®', effect: 'é€ æˆ28ç‚¹ä¼¤å®³ï¼ŒèŒƒå›´æ”»å‡»', power: 5 },
                    { id: 'dui_attack', name: 'å…‘Â·æ³½å›½åƒé‡Œ', gua: 'å…‘', effect: 'é€ æˆ18ç‚¹ä¼¤å®³ï¼Œæ¢å¤è‡ªèº«ç”Ÿå‘½', power: 4 }
                ],
                defend: [
                    { id: 'qian_defend', name: 'ä¹¾Â·é‡‘åˆšä¸å', gua: 'ä¹¾', effect: 'è·å¾—20ç‚¹æŠ¤ç›¾ï¼Œåå¼¹ä¼¤å®³', power: 4 },
                    { id: 'kun_defend', name: 'å¤Â·å¤§åœ°ä¹‹ç›¾', gua: 'å¤', effect: 'è·å¾—25ç‚¹æŠ¤ç›¾ï¼Œæ¢å¤ç”Ÿå‘½', power: 5 },
                    { id: 'zhen_defend', name: 'éœ‡Â·é›·ç”µæŠ¤ä½“', gua: 'éœ‡', effect: 'è·å¾—15ç‚¹æŠ¤ç›¾ï¼Œç”µå‡»æ”»å‡»è€…', power: 3 },
                    { id: 'xun_defend', name: 'å·½Â·é£å¢™æŠ¤èº«', gua: 'å·½', effect: 'è·å¾—18ç‚¹æŠ¤ç›¾ï¼Œåè½¬æ”»å‡»', power: 4 },
                    { id: 'kan_defend', name: 'åÂ·æ°´é•œé˜²å¾¡', gua: 'å', effect: 'è·å¾—20ç‚¹æŠ¤ç›¾ï¼Œå¸æ”¶èƒ½é‡', power: 4 },
                    { id: 'li_defend', name: 'ç¦»Â·ç«ç„°å±éšœ', gua: 'ç¦»', effect: 'è·å¾—16ç‚¹æŠ¤ç›¾ï¼Œç¼çƒ§æ”»å‡»è€…', power: 3 },
                    { id: 'gen_defend', name: 'è‰®Â·å±±å²³ä¹‹å›º', gua: 'è‰®', effect: 'è·å¾—30ç‚¹æŠ¤ç›¾ï¼Œä¸å¯ç§»åŠ¨', power: 5 },
                    { id: 'dui_defend', name: 'å…‘Â·æ³½æ¶¦æŠ¤ä½“', gua: 'å…‘', effect: 'è·å¾—22ç‚¹æŠ¤ç›¾ï¼ŒæŒç»­æ²»ç–—', power: 4 }
                ],
                special: [
                    { id: 'qian_special', name: 'ä¹¾Â·ä¹äº”ä¹‹å°Š', gua: 'ä¹¾', effect: 'å…¨å±æ€§æå‡ï¼Œè·å¾—ç‹è€…å…‰ç¯', power: 6 },
                    { id: 'kun_special', name: 'å¤Â·æ¯ä»ªå¤©ä¸‹', gua: 'å¤', effect: 'æ²»ç–—æ‰€æœ‰å‹å†›ï¼Œè·å¾—æŠ¤ä½‘', power: 5 },
                    { id: 'zhen_special', name: 'éœ‡Â·æƒŠå¤©åŠ¨åœ°', gua: 'éœ‡', effect: 'èŒƒå›´éœ‡æ…‘ï¼Œé‡ç½®æŠ€èƒ½å†·å´', power: 5 },
                    { id: 'xun_special', name: 'å·½Â·æ— å­”ä¸å…¥', gua: 'å·½', effect: 'ç©¿é€æ‰€æœ‰é˜²å¾¡ï¼Œå¿…ä¸­æ”»å‡»', power: 4 },
                    { id: 'kan_special', name: 'åÂ·æ·±ä¸å¯æµ‹', gua: 'å', effect: 'éšèº«3å›åˆï¼Œä¸‹æ¬¡æ”»å‡»æš´å‡»', power: 4 },
                    { id: 'li_special', name: 'ç¦»Â·å…‰æ˜æ™®ç…§', gua: 'ç¦»', effect: 'ç…§äº®å…¨åœºï¼Œé©±æ•£è´Ÿé¢æ•ˆæœ', power: 3 },
                    { id: 'gen_special', name: 'è‰®Â·ç¨³å¦‚æ³°å±±', gua: 'è‰®', effect: 'å…ç–«æ‰€æœ‰æ§åˆ¶ï¼Œè·å¾—åšéŸ§', power: 4 },
                    { id: 'dui_special', name: 'å…‘Â·å’Œè°å…±ç”Ÿ', gua: 'å…‘', effect: 'ä¸å‹å†›å…±äº«ç”Ÿå‘½å’Œèƒ½é‡', power: 5 }
                ]
            },
            
            // å¡ç‰Œæ±  - å­˜å‚¨æ‰€æœ‰å¯ç”¨çš„å¡ç‰Œå®ä¾‹
            cardPool: [],
            
            // å·²ä½¿ç”¨çš„å¡ç‰Œ
            usedCards: [],
            
            // åˆå§‹åŒ–å¡ç‰Œæ± 
            init: function() {
                this.cardPool = [];
                this.usedCards = [];
                
                // ä¸ºæ¯ç§ç±»å‹åˆ›å»º8å¼ ä¸åŒçš„å¡ç‰Œï¼Œæ¯å¼ å¡ç‰Œé‡å¤8æ¬¡ï¼ˆ8Ã—8=64å¼ æ¯ç±»å‹ï¼‰
                Object.keys(this.cardDatabase).forEach(type => {
                    for (let i = 0; i < 8; i++) { // 8ç§ä¸åŒçš„å¡ç‰Œ
                        for (let j = 0; j < 8; j++) { // æ¯ç§é‡å¤8æ¬¡
                            const cardTemplate = this.cardDatabase[type][i];
                            const card = {
                                ...cardTemplate,
                                uniqueId: `${cardTemplate.id}_${i}_${j}`,
                                type: type,
                                index: this.cardPool.length
                            };
                            this.cardPool.push(card);
                        }
                    }
                });
                
                // æ´—ç‰Œ
                this.shuffleDeck();
            },
            
            // æ´—ç‰Œ
            shuffleDeck: function() {
                for (let i = this.cardPool.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.cardPool[i], this.cardPool[j]] = [this.cardPool[j], this.cardPool[i]];
                }
            },
            
            // å‘ç‰Œ - ä»å¡ç‰Œæ± ä¸­æŠ½å–æŒ‡å®šæ•°é‡çš„å¡ç‰Œ
            dealCards: function(count) {
                const dealtCards = [];
                for (let i = 0; i < count && this.cardPool.length > 0; i++) {
                    dealtCards.push(this.cardPool.pop());
                }
                return dealtCards;
            },
            
            // å‘æŒ‡å®šç±»å‹çš„å¡ç‰Œ
            dealCardOfType: function(type) {
                const availableCards = this.cardPool.filter(card => card.type === type);
                if (availableCards.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableCards.length);
                    const selectedCard = availableCards[randomIndex];
                    
                    // ä»å¡ç‰Œæ± ä¸­ç§»é™¤
                    const poolIndex = this.cardPool.indexOf(selectedCard);
                    if (poolIndex > -1) {
                        this.cardPool.splice(poolIndex, 1);
                        return selectedCard;
                    }
                }
                return null;
            },
            
            // ä½¿ç”¨å¡ç‰Œ
            useCard: function(card) {
                this.usedCards.push(card);
                return true;
            },
            
            // é‡ç½®åº“å­˜
            reset: function() {
                this.init();
            },
            
            // è·å–å‰©ä½™æ•°é‡ï¼ˆæŒ‰ç±»å‹ï¼‰
            getRemaining: function(type) {
                return this.cardPool.filter(card => card.type === type).length;
            },
            
            // è·å–æ€»å‰©ä½™æ•°é‡
            getTotalRemaining: function() {
                return this.cardPool.length;
            },

            // è·å–å·²ä½¿ç”¨æ€»æ•°
            getTotalUsed: function() {
                return this.usedCards.length;
            },

            // è·å–åˆå§‹æ€»æ•°
            getTotalInitial: function() {
                return 256; // 64å¦ Ã— 4ç§ç±»å‹
            },
            
            // æŒ‰ç±»å‹è·å–å·²ä½¿ç”¨å¡ç‰Œæ•°é‡
            getUsedByType: function(type) {
                return this.usedCards.filter(card => card.type === type).length;
            }
        };

        // ç©å®¶æ‰‹ç‰Œç®¡ç†ç³»ç»Ÿ
        const PlayerHands = {
            // ç©å®¶æ‰‹ç‰Œ
            hands: {
                player1: [],
                player2: []
            },
            
            // æ‰‹ç‰Œä¸Šé™
            maxHandSize: 7,
            
            // åˆå§‹åŒ–æ‰‹ç‰Œ
            init: function() {
                this.hands.player1 = [];
                this.hands.player2 = [];
                
                // ä¸ºæ¯ä¸ªç©å®¶å‘åˆå§‹æ‰‹ç‰Œ
                this.dealInitialHands();
            },
            
            // å‘åˆå§‹æ‰‹ç‰Œ
            dealInitialHands: function() {
                // æ¯ä¸ªç©å®¶å‘5å¼ åˆå§‹æ‰‹ç‰Œ
                for (let i = 0; i < 5; i++) {
                    const card1 = CardInventory.dealCards(1)[0];
                    const card2 = CardInventory.dealCards(1)[0];
                    
                    if (card1) this.hands.player1.push(card1);
                    if (card2) this.hands.player2.push(card2);
                }
            },
            
            // æŠ½ç‰Œ
            drawCard: function(playerId) {
                if (this.hands[playerId].length >= this.maxHandSize) {
                    return null; // æ‰‹ç‰Œå·²æ»¡
                }
                
                const card = CardInventory.dealCards(1)[0];
                if (card) {
                    this.hands[playerId].push(card);
                    return card;
                }
                return null;
            },
            
            // æ‰“å‡ºå¡ç‰Œ
            playCard: function(playerId, cardIndex) {
                if (cardIndex >= 0 && cardIndex < this.hands[playerId].length) {
                    const card = this.hands[playerId].splice(cardIndex, 1)[0];
                    CardInventory.useCard(card);
                    return card;
                }
                return null;
            },
            
            // è·å–ç©å®¶æ‰‹ç‰Œ
            getHand: function(playerId) {
                return this.hands[playerId] || [];
            },
            
            // è·å–æ‰‹ç‰Œæ•°é‡
            getHandSize: function(playerId) {
                return this.hands[playerId] ? this.hands[playerId].length : 0;
            },
            
            // é‡ç½®æ‰‹ç‰Œ
            reset: function() {
                this.init();
            }
        };

        // æ›´æ–°å‰©ä½™ç‰Œæ•°æ˜¾ç¤º
        function updateCardCounts() {
            // ä½¿ç”¨åº“å­˜ç®¡ç†ç³»ç»Ÿè·å–å½“å‰æ•°æ®
            const cardTypes = ['move', 'attack', 'defend', 'special'];
            
            // æ›´æ–°å„æŠ€èƒ½å¡ç‰Œçš„å‰©ä½™æ•°é‡
            cardTypes.forEach(skill => {
                const remainingElement = document.querySelector(`[data-skill="${skill}"] .card-remaining`);
                if (remainingElement) {
                    const remaining = CardInventory.getRemaining(skill);
                    remainingElement.textContent = `å‰©ä½™: ${remaining}`;
                    
                    // å¦‚æœå¡ç‰Œç”¨å®Œï¼Œæ·»åŠ è§†è§‰æç¤º
                    const cardElement = remainingElement.closest('.skill-card');
                    if (remaining === 0) {
                        cardElement.style.opacity = '0.5';
                        cardElement.style.filter = 'grayscale(50%)';
                    } else {
                        cardElement.style.opacity = '1';
                        cardElement.style.filter = 'none';
                    }
                }
            });

            // æ›´æ–°æ€»å¡ç‰Œæ•°
            const totalCards = CardInventory.getTotalRemaining();
            const totalElement = document.querySelector('.card-count');
            if (totalElement) {
                const usedCards = CardInventory.getTotalUsed();
                const totalInitial = CardInventory.getTotalInitial();
                totalElement.innerHTML = `
                    <div class="card-count-detail">
                        <div>ğŸ“¦ å‰©ä½™: ${totalCards} å¼ </div>
                        <div>ğŸ´ å·²ç”¨: ${usedCards} å¼ </div>
                        <div>ğŸ“š æ€»è®¡: ${totalInitial} å¼  (64å¦Ã—4ç±»å‹)</div>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºå¡ç‰Œå›¾é‰´
        function showCardGallery() {
            const modal = document.getElementById('cardGalleryModal');
            if (modal) {
                modal.style.display = 'block';
                // æ·»åŠ æ‰“å¼€åŠ¨ç”»
                setTimeout(() => {
                    modal.style.opacity = '1';
                }, 10);
            }
        }

        // å…³é—­å¡ç‰Œå›¾é‰´
        function closeCardGallery() {
            const modal = document.getElementById('cardGalleryModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }
        
        // é‡ç½®å¡ç‰Œåº“å­˜
        function resetCardInventory() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å¡ç‰Œåº“å­˜å—ï¼Ÿè¿™å°†æ¢å¤æ‰€æœ‰å¡ç‰Œåˆ°åˆå§‹æ•°é‡ã€‚')) {
                CardInventory.reset();
                updateCardCounts();
                
                // æ˜¾ç¤ºé‡ç½®æˆåŠŸçš„æç¤º
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #27ae60, #2ecc71);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-weight: bold;
                    animation: slideIn 0.3s ease-out;
                `;
                notification.textContent = 'âœ… å¡ç‰Œåº“å­˜å·²é‡ç½®ï¼';
                document.body.appendChild(notification);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤æç¤º
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }

        // åˆ‡æ¢å›¾é‰´æ ‡ç­¾é¡µ
        function showGalleryTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            const allTabs = document.querySelectorAll('.gallery-tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            const allButtons = document.querySelectorAll('.tab-btn');
            allButtons.forEach(btn => btn.classList.remove('active'));

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            const targetTab = document.getElementById(`${tabName}-cards`);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            const targetButton = event.target;
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }

        // ç‚¹å‡»æ¨¡æ€çª—å£å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('cardGalleryModal');
            if (event.target === modal) {
                closeCardGallery();
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            game = new TianJiBianGame();
            // åˆå§‹åŒ–å¡ç‰Œåº“å­˜ç³»ç»Ÿ
            CardInventory.init();
            // åˆå§‹åŒ–å¡ç‰Œè®¡æ•°æ˜¾ç¤º
            updateCardCounts();
            
            // æ·»åŠ å¡ç‰Œä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.skill-card').forEach(card => {
                card.addEventListener('click', function() {
                    const skillType = this.getAttribute('data-skill');
                    if (skillType && CardInventory.useCard(skillType)) {
                        updateCardCounts();
                        // è¿™é‡Œå¯ä»¥æ·»åŠ å¡ç‰Œä½¿ç”¨çš„è§†è§‰åé¦ˆ
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                        }, 150);
                    }
                });
            });
        });
    </script>
</body>
</html>