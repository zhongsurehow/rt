<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天机变 - 游戏中</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/game.css">
    <style>
        /* 融合三个文件的优秀设计元素 */
        
        /* 太极图中心设计 - 参考tianjibian_game_map.html */
        .taiji-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(90deg, #000 0%, #000 50%, #fff 50%, #fff 100%);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            border: 3px solid rgba(255, 215, 0, 0.8);
            animation: taijRotate 120s linear infinite;
            z-index: 10;
        }

        .taiji-center::before {
            content: '';
            position: absolute;
            top: 0;
            left: 25%;
            width: 50%;
            height: 50%;
            background: #000;
            border-radius: 0 60px 60px 0;
            transform-origin: 0 100%;
        }

        .taiji-center::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 25%;
            width: 50%;
            height: 50%;
            background: #fff;
            border-radius: 60px 0 0 60px;
            transform-origin: 100% 0;
        }

        @keyframes taijRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* 八卦位置设计 - 参考tianjibian_complete_game.html */
        .bagua-position {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.7));
            border: 2px solid rgba(255, 215, 0, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .bagua-position:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.4);
            background: linear-gradient(135deg, rgba(255,215,0,0.9), rgba(255,193,7,0.7));
        }

        .bagua-symbol {
            font-size: 20px;
            color: #333;
            margin-bottom: 2px;
        }
        
        .bagua-name {
            font-size: 12px;
            color: #333;
            font-weight: bold;
            margin-bottom: 1px;
        }
        
        .bagua-element {
            font-size: 10px;
            color: #666;
        }
        
        /* 九宫格样式 */
        .jiugongge-board {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 20px auto;
        }
        
        .jiugongge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            height: 100%;
            padding: 20px;
        }
        
        .jiugongge-position {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.7));
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .jiugongge-position:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.4);
            background: linear-gradient(135deg, rgba(255,215,0,0.9), rgba(255,193,7,0.7));
        }
        
        .jiugongge-center {
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,215,0,0.3) 100%);
            border: 3px solid #ffd700;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .taiji-symbol {
            font-size: 32px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .center-text {
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }

        /* 圆形游戏板 - 参考tianjibian_game_map.html */
        .game-board {
            position: relative;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.3) 100%);
            border: 3px solid rgba(255, 215, 0, 0.5);
            margin: 20px auto;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        /* 季节指示器 - 参考tianjibian_game_map.html */
        .season-indicator {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.7));
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.6);
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* 动画效果 - 参考tianjibian_game_simulation.html */
        .card-draw-animation {
            animation: cardDraw 0.5s ease-out;
        }

        @keyframes cardDraw {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(90deg); opacity: 0.7; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .pulse-effect {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* 玩家头像样式 */
        .player-avatar {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            z-index: 15;
            transition: all 0.3s ease;
            top: -16px;
            right: -16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .player-avatar:hover {
            transform: scale(1.3);
            border-color: rgba(255, 215, 0, 1);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }

        /* 四人对战专用样式 */
        .four-player-mode .player-avatar {
            width: 36px;
            height: 36px;
            font-size: 16px;
            border-width: 3px;
            top: -18px;
            right: -18px;
        }

        /* 玩家位置指示器 */
        .player-position-indicator {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            z-index: 20;
            white-space: nowrap;
        }

        /* 当前玩家高亮 */
        .current-player-position {
            animation: currentPlayerPulse 2s ease-in-out infinite;
        }

        @keyframes currentPlayerPulse {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
                border-color: rgba(255, 215, 0, 0.8);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 1);
                border-color: rgba(255, 215, 0, 1);
                transform: scale(1.1);
            }
        }

        /* 四人对战模式优化样式 */
        .four-player-battle-mode .bagua-container {
            transform: scale(1.1);
            margin: 20px auto;
        }

        .four-player-battle-mode .bagua-position {
            width: 90px;
            height: 90px;
            border: 3px solid rgba(255, 215, 0, 0.8);
        }

        .four-player-battle-mode .bagua-position:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 30px rgba(255, 215, 0, 0.6);
        }

        .four-player-battle-mode .current-player-position .player-position-indicator {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: 1px solid #ff6b6b;
            color: white;
            font-weight: bold;
        }

        /* 日志系统样式 - 参考tianjibian_game_simulation.html */
        .game-log {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.9);
            font-size: 14px;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.important {
            color: #ffd700;
            font-weight: bold;
        }

        /* 卡牌游戏样式 */
        .card-game-board {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(10px);
        }

        .board-cell {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .board-cell:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .card-on-board {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(147, 51, 234, 0.3));
            border-radius: 8px;
            padding: 8px;
        }

        .card-in-hand {
            min-width: 150px;
            max-width: 200px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card-in-hand:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .empty-cell {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        /* 卡牌动画效果 */
        .card-play-animation {
            animation: cardPlay 0.6s ease-out;
        }

        @keyframes cardPlay {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* 选中效果 */
        .selected-card {
            border-color: #ffd700 !important;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .selected-position {
            border-color: #ffd700 !important;
            background: rgba(255, 215, 0, 0.1) !important;
        }

        /* 反馈系统样式 */
        .feedback-message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: slideInRight 0.3s ease-out;
            max-width: 300px;
            word-wrap: break-word;
        }

        .feedback-message.success {
            background: linear-gradient(135deg, #10b981, #059669);
            border-left: 4px solid #34d399;
        }

        .feedback-message.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-left: 4px solid #f87171;
        }

        .feedback-message.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-left: 4px solid #fbbf24;
        }

        .feedback-message.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-left: 4px solid #60a5fa;
        }

        .feedback-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            opacity: 0.7;
        }

        .feedback-close:hover {
            opacity: 1;
        }

        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            animation: fadeIn 0.3s ease-out;
        }

        .confirm-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s ease-out;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .confirm-message {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .confirm-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-btn.cancel {
            background: #f3f4f6;
            color: #374151;
        }

        .confirm-btn.cancel:hover {
            background: #e5e7eb;
        }

        .confirm-btn.confirm {
            background: #3b82f6;
            color: white;
        }

        .confirm-btn.confirm:hover {
            background: #2563eb;
        }

        /* 操作提示样式 */
        .action-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 999;
            animation: slideInUp 0.3s ease-out;
            max-width: 400px;
            text-align: center;
        }

        /* 状态指示器样式 */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-indicator.connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-indicator.connecting {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* 动画效果 */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Card Codex Modal Styles */
        .codex-modal {
            position: fixed;
            z-index: 1002; /* Higher than other elements */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .codex-modal-content {
            background: rgba(17, 24, 39, 0.9); /* bg-gray-900 with opacity */
            backdrop-filter: blur(10px);
            margin: auto;
            padding: 24px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            width: 90%;
            max-width: 1400px;
            border-radius: 12px;
            color: #fff;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .codex-close-btn {
            color: #aaa;
            position: absolute;
            top: 16px;
            right: 24px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        .codex-close-btn:hover {
            color: #fff;
        }

        .codex-tabs {
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .codex-tab-link {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid transparent;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 6px;
            margin-right: 10px;
        }

        .codex-tab-link.active, .codex-tab-link:hover {
            background: #ffd700;
            color: #000;
            border-color: #ffd700;
        }

        .codex-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            overflow-y: auto;
            flex-grow: 1;
            padding-right: 10px; /* For scrollbar */
        }

        .codex-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 13px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .codex-card .card-name { font-weight: bold; color: #ffd700; font-size: 16px; }
        .codex-card .card-type { font-size: 12px; color: #ccc; margin-top: 4px; }
        .codex-card .card-desc { font-size: 13px; margin-top: 8px; flex-grow: 1; }
        .codex-card .card-cost-power { font-size: 12px; margin-top: 8px; color: #88aaff; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 min-h-screen">
    <div id="app" class="min-h-screen flex flex-col four-player-battle-mode">
        <!-- 顶部导航 -->
        <nav class="bg-black/20 backdrop-blur-md border-b border-white/10 p-4">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold text-white">天机变 - 四人对战</h1>
                        <div class="text-white/70">
                            <span v-if="gameState">游戏ID: [[ gameState.game_id ]]</span>
                            <span v-else class="text-red-400">游戏状态未加载</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-white/70">
                            <span v-if="connectionStatus.connected" class="text-green-400">
                                <i class="fas fa-circle text-xs"></i> 已连接
                            </span>
                            <span v-else class="text-red-400">
                                <i class="fas fa-circle text-xs"></i> 连接中...
                            </span>
                        </div>
                        <button @click="leaveGame" class="text-white/70 hover:text-white">
                            <i class="fas fa-sign-out-alt"></i> 离开
                        </button>
                    </div>
                </div>
                
                <!-- 详细游戏状态显示 -->
                <div class="grid grid-cols-8 gap-4 text-sm">
                    <div class="text-center">
                        <div class="text-white/70 text-xs">当前回合</div>
                        <div class="text-white font-medium" id="current-round">[[ currentRound ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">当前玩家</div>
                        <div class="text-yellow-400 font-medium" id="current-player">[[ getCurrentPlayerName() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">当前季节</div>
                        <div class="text-green-400 font-medium" id="current-season">[[ getCurrentSeason() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">五行主导</div>
                        <div class="text-orange-400 font-medium" id="current-wuxing">[[ getCurrentWuxing() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">天干地支</div>
                        <div class="text-purple-400 font-medium" id="current-ganzhi">[[ getCurrentGanzhi() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">节气</div>
                        <div class="text-cyan-400 font-medium" id="current-jieqi">[[ getCurrentJieqi() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">阴阳</div>
                        <div class="text-yellow-400 font-medium" id="current-yinyang">[[ getCurrentYinyang() ]]</div>
                    </div>
                    <div class="text-center">
                        <div class="text-white/70 text-xs">游戏状态</div>
                        <div class="text-blue-400 font-medium" id="game-state">[[ getCurrentGameState() ]]</div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主游戏区域 -->
        <div class="flex-1 flex">
            <!-- 左侧玩家信息 -->
            <div class="w-80 bg-black/20 backdrop-blur-md border-r border-white/10 p-6">
                <!-- 当前玩家状态 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">玩家状态</h3>
                    <div class="bg-white/10 rounded-lg p-4">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <div class="text-white font-medium">
                                    <span v-if="currentPlayer">[[ currentPlayer.name || '玩家' ]]</span>
                                </div>
                                <div class="text-white/70 text-sm">
                                    <span v-if="gameState && currentPlayer && currentPlayer.id === gameState.current_player">你的回合</span>
                                    <span v-else>等待中</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 属性值 -->
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-white/70">气</span>
                                    <span v-if="currentPlayer">[[ currentPlayer.qi || 0 ]]/100</span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-2">
                                    <div class="bg-blue-400 h-2 rounded-full" :style="{width: (currentPlayer?.qi || 0) + '%'}"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-white/70">道</span>
                                    <span v-if="currentPlayer">[[ currentPlayer.dao || 0 ]]/100</span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-2">
                                    <div class="bg-purple-400 h-2 rounded-full" :style="{width: (currentPlayer?.dao || 0) + '%'}"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-white/70">诚</span>
                                    <span v-if="currentPlayer">[[ currentPlayer.sincerity || 0 ]]/100</span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-2">
                                    <div class="bg-yellow-400 h-2 rounded-full" :style="{width: (currentPlayer?.sincerity || 0) + '%'}"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 阴阳平衡 -->
                        <div class="mt-4 p-3 bg-white/5 rounded-lg">
                            <div class="text-white/70 text-sm mb-2">阴阳平衡</div>
                            <div class="text-white text-sm">
                                阴: <span v-if="currentPlayer">[[ currentPlayer.yin || 0 ]]</span><br>
                                阳: <span v-if="currentPlayer">[[ currentPlayer.yang || 0 ]]</span>
                            </div>
                        </div>

                        <!-- 五行元素 -->
                        <div class="mt-4">
                            <div class="text-white/70 text-sm mb-2">五行元素</div>
                            <div class="grid grid-cols-5 gap-2">
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-green-500 rounded-full mx-auto mb-1"></div>
                                    <div class="text-white/70 text-xs">
                                        <span v-if="currentPlayer && currentPlayer.elements">[[ currentPlayer.elements.wood || 0 ]]</span>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-red-500 rounded-full mx-auto mb-1"></div>
                                    <div class="text-white/70 text-xs">
                                        <span v-if="currentPlayer && currentPlayer.elements">[[ currentPlayer.elements.fire || 0 ]]</span>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-yellow-500 rounded-full mx-auto mb-1"></div>
                                    <div class="text-white/70 text-xs">
                                        <span v-if="currentPlayer && currentPlayer.elements">[[ currentPlayer.elements.earth || 0 ]]</span>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-gray-400 rounded-full mx-auto mb-1"></div>
                                    <div class="text-white/70 text-xs">
                                        <span v-if="currentPlayer && currentPlayer.elements">[[ currentPlayer.elements.metal || 0 ]]</span>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full mx-auto mb-1"></div>
                                    <div class="text-white/70 text-xs">
                                        <span v-if="currentPlayer && currentPlayer.elements">[[ currentPlayer.elements.water || 0 ]]</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他玩家 -->
                <div v-if="otherPlayers.length > 0">
                    <h3 class="text-white font-semibold mb-4">其他玩家</h3>
                    <div class="space-y-3">
                        <div v-for="player in otherPlayers" :key="player.id" class="bg-white/10 rounded-lg p-3">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-white text-sm"></i>
                                </div>
                                <div>
                                    <div class="text-white font-medium">[[ player.name ]]</div>
                                    <div class="text-white/70 text-xs">
                                        气: [[ player.qi ]] | 道: [[ player.dao ]]
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 四人演示控制面板 -->
                <div class="mt-6">
                    <h3 class="text-white font-semibold mb-4">四人演示</h3>
                    <div class="bg-white/10 rounded-lg p-4 space-y-3">
                        <!-- 演示状态 -->
                        <div class="text-center">
                            <div class="text-white/70 text-sm mb-2">演示状态</div>
                            <div class="text-white font-medium">
                                [[ demoRunning ? '运行中' : '已停止' ]]
                            </div>
                        </div>
                        
                        <!-- 控制按钮 -->
                        <div class="flex gap-2">
                            <button @click="startFourPlayerDemo" 
                                    :disabled="demoRunning"
                                    class="flex-1 px-3 py-2 bg-green-500 text-white rounded text-sm hover:bg-green-600 disabled:opacity-50">
                                开始演示
                            </button>
                            <button @click="pauseGame" 
                                    :disabled="!demoRunning"
                                    class="flex-1 px-3 py-2 bg-red-500 text-white rounded text-sm hover:bg-red-600 disabled:opacity-50">
                                停止演示
                            </button>
                        </div>
                        
                        <!-- 演示速度 -->
                        <div>
                            <div class="text-white/70 text-sm mb-2">演示速度</div>
                            <select v-model="demoSpeed" class="w-full px-2 py-1 bg-white/20 text-white rounded text-sm">
                                <option value="slow">慢速 (3秒)</option>
                                <option value="normal">正常 (2秒)</option>
                                <option value="fast">快速 (1秒)</option>
                            </select>
                        </div>
                        
                        <!-- 自动播放 -->
                        <div class="flex items-center justify-between">
                            <span class="text-white/70 text-sm">自动播放</span>
                            <button @click="autoPlay = !autoPlay" 
                                    :class="autoPlay ? 'bg-green-500' : 'bg-gray-500'"
                                    class="px-3 py-1 text-white rounded text-sm">
                                [[ autoPlay ? '开启' : '关闭' ]]
                            </button>
                        </div>
                        
                        <!-- 当前回合信息 -->
                        <div class="text-center pt-2 border-t border-white/20">
                            <div class="text-white/70 text-xs">
                                回合: [[ currentTurn ]] | 季节: [[ currentSeason ]]
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 四人玩家信息 -->
                <div class="mt-6" v-if="players && players.length > 0">
                    <h3 class="text-white font-semibold mb-4">玩家状态</h3>
                    <div class="space-y-2">
                        <div v-for="(player, index) in players" :key="player.id" 
                             :class="currentPlayerIndex === index ? 'bg-blue-500/20 border border-blue-500/50' : 'bg-white/10'"
                             class="rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-white font-medium text-sm">[[ player.name ]]</div>
                                    <div class="text-white/70 text-xs">
                                        [[ player.personality ]]
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-white/70 text-xs">
                                        健康: [[ player.health ]]
                                    </div>
                                    <div class="text-white/70 text-xs">
                                        能量: [[ player.energy ]]
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 text-white/70 text-xs">
                                位置: [[ player.position ]] | 阴阳: [[ player.yin ]]/[[ player.yang ]]
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中央游戏区域 -->
            <div class="flex-1 flex flex-col">
                <!-- 棋盘区域 - 融合三个文件的优秀设计 -->
                <div class="flex-1 p-6">
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-semibold text-center flex-1">天机变棋盘</h3>
                            <div class="flex gap-2">
                                <button @click="toggleBoardView" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                                    [[ boardView === 'circle' ? '九宫格' : '圆形' ]]
                                </button>
                                <button @click="isSimulating ? stopSimulation() : startSimulation()" 
                        :class="isSimulating ? 'px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600' : 'px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600'">
                    [[ isSimulating ? '停止模拟' : '开始模拟' ]]
                </button>
                            </div>
                        </div>
                        
                        <!-- 圆形游戏板 -->
                        <div class="game-board mx-auto" v-show="boardView === 'circle'">
                        
                        <!-- 九宫格游戏板 -->
                        <div class="jiugongge-board mx-auto" v-show="boardView === 'jiugongge'">
                            <!-- 季节指示器 -->
                            <div class="season-indicator">
                                <span v-if="gameState">[[ gameState.season || '春' ]]季</span>
                                <span v-else>春季</span>
                            </div>
                            
                            <!-- 卡牌游戏九宫格棋盘 -->
                            <div class="card-game-board grid grid-cols-3 gap-2 w-96 h-96 mx-auto mb-6">
                                <div v-for="(cell, index) in gameBoard" :key="index" 
                                     class="board-cell border-2 border-white/30 rounded-lg p-2 cursor-pointer hover:border-yellow-400 transition-colors"
                                     :class="{ 'border-yellow-400': selectedPosition === index, 'bg-white/10': cell.card }"
                                     @click="selectBoardPosition(index)">
                                    <div v-if="cell.card" class="card-on-board text-center">
                                        <div class="text-white font-bold text-sm">[[ cell.card.name ]]</div>
                                        <div class="text-white/70 text-xs">[[ cell.card.type ]]</div>
                                        <div class="text-yellow-400 text-xs">玩家[[ cell.player ]]</div>
                                    </div>
                                    <div v-else class="empty-cell h-full flex items-center justify-center">
                                        <div class="text-white/30 text-xs">空位</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 太极图中心 -->
                            <div class="taiji-center pulse-effect"></div>
                            
                            <!-- 八卦位置 -->
                            <!-- 乾 (上) -->
                            <div class="bagua-position" style="top: 20px; left: 50%; transform: translateX(-50%);"
                                 @click="selectBaguaPosition('qian')"
                                 :class="selectedBagua === 'qian' ? 'pulse-effect' : ''"
                                 title="乾卦 - 天">
                                <div class="bagua-symbol">☰</div>
                                <div class="bagua-name">乾</div>
                                <div class="bagua-element">天</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('乾')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 兑 (右上) -->
                            <div class="bagua-position" style="top: 80px; right: 80px;"
                                 @click="selectBaguaPosition('dui')"
                                 :class="selectedBagua === 'dui' ? 'pulse-effect' : ''"
                                 title="兑卦 - 泽">
                                <div class="bagua-symbol">☱</div>
                                <div class="bagua-name">兑</div>
                                <div class="bagua-element">泽</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('兑')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 离 (右) -->
                            <div class="bagua-position" style="top: 50%; right: 20px; transform: translateY(-50%);"
                                 @click="selectBaguaPosition('li')"
                                 :class="selectedBagua === 'li' ? 'pulse-effect' : ''"
                                 title="离卦 - 火">
                                <div class="bagua-symbol">☲</div>
                                <div class="bagua-name">离</div>
                                <div class="bagua-element">火</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('离')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 震 (右下) -->
                            <div class="bagua-position" style="bottom: 80px; right: 80px;"
                                 @click="selectBaguaPosition('zhen')"
                                 :class="selectedBagua === 'zhen' ? 'pulse-effect' : ''"
                                 title="震卦 - 雷">
                                <div class="bagua-symbol">☳</div>
                                <div class="bagua-name">震</div>
                                <div class="bagua-element">雷</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('震')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 巽 (下) -->
                            <div class="bagua-position" style="bottom: 20px; left: 50%; transform: translateX(-50%);"
                                 @click="selectBaguaPosition('xun')"
                                 :class="selectedBagua === 'xun' ? 'pulse-effect' : ''"
                                 title="巽卦 - 风">
                                <div class="bagua-symbol">☴</div>
                                <div class="bagua-name">巽</div>
                                <div class="bagua-element">风</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('巽')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 坎 (左下) -->
                            <div class="bagua-position" style="bottom: 80px; left: 80px;"
                                 @click="selectBaguaPosition('kan')"
                                 :class="selectedBagua === 'kan' ? 'pulse-effect' : ''"
                                 title="坎卦 - 水">
                                <div class="bagua-symbol">☵</div>
                                <div class="bagua-name">坎</div>
                                <div class="bagua-element">水</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('坎')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 艮 (左) -->
                            <div class="bagua-position" style="top: 50%; left: 20px; transform: translateY(-50%);"
                                 @click="selectBaguaPosition('gen')"
                                 :class="selectedBagua === 'gen' ? 'pulse-effect' : ''"
                                 title="艮卦 - 山">
                                <div class="bagua-symbol">☶</div>
                                <div class="bagua-name">艮</div>
                                <div class="bagua-element">山</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('艮')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                            
                            <!-- 坤 (左上) -->
                            <div class="bagua-position" style="top: 80px; left: 80px;"
                                 @click="selectBaguaPosition('kun')"
                                 :class="selectedBagua === 'kun' ? 'pulse-effect' : ''"
                                 title="坤卦 - 地">
                                <div class="bagua-symbol">☷</div>
                                <div class="bagua-name">坤</div>
                                <div class="bagua-element">地</div>
                                <!-- 玩家角色显示 -->
                                <div v-for="player in getPlayersAtPosition('坤')" :key="player.id" 
                                     class="player-avatar" 
                                     :class="{ 'current-player-position': isCurrentPlayer(player) }"
                                     :style="getPlayerAvatarStyle(player)"
                                     :title="player.name + ' - ' + player.personality.name">
                                    [[ player.personality.symbol ]]
                                    <div class="player-position-indicator">[[ player.name ]]</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 九宫格布局 -->
                        <div class="jiugongge-grid">
                            <!-- 第一行：巽(东南) 离(南) 坤(西南) -->
                            <div class="jiugongge-position" @click="selectBaguaPosition('xun')" 
                                 :class="selectedBagua === 'xun' ? 'pulse-effect' : ''" title="巽卦 - 风 - 东南">
                                <div class="bagua-symbol">☴</div>
                                <div class="bagua-name">巽</div>
                                <div class="bagua-element">风</div>
                            </div>
                            <div class="jiugongge-position" @click="selectBaguaPosition('li')" 
                                 :class="selectedBagua === 'li' ? 'pulse-effect' : ''" title="离卦 - 火 - 南">
                                <div class="bagua-symbol">☲</div>
                                <div class="bagua-name">离</div>
                                <div class="bagua-element">火</div>
                            </div>
                            <div class="jiugongge-position" @click="selectBaguaPosition('kun')" 
                                 :class="selectedBagua === 'kun' ? 'pulse-effect' : ''" title="坤卦 - 地 - 西南">
                                <div class="bagua-symbol">☷</div>
                                <div class="bagua-name">坤</div>
                                <div class="bagua-element">地</div>
                            </div>
                            
                            <!-- 第二行：震(东) 中心 兑(西) -->
                            <div class="jiugongge-position" @click="selectBaguaPosition('zhen')" 
                                 :class="selectedBagua === 'zhen' ? 'pulse-effect' : ''" title="震卦 - 雷 - 东">
                                <div class="bagua-symbol">☳</div>
                                <div class="bagua-name">震</div>
                                <div class="bagua-element">雷</div>
                            </div>
                            <div class="jiugongge-center" title="太极中心">
                                <div class="taiji-symbol">☯</div>
                                <div class="center-text">太极</div>
                            </div>
                            <div class="jiugongge-position" @click="selectBaguaPosition('dui')" 
                                 :class="selectedBagua === 'dui' ? 'pulse-effect' : ''" title="兑卦 - 泽 - 西">
                                <div class="bagua-symbol">☱</div>
                                <div class="bagua-name">兑</div>
                                <div class="bagua-element">泽</div>
                            </div>
                            
                            <!-- 第三行：艮(东北) 坎(北) 乾(西北) -->
                            <div class="jiugongge-position" @click="selectBaguaPosition('gen')" 
                                 :class="selectedBagua === 'gen' ? 'pulse-effect' : ''" title="艮卦 - 山 - 东北">
                                <div class="bagua-symbol">☶</div>
                                <div class="bagua-name">艮</div>
                                <div class="bagua-element">山</div>
                            </div>
                            <div class="jiugongge-position" @click="selectBaguaPosition('kan')" 
                                 :class="selectedBagua === 'kan' ? 'pulse-effect' : ''" title="坎卦 - 水 - 北">
                                <div class="bagua-symbol">☵</div>
                                <div class="bagua-name">坎</div>
                                <div class="bagua-element">水</div>
                            </div>
                            <div class="jiugongge-position" @click="selectBaguaPosition('qian')" 
                                 :class="selectedBagua === 'qian' ? 'pulse-effect' : ''" title="乾卦 - 天 - 西北">
                                <div class="bagua-symbol">☰</div>
                                <div class="bagua-name">乾</div>
                                <div class="bagua-element">天</div>
                            </div>
                        </div>
                        </div>
                        
                        <!-- 游戏状态信息 -->
                        <div class="mt-6 text-center">
                            <div class="text-white/70 text-sm space-y-2">
                                <div v-if="gameState && gameState.current_player">
                                    当前回合: <span class="text-yellow-400">[[ getCurrentPlayerName() ]]</span>
                                </div>
                                <div v-if="gameState" class="flex justify-center space-x-6">
                                    <div class="flex items-center space-x-1">
                                        <span class="text-blue-300">☯</span>
                                        <span>阴气: <span class="text-blue-400">[[ gameState.yin || 0 ]]</span></span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <span class="text-red-300">☯</span>
                                        <span>阳气: <span class="text-red-400">[[ gameState.yang || 0 ]]</span></span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <span class="text-green-300">⚡</span>
                                        <span>气力: <span class="text-green-400">[[ gameState.qi || 0 ]]</span></span>
                                    </div>
                                </div>
                                <div v-if="selectedBagua" class="text-yellow-300">
                                    当前位置: <span class="text-yellow-400">[[ getBaguaName(selectedBagua) ]]</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 手牌区域 -->
                <div class="p-6 pt-0">
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-white font-semibold">手牌</h3>
                            <div class="text-white/70 text-sm">
                                <span v-if="playerHand">[[ playerHand.length ]] 张卡牌</span>
                            </div>
                        </div>
                        <div class="flex space-x-4 overflow-x-auto pb-2">
                            <div v-for="(card, index) in playerHand" :key="card.id"
                                 @click="selectCard(card, index)"
                                 :class="['flex-shrink-0 w-40 h-56 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg p-3 cursor-pointer transition-all hover:scale-105 card-draw-animation',
                                         selectedCard?.id === card.id ? 'ring-2 ring-yellow-400 scale-105' : '']">
                                <div class="text-white text-center h-full flex flex-col justify-between">
                                    <div>
                                        <div class="font-bold text-sm mb-1">[[ card.name ]]</div>
                                        <div class="text-xs opacity-80 mb-1">
                                            [[ card.type ]]
                                            <span v-if="card.category" class="text-yellow-300">([[ card.category ]])</span>
                                        </div>
                                        <div class="text-xs mt-1 opacity-80 text-green-300">
                                            属性: [[ card.element ]]
                                        </div>
                                        <div class="text-xs mt-1 opacity-60 text-left">
                                            [[ card.description ]]
                                        </div>
                                    </div>
                                    <div class="text-xs">
                                        <div v-if="card.cost">消耗: [[ card.cost ]]</div>
                                        <div v-if="card.power">威力: [[ card.power ]]</div>
                                        <div v-if="card.link" class="mt-1">
                                            <a :href="card.link" target="_blank" class="text-blue-200 hover:text-blue-100 underline text-xs">
                                                📖 介绍
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧操作面板 -->
            <div class="w-80 bg-black/20 backdrop-blur-md border-l border-white/10 p-6">
                <!-- 四人自动模拟控制 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">🎮 四人自动模拟</h3>
                    <div class="space-y-3">
                        <button @click="startFourPlayerDemo" 
                                :disabled="autoPlay"
                                class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold py-3 px-4 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105">
                            <i class="fas fa-users mr-2"></i>
                            <span v-if="!autoPlay">🚀 开始四人自动对战</span>
                            <span v-else>⏸️ 对战进行中...</span>
                        </button>
                        <button @click="stopAutoPlay" 
                                :disabled="!autoPlay"
                                class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold py-3 px-4 rounded-lg hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105">
                            <i class="fas fa-stop mr-2"></i>
                            ⏹️ 停止自动对战
                        </button>
                        
                        <!-- 自动对战状态显示 -->
                        <div v-if="autoPlay" class="bg-white/10 rounded-lg p-4 border border-purple-400/30">
                            <div class="flex items-center justify-center mb-3">
                                <span class="text-purple-300 mr-2 pulse-effect">🔄</span>
                                <span class="text-white font-medium">自动对战进行中</span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-white/70">回合:</span>
                                    <span class="text-yellow-400 font-semibold">[[ currentRound ]]</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-white/70">当前玩家:</span>
                                    <span class="text-green-400 font-semibold">[[ getCurrentPlayerName() ]]</span>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="w-full bg-white/20 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-purple-400 to-pink-400 h-2 rounded-full transition-all duration-500" 
                                         :style="{ width: getProgressPercentage() + '%' }"></div>
                                </div>
                                <div class="text-center text-white/60 text-xs mt-1">对战进度</div>
                            </div>
                        </div>

                        <!-- AI角色预览 -->
                        <div v-if="!autoPlay && fourPlayerDemoData.players.length > 0" class="bg-white/5 rounded-lg p-4 border border-blue-400/20">
                            <h5 class="text-white/80 text-sm font-medium mb-3 text-center">🤖 AI角色预览</h5>
                            <div class="grid grid-cols-2 gap-2">
                                <div v-for="player in fourPlayerDemoData.players" :key="player.id" 
                                     class="bg-white/10 rounded-lg p-2 text-center border border-white/10 hover:border-white/30 transition-all">
                                    <div class="text-lg mb-1">[[ player.personality.symbol ]]</div>
                                    <div class="text-white text-xs font-medium">[[ player.name ]]</div>
                                    <div class="text-white/60 text-xs">[[ player.position ]]卦</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 卡牌图鉴 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">卡牌图鉴</h3>
                    <div class="bg-white/10 rounded-lg p-4 space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-white/70">总卡牌数</span>
                            <span class="text-white">[[ totalCards ]]</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-white/70">已打出</span>
                            <span class="text-white">[[ playedCards ]]</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-white/70">剩余卡牌</span>
                            <span class="text-white">[[ totalCards - playedCards ]]</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all" 
                                 :style="{width: (playedCards / totalCards * 100) + '%'}"></div>
                        </div>
                        <button @click="showCodex = true" class="w-full mt-3 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            查看图鉴
                        </button>
                    </div>
                </div>

                <!-- 游戏操作 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">游戏操作</h3>
                    <div class="space-y-3">
                        <button @click="playSelectedCard" 
                                :disabled="!selectedCard || !selectedPosition || !isMyTurn || autoPlay"
                                class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white font-semibold py-3 px-4 rounded-lg hover:from-green-600 hover:to-blue-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-play mr-2"></i>
                            出牌
                        </button>
                        <button @click="endTurn" 
                                :disabled="!isMyTurn || autoPlay"
                                class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold py-3 px-4 rounded-lg hover:from-orange-600 hover:to-red-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-forward mr-2"></i>
                            结束回合
                        </button>
                        <button @click="surrender" 
                                :disabled="autoPlay"
                                class="w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white font-semibold py-3 px-4 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-flag mr-2"></i>
                            投降
                        </button>
                    </div>
                </div>

                <!-- 游戏信息 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4 flex items-center">
                        <span class="mr-2">📊</span>游戏信息
                    </h3>
                    <div class="bg-white/10 rounded-lg p-4 space-y-3">
                        <!-- 基本信息 -->
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-white/70 flex items-center">
                                    <span class="mr-1">🔄</span>回合数
                                </span>
                                <span class="text-yellow-400 font-semibold" v-if="gameState">[[ gameState.turn || 1 ]]</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-white/70 flex items-center">
                                    <span class="mr-1">⏱️</span>当前阶段
                                </span>
                                <span class="text-blue-400 font-medium" v-if="gameState">[[ gameState.phase || '准备' ]]</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-white/70 flex items-center">
                                    <span class="mr-1">🎮</span>游戏状态
                                </span>
                                <span :class="getGameStatusColor()" v-if="gameState">[[ gameState.status || '进行中' ]]</span>
                            </div>
                        </div>
                        
                        <!-- 连接状态 -->
                        <div class="border-t border-white/20 pt-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-white/70 flex items-center">
                                    <span class="mr-1">🌐</span>连接状态
                                </span>
                                <span :class="getConnectionStatusColor()">
                                    <span v-if="connectionStatus === 'connected'" class="flex items-center">
                                        <span class="w-2 h-2 bg-green-400 rounded-full mr-1 animate-pulse"></span>
                                        已连接
                                    </span>
                                    <span v-else-if="connectionStatus === 'connecting'" class="flex items-center">
                                        <span class="w-2 h-2 bg-yellow-400 rounded-full mr-1 animate-pulse"></span>
                                        连接中
                                    </span>
                                    <span v-else class="flex items-center">
                                        <span class="w-2 h-2 bg-red-400 rounded-full mr-1"></span>
                                        已断开
                                    </span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- 玩家状态 -->
                        <div class="border-t border-white/20 pt-3" v-if="gameState && gameState.players">
                            <div class="text-white/70 text-xs mb-2">在线玩家</div>
                            <div class="grid grid-cols-2 gap-2">
                                <div v-for="player in Object.values(gameState.players)" :key="player.id" 
                                     class="bg-white/5 rounded-lg p-2 text-xs">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white font-medium truncate">[[ player.name ]]</span>
                                        <span :class="player.online ? 'text-green-400' : 'text-red-400'">
                                            <span v-if="player.online">●</span>
                                            <span v-else>○</span>
                                        </span>
                                    </div>
                                    <div class="text-white/60 mt-1">
                                        <span v-if="player.health !== undefined">❤️ [[ player.health ]]</span>
                                        <span v-if="player.energy !== undefined" class="ml-2">⚡ [[ player.energy ]]</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 玩家操作记录 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">玩家操作记录</h3>
                    <div class="bg-white/10 rounded-lg p-4 h-64 overflow-y-auto">
                        <div v-for="(record, index) in playerActionRecords" :key="index" 
                             class="mb-2 p-2 bg-white/5 rounded text-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">[[ record.playerName ]]</span>
                                <span class="text-white/50 text-xs">[[ formatTime(record.timestamp) ]]</span>
                            </div>
                            <div class="text-white/80">
                                <span class="text-blue-300">[[ record.action ]]</span>
                                <span v-if="record.cardName" class="ml-2">- [[ record.cardName ]]</span>
                                <span v-if="record.position" class="ml-2">位置: [[ record.position ]]</span>
                            </div>
                            <div v-if="record.result" class="text-green-300 text-xs mt-1">
                                结果: [[ record.result ]]
                            </div>
                        </div>
                        <div v-if="!playerActionRecords || playerActionRecords.length === 0" 
                             class="text-white/50 text-center py-8">
                            暂无操作记录
                        </div>
                    </div>
                </div>

                <!-- 游戏日志 -->
                <div class="mb-6">
                    <h3 class="text-white font-semibold mb-4">游戏日志</h3>
                    <div class="bg-white/10 rounded-lg p-4 h-48 overflow-y-auto">
                        <div v-for="(log, index) in gameLogs" :key="index" 
                             :class="['mb-1 text-sm', log.important ? 'text-yellow-300' : 'text-white/80']">
                            <span class="text-white/50 text-xs">[[ formatTime(log.timestamp) ]]</span>
                            <span class="ml-2">[[ log.message ]]</span>
                        </div>
                        <div v-if="!gameLogs || gameLogs.length === 0" 
                             class="text-white/50 text-center py-8">
                            等待游戏开始...
                        </div>
                    </div>
                </div>

                <!-- 聊天区域 -->
                <div>
                    <h3 class="text-white font-semibold mb-4">聊天</h3>
                    <div class="bg-white/10 rounded-lg p-4">
                        <div class="h-32 overflow-y-auto mb-3 space-y-2">
                            <div v-for="message in chatMessages" :key="message.id" class="text-sm">
                                <span class="text-white/70">[[ message.player ]]:</span>
                                <span class="text-white ml-1">[[ message.text ]]</span>
                            </div>
                        </div>
                        <div class="flex">
                            <input v-model="newMessage" 
                                   @keyup.enter="sendMessage"
                                   placeholder="输入消息..."
                                   class="flex-1 bg-white/20 text-white placeholder-white/50 px-3 py-2 rounded-l-lg border-none outline-none">
                            <button @click="sendMessage" 
                                    class="bg-blue-500 text-white px-4 py-2 rounded-r-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 易经教育功能 -->
                <div class="mt-6">
                    <h3 class="text-white font-semibold mb-4">
                        <i class="fas fa-graduation-cap mr-2"></i>易经智慧
                    </h3>
                    <div class="bg-white/10 rounded-lg p-4">
                        <!-- 卦象知识 -->
                        <div v-if="selectedCard" class="mb-4">
                            <h4 class="text-yellow-400 font-medium mb-2">当前卦象：[[ selectedCard.name ]]</h4>
                            <div class="text-white/80 text-sm space-y-2">
                                <p><strong>卦象含义：</strong>[[ getHexagramMeaning(selectedCard.name) ]]</p>
                                <p><strong>人生启示：</strong>[[ getLifeWisdom(selectedCard.name) ]]</p>
                                <p><strong>策略建议：</strong>[[ getStrategyAdvice(selectedCard.name) ]]</p>
                            </div>
                        </div>
                        
                        <!-- 八卦位置知识 -->
                        <div v-if="selectedBagua" class="mb-4">
                            <h4 class="text-green-400 font-medium mb-2">当前位置：[[ getBaguaName(selectedBagua) ]]</h4>
                            <div class="text-white/80 text-sm space-y-2">
                                <p><strong>方位属性：</strong>[[ getBaguaDirection(selectedBagua) ]]</p>
                                <p><strong>五行属性：</strong>[[ getBaguaElement(selectedBagua) ]]</p>
                                <p><strong>象征意义：</strong>[[ getBaguaSymbol(selectedBagua) ]]</p>
                            </div>
                        </div>
                        
                        <!-- 阴阳平衡知识 -->
                        <div class="mb-4">
                            <h4 class="text-purple-400 font-medium mb-2">阴阳平衡智慧</h4>
                            <div class="text-white/80 text-sm space-y-2">
                                <p><strong>当前状态：</strong>
                                    <span v-if="gameState">
                                        阴气 [[ gameState.yin ]] / 阳气 [[ gameState.yang ]]
                                        <span :class="getBalanceStatus().class">[[ getBalanceStatus().text ]]</span>
                                    </span>
                                </p>
                                <p><strong>平衡原理：</strong>阴阳相互依存，过阴则阳生，过阳则阴长</p>
                                <p><strong>游戏策略：</strong>[[ getBalanceAdvice() ]]</p>
                            </div>
                        </div>
                        
                        <!-- 每日易经 -->
                        <div>
                            <h4 class="text-blue-400 font-medium mb-2">今日易经</h4>
                            <div class="text-white/80 text-sm">
                                <p class="italic">"[[ dailyWisdom.quote ]]"</p>
                                <p class="mt-2 text-white/60">—— [[ dailyWisdom.source ]]</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部手牌区域 -->
        <div class="bg-black/20 backdrop-blur-md border-t border-white/10 p-4">
            <div class="max-w-7xl mx-auto">
                <!-- 当前玩家手牌 -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-white font-semibold">手牌</h3>
                        <div class="text-white/70 text-sm">
                            <span v-if="currentPlayer">气: [[ currentPlayer.qi || 0 ]]</span>
                            <span class="mx-2">|</span>
                            <span v-if="currentPlayer">道行: [[ currentPlayer.dao_xing || 0 ]]</span>
                            <span class="mx-2">|</span>
                            <span v-if="currentPlayer">诚意: [[ currentPlayer.cheng_yi || 0 ]]</span>
                        </div>
                    </div>
                    
                    <!-- 手牌显示 -->
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        <div v-for="(card, index) in (currentPlayer?.hand || [])" :key="index"
                             class="card-in-hand flex-shrink-0 bg-white/10 rounded-lg p-3 cursor-pointer hover:bg-white/20 transition-colors border-2 min-w-[200px]"
                             :class="{ 'border-yellow-400': selectedCard === index, 'border-white/30': selectedCard !== index }"
                             @click="selectCard(index)">
                            <div class="text-white font-bold text-sm mb-1">[[ card.name ]]</div>
                            <div class="text-white/70 text-xs mb-1">
                                [[ card.type ]]
                                <span v-if="card.category" class="text-yellow-300">([[ card.category ]])</span>
                            </div>
                            <div class="text-green-400 text-xs mb-1">属性: [[ card.element ]]</div>
                            <div class="text-blue-400 text-xs mb-1">消耗: [[ card.cost ]]气 | 威力: [[ card.power ]]</div>
                            <div class="text-white/60 text-xs mb-2">[[ card.description ]]</div>
                            <div class="text-orange-300 text-xs mb-2">效果: [[ card.effect ]]</div>
                            <div v-if="card.link" class="text-xs">
                                <a :href="card.link" target="_blank" class="text-blue-300 hover:text-blue-200 underline">
                                    📖 详细介绍
                                </a>
                            </div>
                        </div>
                        
                        <!-- 空手牌提示 -->
                        <div v-if="!currentPlayer?.hand || currentPlayer.hand.length === 0" 
                             class="text-white/50 text-center py-8 flex-1">
                            暂无手牌
                        </div>
                    </div>
                </div>
                
                <!-- 游戏控制按钮 -->
                <div class="flex justify-center space-x-4">
                    <button @click="meditation" 
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        冥想 (+1气)
                    </button>
                    <button @click="study" 
                            class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                        研习 (+1道行)
                    </button>
                    <button @click="checkGameEnd" 
                            class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                        检查胜利
                    </button>
                    <button @click="nextTurn" 
                            class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                        结束回合
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏结束模态框 -->
        <div v-if="showGameEnd" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                <div class="text-center">
                    <div class="text-6xl mb-4">
                        <span v-if="gameResult === 'win'">🎉</span>
                        <span v-else-if="gameResult === 'lose'">😢</span>
                        <span v-else>🤝</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-4">
                        <span v-if="gameResult === 'win'">恭喜获胜！</span>
                        <span v-else-if="gameResult === 'lose'">遗憾失败</span>
                        <span v-else>平局</span>
                    </h2>
                    <div class="space-y-3">
                        <button @click="playAgain" class="w-full bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors">
                            再来一局
                        </button>
                        <button @click="backToHome" class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                            返回主页
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 加载遮罩 -->
        <div v-if="isLoading" class="fixed inset-0 bg-black/50 flex items-center justify-center z-40">
            <div class="bg-white rounded-lg p-6 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <div class="text-gray-700">加载中...</div>
            </div>
        </div>

        <!-- 操作反馈提示 -->
        <div v-if="feedbackMessage" 
             :class="['fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform',
                     feedbackType === 'success' ? 'bg-green-500 text-white' : 
                     feedbackType === 'error' ? 'bg-red-500 text-white' : 
                     feedbackType === 'warning' ? 'bg-yellow-500 text-black' : 
                     'bg-blue-500 text-white']">
            <div class="flex items-center">
                <span class="mr-2">
                    <span v-if="feedbackType === 'success'">✅</span>
                    <span v-else-if="feedbackType === 'error'">❌</span>
                    <span v-else-if="feedbackType === 'warning'">⚠️</span>
                    <span v-else>ℹ️</span>
                </span>
                <span>[[ feedbackMessage ]]</span>
                <button @click="clearFeedback" class="ml-3 text-white/80 hover:text-white">
                    ✕
                </button>
            </div>
        </div>

        <!-- 操作确认对话框 -->
        <div v-if="showConfirmDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4">
                <div class="text-center">
                    <div class="text-4xl mb-4">[[ confirmDialog.icon ]]</div>
                    <h3 class="text-xl font-bold mb-2">[[ confirmDialog.title ]]</h3>
                    <p class="text-gray-600 mb-6">[[ confirmDialog.message ]]</p>
                    <div class="flex space-x-3">
                        <button @click="cancelConfirm" 
                                class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors">
                            取消
                        </button>
                        <button @click="executeConfirm" 
                                :class="['flex-1 py-2 px-4 rounded-lg transition-colors text-white',
                                        confirmDialog.type === 'danger' ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-500 hover:bg-blue-600']">
                            确认
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作提示浮层 -->
        <div v-if="actionHint" 
             class="fixed bottom-20 left-1/2 transform -translate-x-1/2 z-40 bg-black/80 text-white px-4 py-2 rounded-lg text-sm">
            <div class="flex items-center">
                <span class="mr-2">💡</span>
                <span>[[ actionHint ]]</span>
            </div>
        </div>

        <!-- Card Codex Modal -->
        <div v-if="showCodex" class="codex-modal" @click.self="showCodex = false">
            <div class="codex-modal-content">
                <span class="codex-close-btn" @click="showCodex = false">&times;</span>
                <h2 class="text-2xl font-bold mb-4">卡牌图鉴</h2>
                <div class="codex-tabs">
                    <button @click="codexFilter = 'all'" :class="['codex-tab-link', { 'active': codexFilter === 'all' }]">所有</button>
                    <button @click="codexFilter = 'gua'" :class="['codex-tab-link', { 'active': codexFilter === 'gua' }]">卦象</button>
                    <button @click="codexFilter = 'tian'" :class="['codex-tab-link', { 'active': codexFilter === 'tian' }]">天时</button>
                    <button @click="codexFilter = 'di'" :class="['codex-tab-link', { 'active': codexFilter === 'di' }]">地利</button>
                    <button @click="codexFilter = 'ren'" :class="['codex-tab-link', { 'active': codexFilter === 'ren' }]">人和</button>
                </div>
                <div class="codex-grid">
                    <div v-for="card in filteredCodexCards" :key="card.id" class="codex-card">
                        <div>
                            <div class="card-name">[[ card.name ]]</div>
                            <div class="card-type">[[ card.type ]] - [[ card.element ]]</div>
                            <div class="card-desc">[[ card.description ]]</div>
                        </div>
                        <div class="card-cost-power">消耗: [[ card.cost ]] | 威力: [[ card.power ]]</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TianJiBianGame 类定义
        class TianJiBianGame {
            constructor() {
                this.currentPlayer = 1;
                this.currentRound = 1;
                this.gameState = 'ready';
                this.autoPlay = false;
                this.demoSpeed = 'normal';
                this.isRunning = false;
                this.currentSeason = 0; // 0=春, 1=夏, 2=秋, 3=冬
                this.currentWuxing = 0; // 0=木, 1=火, 2=土, 3=金, 4=水
                this.seasons = ['春', '夏', '秋', '冬'];
                this.wuxingElements = ['木', '火', '土', '金', '水'];
                this.wuxingColors = ['#2ecc71', '#e74c3c', '#f39c12', '#f1c40f', '#3498db'];
                
                // 天干地支系统
                this.tiangan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                this.dizhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                this.currentGanzhiIndex = 0;
                
                // 二十四节气
                this.jieqi = [
                    '立春', '雨水', '惊蛰', '春分', '清明', '谷雨',
                    '立夏', '小满', '芒种', '夏至', '小暑', '大暑',
                    '立秋', '处暑', '白露', '秋分', '寒露', '霜降',
                    '立冬', '小雪', '大雪', '冬至', '小寒', '大寒'
                ];
                this.currentJieqiIndex = 0;
                
                // 阴阳系统
                this.yinyang = ['阳', '阴'];
                this.currentYinYang = 0; // 0为阳，1为阴
                
                // 八卦方位影响
                this.baguaEffects = {
                    'qian': { 
                        name: '乾', 
                        element: '金', 
                        effect: '增强领导力', 
                        bonus: { health: 2, energy: 3 },
                        guaci: '乾：元亨利贞',
                        meaning: '天行健，君子以自强不息',
                        symbol: '☰'
                    },
                    'kun': { 
                        name: '坤', 
                        element: '土', 
                        effect: '增强包容力', 
                        bonus: { health: 4, energy: 1 },
                        guaci: '坤：元亨，利牝马之贞',
                        meaning: '地势坤，君子以厚德载物',
                        symbol: '☷'
                    },
                    'zhen': { 
                        name: '震', 
                        element: '木', 
                        effect: '增强行动力', 
                        bonus: { health: 1, energy: 4 },
                        guaci: '震：亨，震来虩虩',
                        meaning: '雷声震动，万物复苏',
                        symbol: '☳'
                    },
                    'xun': { 
                        name: '巽', 
                        element: '木', 
                        effect: '增强适应力', 
                        bonus: { health: 2, energy: 3 },
                        guaci: '巽：小亨，利有攸往',
                        meaning: '风行天下，无所不入',
                        symbol: '☴'
                    },
                    'kan': { 
                        name: '坎', 
                        element: '水', 
                        effect: '增强智慧力', 
                        bonus: { health: 1, energy: 5 },
                        guaci: '坎：习坎，有孚',
                        meaning: '水流不息，智慧如渊',
                        symbol: '☵'
                    },
                    'li': { 
                        name: '离', 
                        element: '火', 
                        effect: '增强洞察力', 
                        bonus: { health: 3, energy: 2 },
                        guaci: '离：利贞，亨',
                        meaning: '火光明照，洞察万物',
                        symbol: '☲'
                    },
                    'gen': { 
                        name: '艮', 
                        element: '土', 
                        effect: '增强稳定力', 
                        bonus: { health: 5, energy: 0 },
                        guaci: '艮：艮其背，不获其身',
                        meaning: '山止如磐，稳重不移',
                        symbol: '☶'
                    },
                    'dui': { 
                        name: '兑', 
                        element: '金', 
                        effect: '增强交流力', 
                        bonus: { health: 2, energy: 3 },
                        guaci: '兑：亨，利贞',
                        meaning: '泽润万物，和悦交流',
                        symbol: '☱'
                    },
                    'center': { 
                        name: '中宫', 
                        element: '土', 
                        effect: '平衡调和', 
                        bonus: { health: 3, energy: 3 },
                        guaci: '太极：无极而太极',
                        meaning: '阴阳调和，万物之源',
                        symbol: '☯'
                    }
                };
                
                // 技能系统
                this.selectedSkill = null;
                this.skillCosts = { move: 10, attack: 20, defend: 15, special: 30 };
                this.players = {
                    1: { 
                        name: '玩家1 (人类)', 
                        type: 'human', 
                        position: 'center', 
                        health: 100, 
                        energy: 50, 
                        status: '正常',
                        personality: {
                            name: '平衡修行者',
                            symbol: '🎮',
                            traits: ['平衡', '适应', '全面'],
                            description: '追求阴阳平衡的修行者'
                        }
                    },
                    2: { 
                        name: 'AI-智者', 
                        type: 'ai', 
                        position: 'qian', 
                        health: 100, 
                        energy: 50, 
                        status: '正常',
                        personality: {
                            name: '天行智者',
                            symbol: '🧠',
                            traits: ['智慧', '领导', '刚健'],
                            description: '天行健，君子以自强不息',
                            preferredActions: ['高级技能', '攻击技能', '领导技能'],
                            avoidActions: ['防御技能', '恢复技能'],
                            riskTolerance: 0.8,
                            aggressiveness: 0.9
                        }
                    },
                    3: { 
                        name: 'AI-贤人', 
                        type: 'ai', 
                        position: 'kun', 
                        health: 100, 
                        energy: 50, 
                        status: '正常',
                        personality: {
                            name: '厚德贤者',
                            symbol: '💚',
                            traits: ['包容', '稳重', '守护'],
                            description: '地势坤，君子以厚德载物',
                            preferredActions: ['防御技能', '恢复技能', '辅助技能'],
                            avoidActions: ['攻击技能', '冒险技能'],
                            riskTolerance: 0.3,
                            aggressiveness: 0.2
                        }
                    },
                    4: { 
                        name: 'AI-学者', 
                        type: 'ai', 
                        position: 'zhen', 
                        health: 100, 
                        energy: 50, 
                        status: '正常',
                        personality: {
                            name: '雷动学者',
                            symbol: '⚡',
                            traits: ['敏捷', '创新', '突破'],
                            description: '震为雷，动而有威',
                            preferredActions: ['移动技能', '突击技能', '变化技能'],
                            avoidActions: ['静态技能', '持续技能'],
                            riskTolerance: 0.7,
                            aggressiveness: 0.6
                        }
                    }
                };
                this.initializeGame();
            }

            initializeGame() {
                // 初始化真实游戏逻辑
                this.initializeRealGameLogic();
                
                // 立即更新所有玩家的信息显示
                for (let i = 1; i <= 4; i++) {
                    this.updatePlayerInfo(i);
                }
                this.updateDisplay();
                this.logAction(1, '🎮 平衡修行者已准备就绪');
                this.logAction(2, '🧠 智慧学者已准备就绪');
                this.logAction(3, '💚 养生大师已准备就绪');
                this.logAction(4, '⚡ 能量专家已准备就绪');
            }

            initializeRealGameLogic() {
                // 初始化卡牌库
                this.cardDeck = this.createCardDeck();
                
                // 为每个玩家发放初始手牌
                for (let i = 1; i <= 4; i++) {
                    if (this.players[i]) {
                        this.players[i].hand = this.drawCards(5); // 每人5张初始手牌
                        this.players[i].dao_xing = 0; // 道行
                        this.players[i].cheng_yi = 0; // 诚意
                        this.players[i].qi = 3; // 气（行动点）
                        this.players[i].influence_markers = 5; // 影响力标记
                    }
                }
                
                // 初始化游戏棋盘（3x3九宫格）
                this.gameBoard = this.createGameBoard();
                
                // 设置胜利条件
                this.victoryCondition = 10; // 道行达到10点获胜
            }

            createCardDeck() {
                // 创建64卦卡牌库
                const cards = [
                    // 乾宫八卦
                    { id: 'qian_1', name: '乾为天', type: 'hexagram', element: 'metal', cost: 2, dao_xing: 2, description: '天行健，君子以自强不息' },
                    { id: 'qian_2', name: '天风姤', type: 'hexagram', element: 'metal', cost: 1, dao_xing: 1, description: '姤，遇也，柔遇刚也' },
                    { id: 'qian_3', name: '天山遁', type: 'hexagram', element: 'metal', cost: 1, dao_xing: 1, description: '遁，亨，小利贞' },
                    { id: 'qian_4', name: '天地否', type: 'hexagram', element: 'metal', cost: 2, dao_xing: 1, description: '否之匪人，不利君子贞' },
                    
                    // 坤宫八卦
                    { id: 'kun_1', name: '坤为地', type: 'hexagram', element: 'earth', cost: 2, dao_xing: 2, description: '地势坤，君子以厚德载物' },
                    { id: 'kun_2', name: '地雷复', type: 'hexagram', element: 'earth', cost: 1, dao_xing: 1, description: '复，亨，出入无疾' },
                    { id: 'kun_3', name: '地泽临', type: 'hexagram', element: 'earth', cost: 1, dao_xing: 1, description: '临，元亨利贞' },
                    { id: 'kun_4', name: '地天泰', type: 'hexagram', element: 'earth', cost: 2, dao_xing: 2, description: '泰，小往大来，吉亨' },
                    
                    // 震宫八卦
                    { id: 'zhen_1', name: '震为雷', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '震，亨，震来虩虩' },
                    { id: 'zhen_2', name: '雷地豫', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '豫，利建侯行师' },
                    { id: 'zhen_3', name: '雷水解', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '解，利西南' },
                    { id: 'zhen_4', name: '雷风恒', type: 'hexagram', element: 'wood', cost: 2, dao_xing: 1, description: '恒，亨，无咎，利贞' },
                    
                    // 巽宫八卦
                    { id: 'xun_1', name: '巽为风', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '巽，小亨，利有攸往' },
                    { id: 'xun_2', name: '风天小畜', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '小畜，亨，密云不雨' },
                    { id: 'xun_3', name: '风火家人', type: 'hexagram', element: 'wood', cost: 1, dao_xing: 1, description: '家人，利女贞' },
                    { id: 'xun_4', name: '风雷益', type: 'hexagram', element: 'wood', cost: 2, dao_xing: 2, description: '益，利有攸往' },
                    
                    // 坎宫八卦
                    { id: 'kan_1', name: '坎为水', type: 'hexagram', element: 'water', cost: 1, dao_xing: 1, description: '坎，习坎，有孚' },
                    { id: 'kan_2', name: '水泽节', type: 'hexagram', element: 'water', cost: 1, dao_xing: 1, description: '节，亨，苦节不可贞' },
                    { id: 'kan_3', name: '水雷屯', type: 'hexagram', element: 'water', cost: 1, dao_xing: 1, description: '屯，元亨利贞' },
                    { id: 'kan_4', name: '水火既济', type: 'hexagram', element: 'water', cost: 2, dao_xing: 2, description: '既济，亨小，利贞' },
                    
                    // 离宫八卦
                    { id: 'li_1', name: '离为火', type: 'hexagram', element: 'fire', cost: 1, dao_xing: 1, description: '离，利贞，亨' },
                    { id: 'li_2', name: '火山旅', type: 'hexagram', element: 'fire', cost: 1, dao_xing: 1, description: '旅，小亨，旅贞吉' },
                    { id: 'li_3', name: '火风鼎', type: 'hexagram', element: 'fire', cost: 1, dao_xing: 1, description: '鼎，元吉，亨' },
                    { id: 'li_4', name: '火水未济', type: 'hexagram', element: 'fire', cost: 2, dao_xing: 1, description: '未济，亨，小狐汔济' },
                    
                    // 艮宫八卦
                    { id: 'gen_1', name: '艮为山', type: 'hexagram', element: 'earth', cost: 1, dao_xing: 1, description: '艮，艮其背，不获其身' },
                    { id: 'gen_2', name: '山火贲', type: 'hexagram', element: 'earth', cost: 1, dao_xing: 1, description: '贲，亨，小利有攸往' },
                    { id: 'gen_3', name: '山天大畜', type: 'hexagram', element: 'earth', cost: 2, dao_xing: 2, description: '大畜，利贞，不家食吉' },
                    { id: 'gen_4', name: '山泽损', type: 'hexagram', element: 'earth', cost: 1, dao_xing: 1, description: '损，有孚，元吉' },
                    
                    // 兑宫八卦
                    { id: 'dui_1', name: '兑为泽', type: 'hexagram', element: 'metal', cost: 1, dao_xing: 1, description: '兑，亨，利贞' },
                    { id: 'dui_2', name: '泽水困', type: 'hexagram', element: 'metal', cost: 1, dao_xing: 1, description: '困，亨，贞大人吉' },
                    { id: 'dui_3', name: '泽地萃', type: 'hexagram', element: 'metal', cost: 1, dao_xing: 1, description: '萃，亨，王假有庙' },
                    { id: 'dui_4', name: '泽山咸', type: 'hexagram', element: 'metal', cost: 2, dao_xing: 1, description: '咸，亨，利贞' }
                ];
                
                // 洗牌
                return this.shuffleArray([...cards]);
            }

            createGameBoard() {
                // 创建3x3九宫格棋盘，对应八卦方位
                return {
                    positions: {
                        'qian': { name: '乾', element: 'metal', players: [], influence: {} },
                        'kun': { name: '坤', element: 'earth', players: [], influence: {} },
                        'zhen': { name: '震', element: 'wood', players: [], influence: {} },
                        'xun': { name: '巽', element: 'wood', players: [], influence: {} },
                        'kan': { name: '坎', element: 'water', players: [], influence: {} },
                        'li': { name: '离', element: 'fire', players: [], influence: {} },
                        'gen': { name: '艮', element: 'earth', players: [], influence: {} },
                        'dui': { name: '兑', element: 'metal', players: [], influence: {} },
                        'center': { name: '中宫', element: 'earth', players: [1, 2, 3, 4], influence: {} }
                    }
                };
            }

            drawCards(count) {
                const drawnCards = [];
                for (let i = 0; i < count && this.cardDeck.length > 0; i++) {
                    drawnCards.push(this.cardDeck.pop());
                }
                return drawnCards;
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            startFourPlayerDemo() {
                if (this.isRunning) {
                    this.pauseGame();
                    return;
                }
                
                this.isRunning = true;
                this.gameState = 'playing';
                this.updateDisplay();
                this.logAction(this.currentPlayer, '四人演示开始！');
                
                if (this.autoPlay) {
                    this.runAutoDemo();
                }
            }

            runAutoDemo() {
                if (!this.isRunning) return;
                
                const speed = this.demoSpeed === 'fast' ? 1000 : this.demoSpeed === 'slow' ? 3000 : 2000;
                
                setTimeout(() => {
                    this.nextTurn();
                    if (this.isRunning && this.autoPlay) {
                        this.runAutoDemo();
                    }
                }, speed);
            }

            nextTurn() {
                if (!this.isRunning) return;
                
                // 执行当前玩家的行动
                this.executePlayerAction(this.currentPlayer);
                
                // 切换到下一个玩家
                this.currentPlayer = this.currentPlayer % 4 + 1;
                
                // 如果回到玩家1，增加回合数
                if (this.currentPlayer === 1) {
                    this.currentRound++;
                    
                    // 每3回合变化季节
                    if (this.currentRound % 3 === 0) {
                        this.currentSeason = (this.currentSeason + 1) % 4;
                        this.logAction(0, `季节变化：${this.seasons[this.currentSeason]}`);
                    }
                    
                    // 每2回合变化五行
                    if (this.currentRound % 2 === 0) {
                        this.currentWuxing = (this.currentWuxing + 1) % 5;
                        this.logAction(0, `五行主导变化：${this.wuxingElements[this.currentWuxing]}`);
                        this.updateWuxingDisplay();
                    }
                    
                    // 每回合天干地支变化
                    this.currentGanzhiIndex = (this.currentGanzhiIndex + 1) % 60;
                    
                    // 每4回合节气变化
                    if (this.currentRound % 4 === 0) {
                        this.currentJieqiIndex = (this.currentJieqiIndex + 1) % 24;
                        this.logAction(0, `节气变化：${this.jieqi[this.currentJieqiIndex]}`);
                    }
                    
                    // 每2回合阴阳变化
                    if (this.currentRound % 2 === 0) {
                        this.currentYinYang = (this.currentYinYang + 1) % 2;
                        this.logAction(0, `阴阳转换：${this.yinyang[this.currentYinYang]}时`);
                    }
                }
                
                this.updateDisplay();
                
                // 检查游戏结束条件
                const winner = this.checkVictoryConditions();
                if (winner) {
                    this.endGame(winner);
                } else if (this.currentRound > 40) {
                    // 超过40回合，按分数判断胜负
                    this.endGame(this.determineWinnerByScore());
                }
            }

            executePlayerAction(playerId) {
                const player = this.players[playerId];
                if (!player) return;
                
                // 检查胜利条件
                if (player.dao_xing >= this.victoryCondition) {
                    this.gameState = 'finished';
                    this.isRunning = false;
                    this.logAction(playerId, `🎉 ${player.name} 道行达到 ${player.dao_xing} 点，获得胜利！`);
                    return;
                }
                
                // 重置每回合的气
                player.qi = 3;
                
                // AI玩家智能决策
                const actionType = this.chooseActionType(player);
                
                switch (actionType) {
                    case 'play_card':
                        this.executePlayCard(playerId);
                        break;
                    case 'meditation':
                        this.executeMeditation(playerId);
                        break;
                    case 'move':
                        this.executeMove(playerId);
                        break;
                    case 'study':
                        this.executeStudy(playerId);
                        break;
                    default:
                        this.executeMeditation(playerId); // 默认冥想
                }
                
                this.updatePlayerInfo(playerId);
            }

            chooseActionType(player) {
                // AI智能决策逻辑
                const personality = player.personality;
                
                // 如果手牌充足且有高价值卡牌，优先出牌
                if (player.hand && player.hand.length > 0) {
                    const highValueCards = player.hand.filter(card => card.dao_xing >= 2);
                    if (highValueCards.length > 0 && player.qi >= 2) {
                        return 'play_card';
                    }
                }
                
                // 如果手牌不足，优先学习
                if (player.hand && player.hand.length < 3 && player.qi >= 2) {
                    return 'study';
                }
                
                // 根据性格特征选择行动
                if (personality) {
                    const rand = Math.random();
                    if (personality.name === '智慧学者' && rand < 0.4) {
                        return 'study';
                    } else if (personality.name === '能量专家' && rand < 0.3) {
                        return 'move';
                    }
                }
                
                // 默认冥想恢复
                return 'meditation';
            }

            executePlayCard(playerId) {
                const player = this.players[playerId];
                if (!player.hand || player.hand.length === 0 || player.qi < 1) {
                    this.executeMeditation(playerId);
                    return;
                }
                
                // 选择最佳卡牌
                const bestCard = this.selectBestCard(player);
                if (!bestCard) {
                    this.executeMeditation(playerId);
                    return;
                }
                
                // 消耗气和卡牌
                player.qi -= 1;
                const cardIndex = player.hand.indexOf(bestCard);
                player.hand.splice(cardIndex, 1);
                
                // 获得道行和诚意
                player.dao_xing += bestCard.dao_xing || 1;
                player.cheng_yi += 1;
                
                // 五行相生相克效果
                const elementBonus = this.getElementBonus(bestCard.element, player.position);
                if (elementBonus > 0) {
                    player.dao_xing += elementBonus;
                    this.logAction(playerId, `🃏 演卦《${bestCard.name}》(${bestCard.element}) +${bestCard.dao_xing + elementBonus}道行 (五行加成+${elementBonus})`);
                } else {
                    this.logAction(playerId, `🃏 演卦《${bestCard.name}》(${bestCard.element}) +${bestCard.dao_xing}道行`);
                }
                
                // 应用卦象特殊效果
                this.applyHexagramEffect(bestCard, player);
            }

            executeMeditation(playerId) {
                const player = this.players[playerId];
                if (player.qi < 1) return;
                
                player.qi -= 1;
                
                // 根据当前位置获得不同的冥想效果
                const position = player.position || 'center';
                const baguaEffect = this.baguaEffects[position];
                
                let healthGain = 5;
                let energyGain = 10;
                let daoXingGain = 0;
                
                if (baguaEffect) {
                    healthGain += baguaEffect.bonus.health || 0;
                    energyGain += baguaEffect.bonus.energy || 0;
                    
                    // 特定位置有道行加成
                    if (position === 'qian' || position === 'kun') {
                        daoXingGain = 1;
                    }
                }
                
                player.health = Math.min(200, player.health + healthGain);
                player.energy = Math.min(150, player.energy + energyGain);
                if (daoXingGain > 0) {
                    player.dao_xing += daoXingGain;
                }
                
                this.logAction(playerId, `🧘 在${baguaEffect?.name || '中宫'}冥想 +${healthGain}生命 +${energyGain}能量${daoXingGain > 0 ? ` +${daoXingGain}道行` : ''}`);
            }

            executeMove(playerId) {
                const player = this.players[playerId];
                if (player.qi < 1) return;
                
                player.qi -= 1;
                
                // 随机移动到新位置
                const positions = ['qian', 'kun', 'zhen', 'xun', 'kan', 'li', 'gen', 'dui', 'center'];
                const currentPos = player.position || 'center';
                const availablePositions = positions.filter(pos => pos !== currentPos);
                const newPosition = availablePositions[Math.floor(Math.random() * availablePositions.length)];
                
                player.position = newPosition;
                
                // 移动到新位置获得小幅加成
                const baguaEffect = this.baguaEffects[newPosition];
                player.energy = Math.min(150, player.energy + 5);
                
                this.logAction(playerId, `🚶 升沉至${baguaEffect?.name || '中宫'}(${baguaEffect?.element || '土'}) +5能量`);
            }

            executeStudy(playerId) {
                const player = this.players[playerId];
                if (player.qi < 2) {
                    this.executeMeditation(playerId);
                    return;
                }
                
                player.qi -= 2;
                
                // 抽取新卡牌
                const newCards = this.drawCards(1);
                if (newCards.length > 0) {
                    player.hand.push(...newCards);
                    player.cheng_yi += 1;
                    this.logAction(playerId, `📚 研习新卦《${newCards[0].name}》+1诚意`);
                } else {
                    // 卡牌库空了，获得道行补偿
                    player.dao_xing += 1;
                    this.logAction(playerId, `📚 研习古籍 +1道行`);
                }
            }

            selectBestCard(player) {
                if (!player.hand || player.hand.length === 0) return null;
                
                // 优先选择道行值高的卡牌
                return player.hand.reduce((best, current) => {
                    const bestValue = (best.dao_xing || 0) + this.getElementBonus(best.element, player.position);
                    const currentValue = (current.dao_xing || 0) + this.getElementBonus(current.element, player.position);
                    return currentValue > bestValue ? current : best;
                });
            }

            getElementBonus(cardElement, playerPosition) {
                // 五行相生相克系统
                const positionElement = this.baguaEffects[playerPosition]?.element;
                if (!positionElement || !cardElement) return 0;
                
                // 五行相生关系：木生火，火生土，土生金，金生水，水生木
                const shengRelations = {
                    'wood': 'fire',
                    'fire': 'earth', 
                    'earth': 'metal',
                    'metal': 'water',
                    'water': 'wood'
                };
                
                // 五行相克关系：木克土，土克水，水克火，火克金，金克木
                const keRelations = {
                    'wood': 'earth',
                    'earth': 'water',
                    'water': 'fire', 
                    'fire': 'metal',
                    'metal': 'wood'
                };
                
                // 转换中文元素到英文
                const elementMap = {
                    '金': 'metal', '木': 'wood', '水': 'water', '火': 'fire', '土': 'earth'
                };
                
                const posElement = elementMap[positionElement] || positionElement;
                const cardElem = elementMap[cardElement] || cardElement;
                
                if (shengRelations[posElement] === cardElem) {
                    return 1; // 相生加成
                } else if (keRelations[cardElem] === posElement) {
                    return 1; // 相克也有加成（克制对手）
                }
                
                return 0;
            }

            applyHexagramEffect(card, player) {
                // 根据卦象应用特殊效果
                if (card.name.includes('乾')) {
                    player.energy = Math.min(150, player.energy + 5);
                } else if (card.name.includes('坤')) {
                    player.health = Math.min(200, player.health + 5);
                } else if (card.name.includes('震') || card.name.includes('雷')) {
                    player.qi = Math.min(3, player.qi + 1);
                } else if (card.name.includes('泰') || card.name.includes('益')) {
                    player.dao_xing += 1;
                }
            }

            // 辅助方法
            getSeasonBonus(actionName) {
                // 根据季节和行动类型返回加成
                return { health: 0, energy: 0 };
            }

            getYinYangBonus(actionName) {
                // 根据阴阳和行动类型返回加成
                return { health: 0, energy: 0 };
            }

            updateWuxingDisplay() {
                // 更新五行显示
            }

            checkVictoryConditions() {
                // 检查胜利条件
                return null;
            }

            determineWinnerByScore() {
                // 根据分数确定胜者
                return 1;
            }

            endGame(winner) {
                this.isRunning = false;
                this.gameState = 'ended';
                this.logAction(0, `游戏结束！玩家${winner}获胜！`);
            }

            pauseGame() {
                this.isRunning = false;
                this.gameState = 'paused';
            }

            logAction(playerId, message) {
                // 记录游戏日志到控制台
                console.log(`玩家${playerId}: ${message}`);
                
                // 如果有Vue实例，也添加到游戏日志中
                if (window.vueApp && window.vueApp.addGameLog) {
                    const playerName = playerId === 0 ? '系统' : 
                        (this.players[playerId] ? this.players[playerId].name : `玩家${playerId}`);
                    window.vueApp.addGameLog(`${playerName}: ${message}`, false);
                }
            }

            updatePlayerInfo(playerId) {
                // 更新玩家信息显示
                const player = this.players[playerId];
                if (player) {
                    console.log(`更新玩家${playerId}信息:`, {
                        health: player.health,
                        energy: player.energy,
                        status: player.status,
                        position: player.position
                    });
                }
            }

            updateDisplay() {
                // 更新游戏显示
                console.log('更新游戏显示:', {
                    currentPlayer: this.currentPlayer,
                    currentRound: this.currentRound,
                    gameState: this.gameState,
                    season: this.seasons[this.currentSeason],
                    wuxing: this.wuxingElements[this.currentWuxing]
                });
            }
        }

        const { createApp } = Vue;
        
        const app = createApp({
            delimiters: ['[[', ']]'], // 使用不同的分隔符避免与Jinja2冲突
            data() {
                return {
                    showCodex: false,
                    codexFilter: 'all',
                    allCards: [
                        // === 完整64卦系统 ===
                        // 乾宫八卦
                        { id: 1, name: '乾为天', type: '六十四卦', category: '乾宫', element: '金', cost: 3, power: 5, description: '天行健，君子以自强不息。乾卦纯阳，象征刚健、创造、领导。', effect: '获得3点道行，下回合行动优先，激活领导力', link: 'https://baike.baidu.com/item/乾卦' },
                        { id: 2, name: '天风姤', type: '六十四卦', category: '乾宫', element: '金', cost: 2, power: 3, description: '天下有风，姤。一阴始生，阳气渐消。', effect: '削弱对手1点威力，获得1点气', link: 'https://baike.baidu.com/item/姤卦' },
                        { id: 3, name: '天山遁', type: '六十四卦', category: '乾宫', element: '金', cost: 2, power: 2, description: '天下有山，遁。君子以远小人，不恶而严。', effect: '回避攻击，下回合获得反击机会', link: 'https://baike.baidu.com/item/遁卦' },
                        { id: 4, name: '天地否', type: '六十四卦', category: '乾宫', element: '金', cost: 3, power: 1, description: '天地不交，否。内阴外阳，闭塞不通。', effect: '阻止对手下回合行动，自身获得防护', link: 'https://baike.baidu.com/item/否卦' },
                        { id: 5, name: '风地观', type: '六十四卦', category: '乾宫', element: '木', cost: 2, power: 2, description: '风行地上，观。君子以省方观民设教。', effect: '查看所有玩家状态，获得洞察加成', link: 'https://baike.baidu.com/item/观卦' },
                        { id: 6, name: '山地剥', type: '六十四卦', category: '乾宫', element: '土', cost: 3, power: 4, description: '山附于地，剥。上以厚下安宅。', effect: '剥夺对手1张手牌，获得其效果', link: 'https://baike.baidu.com/item/剥卦' },
                        { id: 7, name: '火地晋', type: '六十四卦', category: '乾宫', element: '火', cost: 2, power: 4, description: '明出地上，晋。君子以自昭明德。', effect: '提升自身威力+2，照亮隐藏信息', link: 'https://baike.baidu.com/item/晋卦' },
                        { id: 8, name: '火天大有', type: '六十四卦', category: '乾宫', element: '火', cost: 4, power: 6, description: '火在天上，大有。君子以遏恶扬善，顺天休命。', effect: '获得大量资源，威力+3，道行+2', link: 'https://baike.baidu.com/item/大有卦' },

                        // 坤宫八卦
                        { id: 9, name: '坤为地', type: '六十四卦', category: '坤宫', element: '土', cost: 3, power: 3, description: '地势坤，君子以厚德载物。坤卦纯阴，象征柔顺、包容、承载。', effect: '恢复3点生命值，获得厚德载物效果', link: 'https://baike.baidu.com/item/坤卦' },
                        { id: 10, name: '地雷复', type: '六十四卦', category: '坤宫', element: '土', cost: 2, power: 3, description: '雷在地中，复。先王以至日闭关，商旅不行。', effect: '重置冷却时间，获得新生机会', link: 'https://baike.baidu.com/item/复卦' },
                        { id: 11, name: '地泽临', type: '六十四卦', category: '坤宫', element: '土', cost: 2, power: 4, description: '泽上有地，临。君子以教思无穷，容保民无疆。', effect: '临近胜利，威力+2，影响相邻玩家', link: 'https://baike.baidu.com/item/临卦' },
                        { id: 12, name: '地天泰', type: '六十四卦', category: '坤宫', element: '土', cost: 3, power: 5, description: '天地交，泰。后以财成天地之道，辅相天地之宜。', effect: '天地交泰，所有属性+1，获得和谐加成', link: 'https://baike.baidu.com/item/泰卦' },
                        { id: 13, name: '雷天大壮', type: '六十四卦', category: '坤宫', element: '木', cost: 3, power: 6, description: '雷在天上，大壮。君子以非礼弗履。', effect: '威力大增+3，震慑所有对手', link: 'https://baike.baidu.com/item/大壮卦' },
                        { id: 14, name: '泽天夬', type: '六十四卦', category: '坤宫', element: '金', cost: 4, power: 5, description: '泽上于天，夬。君子以施禄及下，居德则忌。', effect: '决断执行，立即解决一个问题', link: 'https://baike.baidu.com/item/夬卦' },
                        { id: 15, name: '水天需', type: '六十四卦', category: '坤宫', element: '水', cost: 2, power: 2, description: '云上于天，需。君子以饮食宴乐。', effect: '等待时机，下回合获得双倍效果', link: 'https://baike.baidu.com/item/需卦' },
                        { id: 16, name: '水地比', type: '六十四卦', category: '坤宫', element: '水', cost: 2, power: 3, description: '地上有水，比。先王以建万国，亲诸侯。', effect: '与其他玩家结盟，共享部分效果', link: 'https://baike.baidu.com/item/比卦' },

                        // 震宫八卦
                        { id: 17, name: '震为雷', type: '六十四卦', category: '震宫', element: '木', cost: 2, power: 4, description: '洊雷，震。君子以恐惧修省。震卦象征震动、觉醒、行动。', effect: '震动全场，对所有敌人造成1点伤害', link: 'https://baike.baidu.com/item/震卦' },
                        { id: 18, name: '雷地豫', type: '六十四卦', category: '震宫', element: '木', cost: 2, power: 3, description: '雷出地奋，豫。先王以作乐崇德，殷荐之上帝。', effect: '获得愉悦状态，下回合威力+2', link: 'https://baike.baidu.com/item/豫卦' },
                        { id: 19, name: '雷水解', type: '六十四卦', category: '震宫', element: '木', cost: 3, power: 3, description: '雷雨作，解。君子以赦过宥罪。', effect: '解除所有负面状态，获得新开始', link: 'https://baike.baidu.com/item/解卦' },
                        { id: 20, name: '雷风恒', type: '六十四卦', category: '震宫', element: '木', cost: 3, power: 4, description: '雷风，恒。君子以立不易方。', effect: '获得恒久效果，持续3回合威力+1', link: 'https://baike.baidu.com/item/恒卦' },
                        { id: 21, name: '地风升', type: '六十四卦', category: '震宫', element: '土', cost: 2, power: 3, description: '地中生木，升。君子以顺德，积小以高大。', effect: '逐步提升，每回合威力+1', link: 'https://baike.baidu.com/item/升卦' },
                        { id: 22, name: '水风井', type: '六十四卦', category: '震宫', element: '水', cost: 2, power: 2, description: '木上有水，井。君子以劳民劝相。', effect: '提供持续资源，每回合恢复1点生命', link: 'https://baike.baidu.com/item/井卦' },
                        { id: 23, name: '泽风大过', type: '六十四卦', category: '震宫', element: '金', cost: 4, power: 7, description: '泽灭木，大过。君子以独立不惧，遁世无闷。', effect: '超越极限，威力大幅提升+4', link: 'https://baike.baidu.com/item/大过卦' },
                        { id: 24, name: '泽雷随', type: '六十四卦', category: '震宫', element: '金', cost: 2, power: 3, description: '泽中有雷，随。君子以向晦入宴息。', effect: '跟随强者，复制目标玩家的上一个效果', link: 'https://baike.baidu.com/item/随卦' },

                        // 巽宫八卦
                        { id: 25, name: '巽为风', type: '六十四卦', category: '巽宫', element: '木', cost: 1, power: 2, description: '随风，巽。君子以申命行事。巽卦象征风、顺从、渗透。', effect: '灵活移动，获得1点气，无视阻挡', link: 'https://baike.baidu.com/item/巽卦' },
                        { id: 26, name: '风天小畜', type: '六十四卦', category: '巽宫', element: '木', cost: 2, power: 2, description: '风行天上，小畜。君子以懿文德。', effect: '小有积蓄，获得1点道行和1点诚意', link: 'https://baike.baidu.com/item/小畜卦' },
                        { id: 27, name: '风火家人', type: '六十四卦', category: '巽宫', element: '木', cost: 2, power: 3, description: '风自火出，家人。君子以言有物，而行有恒。', effect: '家和万事兴，与盟友共享效果', link: 'https://baike.baidu.com/item/家人卦' },
                        { id: 28, name: '风雷益', type: '六十四卦', category: '巽宫', element: '木', cost: 3, power: 4, description: '风雷，益。君子以见善则迁，有过则改。', effect: '获得增益，威力+2，道行+1', link: 'https://baike.baidu.com/item/益卦' },
                        { id: 29, name: '天雷无妄', type: '六十四卦', category: '巽宫', element: '金', cost: 3, power: 3, description: '天下雷行，无妄。先王以茂对时，育万物。', effect: '无妄之灾，随机效果（可能有利或不利）', link: 'https://baike.baidu.com/item/无妄卦' },
                        { id: 30, name: '火雷噬嗑', type: '六十四卦', category: '巽宫', element: '火', cost: 3, power: 5, description: '雷电噬嗑，噬嗑。先王以明罚敕法。', effect: '咬合决断，对目标造成4点伤害', link: 'https://baike.baidu.com/item/噬嗑卦' },
                        { id: 31, name: '山雷颐', type: '六十四卦', category: '巽宫', element: '土', cost: 2, power: 2, description: '山下有雷，颐。君子以慎言语，节饮食。', effect: '颐养生息，恢复2点生命值，获得养生效果', link: 'https://baike.baidu.com/item/颐卦' },
                        { id: 32, name: '山风蛊', type: '六十四卦', category: '巽宫', element: '土', cost: 3, power: 3, description: '山下有风，蛊。君子以振民育德。', effect: '整顿革新，清除负面状态，获得新机', link: 'https://baike.baidu.com/item/蛊卦' },

                        // 坎宫八卦
                        { id: 33, name: '坎为水', type: '六十四卦', category: '坎宫', element: '水', cost: 2, power: 3, description: '习坎，有孚。维心亨，行有尚。坎卦象征水、险阻、智慧。', effect: '智慧如水，查看对手手牌，抽取1张卡', link: 'https://baike.baidu.com/item/坎卦' },
                        { id: 34, name: '水泽节', type: '六十四卦', category: '坎宫', element: '水', cost: 2, power: 2, description: '泽上有水，节。君子以制数度，议德行。', effect: '节制有度，减少消耗，获得节约效果', link: 'https://baike.baidu.com/item/节卦' },
                        { id: 35, name: '水雷屯', type: '六十四卦', category: '坎宫', element: '水', cost: 3, power: 4, description: '云雷屯，君子以经纶。屯卦象征初生艰难。', effect: '屯积力量，抽取2张卡，获得1点诚意', link: 'https://baike.baidu.com/item/屯卦' },
                        { id: 36, name: '水火既济', type: '六十四卦', category: '坎宫', element: '水', cost: 4, power: 5, description: '水在火上，既济。君子以思患而豫防之。', effect: '水火既济，完美平衡，所有效果+1', link: 'https://baike.baidu.com/item/既济卦' },
                        { id: 37, name: '泽火革', type: '六十四卦', category: '坎宫', element: '金', cost: 3, power: 4, description: '泽中有火，革。君子以治历明时。', effect: '革故鼎新，改变游戏规则1回合', link: 'https://baike.baidu.com/item/革卦' },
                        { id: 38, name: '雷火丰', type: '六十四卦', category: '坎宫', element: '木', cost: 3, power: 5, description: '雷电皆至，丰。君子以折狱致刑。', effect: '丰收时节，获得丰厚奖励，威力+3', link: 'https://baike.baidu.com/item/丰卦' },
                        { id: 39, name: '地火明夷', type: '六十四卦', category: '坎宫', element: '土', cost: 2, power: 2, description: '明入地中，明夷。君子以莅众，用晦而明。', effect: '明夷待时，隐藏实力，下回合威力翻倍', link: 'https://baike.baidu.com/item/明夷卦' },
                        { id: 40, name: '地水师', type: '六十四卦', category: '坎宫', element: '土', cost: 3, power: 4, description: '地中有水，师。君子以容民畜众。', effect: '统帅军队，召集援军，获得额外行动', link: 'https://baike.baidu.com/item/师卦' },

                        // 离宫八卦
                        { id: 41, name: '离为火', type: '六十四卦', category: '离宫', element: '火', cost: 2, power: 3, description: '明两作，离。大人以继明照于四方。离卦象征火、光明、文明。', effect: '光明照耀，揭示隐藏信息，造成2点伤害', link: 'https://baike.baidu.com/item/离卦' },
                        { id: 42, name: '火山旅', type: '六十四卦', category: '离宫', element: '火', cost: 2, power: 3, description: '山上有火，旅。君子以明慎用刑，而不留狱。', effect: '旅途奔波，移动灵活，获得探索奖励', link: 'https://baike.baidu.com/item/旅卦' },
                        { id: 43, name: '火风鼎', type: '六十四卦', category: '离宫', element: '火', cost: 3, power: 4, description: '木上有火，鼎。君子以正位凝命。', effect: '鼎新革故，提升品质，威力+2，道行+1', link: 'https://baike.baidu.com/item/鼎卦' },
                        { id: 44, name: '火水未济', type: '六十四卦', category: '离宫', element: '火', cost: 3, power: 3, description: '火在水上，未济。君子以慎辨物居方。', effect: '未济待成，蓄势待发，下回合效果翻倍', link: 'https://baike.baidu.com/item/未济卦' },
                        { id: 45, name: '山水蒙', type: '六十四卦', category: '离宫', element: '土', cost: 2, power: 2, description: '山下出泉，蒙。君子以果行育德。', effect: '启蒙教育，学习技能，下次出牌效果翻倍', link: 'https://baike.baidu.com/item/蒙卦' },
                        { id: 46, name: '风水涣', type: '六十四卦', category: '离宫', element: '木', cost: 2, power: 3, description: '风行水上，涣。先王以享于帝立庙。', effect: '涣散聚合，重新分配资源', link: 'https://baike.baidu.com/item/涣卦' },
                        { id: 47, name: '天水讼', type: '六十四卦', category: '离宫', element: '金', cost: 4, power: 5, description: '天与水违行，讼。君子以作事谋始。', effect: '争讼冲突，强制对手弃牌，造成3点伤害', link: 'https://baike.baidu.com/item/讼卦' },
                        { id: 48, name: '天火同人', type: '六十四卦', category: '离宫', element: '金', cost: 3, power: 4, description: '天与火，同人。君子以类族辨物。', effect: '同人协力，与所有盟友共享效果', link: 'https://baike.baidu.com/item/同人卦' },

                        // 艮宫八卦
                        { id: 49, name: '艮为山', type: '六十四卦', category: '艮宫', element: '土', cost: 3, power: 1, description: '兼山，艮。君子以思不出其位。艮卦象征山、静止、稳定。', effect: '稳如泰山，获得护盾，免疫下次攻击', link: 'https://baike.baidu.com/item/艮卦' },
                        { id: 50, name: '山火贲', type: '六十四卦', category: '艮宫', element: '土', cost: 2, power: 3, description: '山下有火，贲。君子以明庶政，无敢折狱。', effect: '文饰美化，提升形象，获得魅力加成', link: 'https://baike.baidu.com/item/贲卦' },
                        { id: 51, name: '山天大畜', type: '六十四卦', category: '艮宫', element: '土', cost: 3, power: 4, description: '天在山中，大畜。君子以多识前言往行，以畜其德。', effect: '大有积蓄，获得2点道行，2点诚意', link: 'https://baike.baidu.com/item/大畜卦' },
                        { id: 52, name: '山泽损', type: '六十四卦', category: '艮宫', element: '土', cost: 2, power: 2, description: '山下有泽，损。君子以惩忿窒欲。', effect: '损己利人，牺牲1点生命值，盟友获得2点', link: 'https://baike.baidu.com/item/损卦' },
                        { id: 53, name: '火泽睽', type: '六十四卦', category: '艮宫', element: '火', cost: 3, power: 3, description: '上火下泽，睽。君子以同而异。', effect: '睽违分离，分化对手联盟', link: 'https://baike.baidu.com/item/睽卦' },
                        { id: 54, name: '天泽履', type: '六十四卦', category: '艮宫', element: '金', cost: 2, power: 3, description: '上天下泽，履。君子以辨上下，定民志。', effect: '履行正道，获得正义加成，威力+1', link: 'https://baike.baidu.com/item/履卦' },
                        { id: 55, name: '风泽中孚', type: '六十四卦', category: '艮宫', element: '木', cost: 2, power: 3, description: '泽上有风，中孚。君子以议狱缓死。', effect: '中心诚信，获得信任，与所有玩家和解', link: 'https://baike.baidu.com/item/中孚卦' },
                        { id: 56, name: '风山渐', type: '六十四卦', category: '艮宫', element: '木', cost: 2, power: 2, description: '山上有木，渐。君子以居贤德善俗。', effect: '渐进发展，每回合威力+1，持续3回合', link: 'https://baike.baidu.com/item/渐卦' },

                        // 兑宫八卦
                        { id: 57, name: '兑为泽', type: '六十四卦', category: '兑宫', element: '金', cost: 1, power: 2, description: '丽泽，兑。君子以朋友讲习。兑卦象征泽、喜悦、交流。', effect: '喜悦和谐，与其他玩家交换卡牌或资源', link: 'https://baike.baidu.com/item/兑卦' },
                        { id: 58, name: '泽水困', type: '六十四卦', category: '兑宫', element: '金', cost: 3, power: 2, description: '泽无水，困。君子以致命遂志。', effect: '困境求生，在危机中获得突破机会', link: 'https://baike.baidu.com/item/困卦' },
                        { id: 59, name: '泽地萃', type: '六十四卦', category: '兑宫', element: '金', cost: 2, power: 4, description: '泽上于地，萃。君子以除戎器，戒不虞。', effect: '聚集力量，召集所有盟友共同行动', link: 'https://baike.baidu.com/item/萃卦' },
                        { id: 60, name: '泽山咸', type: '六十四卦', category: '兑宫', element: '金', cost: 2, power: 3, description: '山上有泽，咸。君子以虚受人。', effect: '感应相通，与目标玩家心意相通', link: 'https://baike.baidu.com/item/咸卦' },
                        { id: 61, name: '水山蹇', type: '六十四卦', category: '兑宫', element: '水', cost: 3, power: 2, description: '山上有水，蹇。君子以反身修德。', effect: '蹇难困顿，反思修德，下回合获得智慧加成', link: 'https://baike.baidu.com/item/蹇卦' },
                        { id: 62, name: '地山谦', type: '六十四卦', category: '兑宫', element: '土', cost: 1, power: 2, description: '地中有山，谦。君子以裒多益寡，称物平施。', effect: '谦逊美德，获得所有人好感，免疫攻击1回合', link: 'https://baike.baidu.com/item/谦卦' },
                        { id: 63, name: '雷山小过', type: '六十四卦', category: '兑宫', element: '木', cost: 2, power: 3, description: '山上有雷，小过。君子以行过乎恭，丧过乎哀，用过乎俭。', effect: '小有过错，谨慎行事，获得谨慎加成', link: 'https://baike.baidu.com/item/小过卦' },
                        { id: 64, name: '雷泽归妹', type: '六十四卦', category: '兑宫', element: '木', cost: 3, power: 4, description: '泽上有雷，归妹。君子以永终知敝。', effect: '归妹成家，获得伴侣支持，威力+2', link: 'https://baike.baidu.com/item/归妹卦' },

                        // === 天时地利人和卡牌（保留精华部分）===
                        // 天时卡牌（精选）
                        { id: 101, name: '立春', type: '天时卡', category: '节气', element: '木', cost: 1, power: 2, description: '万物复苏，生机勃发。春季第一个节气，象征新的开始。', effect: '所有玩家获得1点气，木属性卡牌效果+1', link: 'https://baike.baidu.com/item/立春' },
                        { id: 102, name: '夏至', type: '天时卡', category: '节气', element: '火', cost: 3, power: 4, description: '阳气最盛，白昼最长。夏季顶峰，火元素达到极致。', effect: '火属性卡牌威力翻倍，获得3点道行', link: 'https://baike.baidu.com/item/夏至' },
                        { id: 103, name: '秋分', type: '天时卡', category: '节气', element: '金', cost: 2, power: 3, description: '秋高气爽，收获时节。金秋时节，收获智慧。', effect: '抽取3张卡，金属性效果增强', link: 'https://baike.baidu.com/item/秋分' },
                        { id: 104, name: '冬至', type: '天时卡', category: '节气', element: '水', cost: 3, power: 2, description: '阴气最盛，一阳来复。冬季深处，蕴含新生。', effect: '获得护盾，下回合行动力翻倍', link: 'https://baike.baidu.com/item/冬至' },
                        { id: 105, name: '甲子', type: '天时卡', category: '干支', element: '木', cost: 2, power: 4, description: '六十甲子之首，象征新的轮回开始。', effect: '重置所有冷却，获得额外回合', link: 'https://baike.baidu.com/item/甲子' },

                        // 地利卡牌（精选）
                        { id: 201, name: '中央土', type: '地利卡', category: '方位', element: '土', cost: 3, power: 5, description: '中央戊己土，四方之主。土气最为厚重。', effect: '所有属性平衡增强，获得稳定核心', link: 'https://baike.baidu.com/item/中央' },
                        { id: 202, name: '高山', type: '地利卡', category: '地形', element: '土', cost: 3, power: 4, description: '巍峨高山，不可撼动。提供强大的防御力。', effect: '获得山岳护盾，免疫物理攻击', link: 'https://baike.baidu.com/item/高山' },
                        { id: 203, name: '江河', type: '地利卡', category: '地形', element: '水', cost: 2, power: 3, description: '奔流不息的江河，带来生命活力。', effect: '持续恢复生命值，水属性增强', link: 'https://baike.baidu.com/item/江河' },

                        // 人和卡牌（精选）
                        { id: 301, name: '兵法三十六计', type: '人和卡', category: '策略', element: '无', cost: 4, power: 6, description: '古代兵法智慧结晶，包含三十六种战略战术。', effect: '选择一种计策执行，效果随机但强大', link: 'https://baike.baidu.com/item/三十六计' },
                        { id: 302, name: '知己知彼', type: '人和卡', category: '策略', element: '无', cost: 2, power: 2, description: '孙子兵法核心思想，了解敌我双方情况。', effect: '查看所有对手手牌和状态', link: 'https://baike.baidu.com/item/知己知彼' },
                        { id: 303, name: '琴棋书画', type: '人和卡', category: '技能', element: '无', cost: 2, power: 3, description: '文人四艺，修身养性之道。', effect: '获得文化加成，诚意+2，道行+1', link: 'https://baike.baidu.com/item/琴棋书画' }
                    ],
                    tianJiBianGame: null, // TianJiBianGame实例
                    gameState: {
                        game_id: 'test123',
                        current_player: 'player_1',
                        turn: 1,
                        status: 'waiting',
                        season: '春',
                        wuxing: '木'
                    },
                    currentPlayer: null,
                    otherPlayers: [],
                    playerHand: [],
                    gameBoard: Array(64).fill(null).map(() => ({ card: null })),
                    selectedCard: null,
                    selectedPosition: null,
                    selectedBagua: null, // 选中的八卦位置
                    chatMessages: [],
                    newMessage: '',
                    connectionStatus: { connected: false },
                    isLoading: false, // 改为false，避免页面被遮罩
                    showGameEnd: false,
                    gameResult: null,
                    websocket: null,
                    gameLogs: [], // 游戏日志
                    boardView: 'circle', // 棋盘视图：'circle' 或 'jiugongge'
                    isSimulating: false, // 是否正在模拟
                    simulationStep: 0, // 当前模拟步骤
                    simulationTimer: null, // 模拟定时器
                    // 四人自动模拟相关数据
                    autoPlay: false, // 是否自动播放
                    playerActionRecords: [], // 玩家操作记录
                    fourPlayerDemoData: {
                        players: [],
                        isActive: false,
                        currentPlayerIndex: 0
                    }, // 四人对战演示数据
                    // 卡牌图鉴数据
                    totalCards: 68, // 天机变完整卡牌系统：天时24张+地利16张+人和20张+基础卦8张
                    playedCards: 0, // 已打出卡牌数
                    // 详细游戏状态数据
                    currentWuxing: '木', // 当前五行主导
                    currentTiangan: '甲', // 当前天干
                    currentDizhi: '子', // 当前地支
                    currentJieqi: '立春', // 当前节气
                    currentYinyang: '阳', // 当前阴阳
                    currentGameState: '进行中', // 当前游戏状态
                    // 教育功能数据
                    dailyWisdom: {
                        quote: "天行健，君子以自强不息；地势坤，君子以厚德载物",
                        source: "《易经·乾坤》"
                    },
                    // 四人游戏演示功能
                    isRunning: false,
                    autoPlay: true,
                    demoSpeed: 'normal', // 'slow', 'normal', 'fast'
                    currentRound: 1,
                    currentSeason: 0, // 0-春, 1-夏, 2-秋, 3-冬
                    seasons: ['春', '夏', '秋', '冬'],
                    // 反馈系统
                    feedbackMessage: '',
                    feedbackType: 'info', // success, error, warning, info
                    feedbackTimeout: null,
                    
                    // 确认对话框
                    showConfirmDialog: false,
                    confirmDialog: {
                        title: '',
                        message: '',
                        icon: '',
                        type: 'normal', // normal, danger
                        onConfirm: null
                    },
                    
                    // 操作提示
                    actionHint: '',
                    hintTimeout: null,
                    
                    // AI玩家数据
                    players: {
                        1: { 
                            name: '玩家1 (人类)', 
                            type: 'human', 
                            position: 'center', 
                            health: 100, 
                            energy: 50, 
                            status: '正常',
                            // 新增卡牌游戏属性
                            dao_xing: 0,
                            cheng_yi: 0,
                            qi: 3,
                            hand: [],
                            personality: {
                                name: '平衡修行者',
                                symbol: '🎮',
                                traits: ['平衡', '适应', '全面'],
                                description: '追求阴阳平衡的修行者'
                            }
                        },
                        2: { 
                            name: 'AI-智者', 
                            type: 'ai', 
                            position: 'qian', 
                            health: 100, 
                            energy: 50, 
                            status: '正常',
                            // 新增卡牌游戏属性
                            dao_xing: 0,
                            cheng_yi: 0,
                            qi: 3,
                            hand: [],
                            personality: {
                                name: '天行智者',
                                symbol: '🧠',
                                traits: ['智慧', '领导', '刚健'],
                                description: '天行健，君子以自强不息'
                            }
                        },
                        3: { 
                            name: 'AI-贤人', 
                            type: 'ai', 
                            position: 'kun', 
                            health: 100, 
                            energy: 50, 
                            status: '正常',
                            // 新增卡牌游戏属性
                            dao_xing: 0,
                            cheng_yi: 0,
                            qi: 3,
                            hand: [],
                            personality: {
                                name: '厚德贤者',
                                symbol: '💚',
                                traits: ['包容', '稳重', '守护'],
                                description: '地势坤，君子以厚德载物'
                            }
                        },
                        4: { 
                            name: 'AI-学者', 
                            type: 'ai', 
                            position: 'zhen', 
                            health: 100, 
                            energy: 50, 
                            status: '正常',
                            // 新增卡牌游戏属性
                            dao_xing: 0,
                            cheng_yi: 0,
                            qi: 3,
                            hand: [],
                            personality: {
                                name: '雷动学者',
                                symbol: '⚡',
                                traits: ['敏捷', '创新', '突破'],
                                description: '震为雷，动而有威'
                            }
                        }
                    },
                    // 新增卡牌游戏状态
                    gameBoard: Array(9).fill(null).map(() => ({ card: null, player: null })), // 3x3九宫格
                    victoryConditions: {
                        dao_xing_target: 10,
                        cheng_yi_target: 10,
                        board_control_target: 5
                    },
                    cardDeck: [], // 卡牌库
                    discardPile: [], // 弃牌堆
                    // 八卦位置详细信息
                    baguaPositions: {
                        'qian': { 
                            name: '乾', 
                            element: '金', 
                            effect: '增强领导力', 
                            bonus: { health: 3, energy: 2 },
                            guaci: '乾：元亨利贞',
                            meaning: '天行健，自强不息',
                            symbol: '☰'
                        },
                        'kun': { 
                            name: '坤', 
                            element: '土', 
                            effect: '增强包容力', 
                            bonus: { health: 4, energy: 1 },
                            guaci: '坤：元亨，利牝马之贞',
                            meaning: '地势坤，厚德载物',
                            symbol: '☷'
                        },
                        'zhen': { 
                            name: '震', 
                            element: '木', 
                            effect: '增强行动力', 
                            bonus: { health: 2, energy: 4 },
                            guaci: '震：亨，震来虩虩',
                            meaning: '雷声震动，惊醒万物',
                            symbol: '☳'
                        },
                        'xun': { 
                            name: '巽', 
                            element: '木', 
                            effect: '增强渗透力', 
                            bonus: { health: 2, energy: 3 },
                            guaci: '巽：小亨，利有攸往',
                            meaning: '风行天下，无所不入',
                            symbol: '☴'
                        },
                        'kan': { 
                            name: '坎', 
                            element: '水', 
                            effect: '增强智慧力', 
                            bonus: { health: 1, energy: 5 },
                            guaci: '坎：习坎，有孚',
                            meaning: '水流不息，智慧如渊',
                            symbol: '☵'
                        },
                        'li': { 
                            name: '离', 
                            element: '火', 
                            effect: '增强洞察力', 
                            bonus: { health: 3, energy: 2 },
                            guaci: '离：利贞，亨',
                            meaning: '火光明照，洞察万物',
                            symbol: '☲'
                        },
                        'gen': { 
                            name: '艮', 
                            element: '土', 
                            effect: '增强稳定力', 
                            bonus: { health: 5, energy: 0 },
                            guaci: '艮：艮其背，不获其身',
                            meaning: '山止如磐，稳重不移',
                            symbol: '☶'
                        },
                        'dui': { 
                            name: '兑', 
                            element: '金', 
                            effect: '增强交流力', 
                            bonus: { health: 2, energy: 3 },
                            guaci: '兑：亨，利贞',
                            meaning: '泽润万物，和悦交流',
                            symbol: '☱'
                        }
                    }
                };
            },
            computed: {
                isMyTurn() {
                    return this.gameState && this.currentPlayer && 
                           this.gameState.current_player === this.currentPlayer.id;
                },
                filteredCodexCards() {
                    if (this.codexFilter === 'all') {
                        return this.allCards;
                    }
                    const filterMap = {
                        'tian': '天时卡',
                        'di': '地利卡',
                        'ren': '人和卡',
                        'gua': '六十四卦'
                    };
                    const filterType = filterMap[this.codexFilter];
                    return this.allCards.filter(card => card.type === filterType);
                }
            },
            mounted() {
                console.log('Vue.js 应用已挂载');
                console.log('初始数据状态:', {
                    isLoading: this.isLoading,
                    gameState: this.gameState,
                    currentPlayer: this.currentPlayer,
                    connectionStatus: this.connectionStatus
                });
                this.initializeGame();
            },
            methods: {
                initializeGame() {
                    console.log('开始初始化游戏');
                    // 从URL路径获取游戏ID (例如: /game/test123)
                    const pathParts = window.location.pathname.split('/');
                    const gameId = pathParts[pathParts.length - 1] || 'demo_game_123';
                    console.log('游戏ID:', gameId);
                    console.log('URL路径:', window.location.pathname);
                    
                    // 初始化TianJiBianGame实例
                    this.tianJiBianGame = new TianJiBianGame();
                    this.tianJiBianGame.initializeGame();
                    
                    // 同步游戏状态到Vue
                    this.syncGameStateFromTianJiBian();
                    
                    // 初始化WebSocket连接
                    this.initWebSocket(gameId);
                    
                    // 加载游戏状态
                    this.loadGameState(gameId);
                    
                    // 添加初始化日志
                    this.addGameLog('游戏初始化完成，真实卡牌系统已启动', false);
                },
                
                initWebSocket(gameId) {
                    // 这里应该初始化WebSocket连接
                    // 由于简化，我们先模拟连接状态
                    setTimeout(() => {
                        this.connectionStatus.connected = true;
                        console.log('WebSocket连接状态已更新');
                    }, 500);
                },
                
                loadGameState(gameId) {
                    console.log('开始加载游戏状态，游戏ID:', gameId);
                    // 模拟加载游戏状态
                    this.gameState = {
                        game_id: gameId,
                        current_player: 'player_1',
                        turn: 1,
                        phase: '行动阶段',
                        status: '进行中',
                        yin: 5,
                        yang: 5,
                        qi: 10,
                        hand: [
                            { id: 1, name: '乾为天', type: '卦牌', description: '纯阳之卦，增强阳气+3' },
                            { id: 2, name: '坤为地', type: '卦牌', description: '纯阴之卦，增强阴气+3' },
                            { id: 3, name: '水雷屯', type: '卦牌', description: '困难开始，需要坚持' },
                            { id: 4, name: '山水蒙', type: '卦牌', description: '启蒙教育，增加智慧' },
                            { id: 5, name: '水天需', type: '卦牌', description: '等待时机，恢复气力' }
                        ]
                    };
                    
                    this.currentPlayer = {
                        id: 'player_1',
                        name: '玩家1',
                        qi: 80,
                        dao: 60,
                        sincerity: 70,
                        yin: 45,
                        yang: 55,
                        elements: {
                            wood: 20,
                            fire: 15,
                            earth: 25,
                            metal: 18,
                            water: 22
                        }
                    };
                    
                    this.playerHand = [
                        { id: 1, name: '乾卦', type: '天卦', cost: 3, power: 8 },
                        { id: 2, name: '坤卦', type: '地卦', cost: 2, power: 6 },
                        { id: 3, name: '震卦', type: '雷卦', cost: 4, power: 7 }
                    ];
                    
                    console.log('游戏状态已加载:', this.gameState);
                    console.log('玩家信息已加载:', this.currentPlayer);
                    console.log('手牌已加载:', this.playerHand);
                    
                    // 数据加载完成，隐藏加载界面
                    this.isLoading = false;
                    console.log('加载完成，显示游戏界面');
                },
                
                selectCard(card, index) {
                    this.selectedCard = card;
                    this.showFeedback(`已选择卡牌: ${card.name}`, 'info', 2000);
                    this.showHint(`请选择一个位置来放置 ${card.name}`);
                },
                
                selectPosition(index) {
                    this.selectedPosition = index;
                },
                
                playSelectedCard() {
                    // 验证操作条件
                    if (!this.selectedCard) {
                        this.showFeedback('请先选择一张卡牌', 'warning');
                        this.showHint('点击手牌中的卡牌来选择');
                        return;
                    }
                    
                    if (this.selectedPosition === null && !this.selectedBagua) {
                        this.showFeedback('请选择一个位置', 'warning');
                        this.showHint('点击八卦阵中的位置来放置卡牌');
                        return;
                    }
                    
                    if (!this.isMyTurn && !this.autoPlay) {
                        this.showFeedback('现在不是您的回合', 'error');
                        return;
                    }
                    
                    // 发送出牌请求
                    console.log('出牌:', this.selectedCard, '位置:', this.selectedPosition || this.selectedBagua);
                    
                    // 模拟出牌效果
                    const position = this.selectedPosition || this.selectedBagua;
                    if (this.selectedPosition !== null) {
                        this.gameBoard[this.selectedPosition].card = this.selectedCard;
                    }
                    
                    // 记录操作
                    this.addPlayerActionRecord({
                        playerName: this.currentPlayer?.name || '玩家',
                        action: '出牌',
                        cardName: this.selectedCard.name,
                        position: position,
                        result: '成功',
                        timestamp: new Date()
                    });
                    
                    // 更新手牌
                    this.playerHand = this.playerHand.filter(card => card.id !== this.selectedCard.id);
                    this.playedCards++;
                    
                    // 显示成功反馈
                    this.showFeedback(`成功打出 ${this.selectedCard.name}`, 'success');
                    
                    // 清除选择
                    this.selectedCard = null;
                    this.selectedPosition = null;
                    this.selectedBagua = null;
                    
                    // 添加游戏日志
                    this.addGameLog(`${this.currentPlayer?.name || '玩家'} 打出了 ${this.selectedCard.name}`, false);
                },
                
                endTurn() {
                    if (!this.isMyTurn && !this.autoPlay) {
                        this.showFeedback('现在不是您的回合', 'warning');
                        return;
                    }
                    
                    this.showConfirm(
                        '结束回合',
                        '确定要结束当前回合吗？',
                        () => {
                            console.log('结束回合');
                            this.addGameLog(`${this.currentPlayer?.name || '玩家'} 结束了回合`, false);
                            this.showFeedback('回合已结束', 'success');
                            
                            // 记录操作
                            this.addPlayerActionRecord({
                                playerName: this.currentPlayer?.name || '玩家',
                                action: '结束回合',
                                result: '成功',
                                timestamp: new Date()
                            });
                        }
                    );
                },
                
                surrender() {
                    this.showConfirm(
                        '投降确认',
                        '确定要投降吗？投降后游戏将立即结束。',
                        () => {
                            console.log('投降');
                            this.addGameLog(`${this.currentPlayer?.name || '玩家'} 选择了投降`, true);
                            this.showFeedback('已投降，游戏结束', 'error');
                            
                            // 记录操作
                            this.addPlayerActionRecord({
                                playerName: this.currentPlayer?.name || '玩家',
                                action: '投降',
                                result: '游戏结束',
                                timestamp: new Date()
                            });
                            
                            // 结束游戏
                            this.gameState = 'ended';
                            this.showGameEnd = true;
                            this.gameResult = '投降';
                        }
                    );
                },
                
                sendMessage() {
                    if (!this.newMessage.trim()) return;
                    
                    this.chatMessages.push({
                        id: Date.now(),
                        player: this.currentPlayer?.name || '玩家',
                        text: this.newMessage
                    });
                    
                    this.newMessage = '';
                },
                
                playAgain() {
                    window.location.href = '/';
                },
                
                backToHome() {
                    window.location.href = '/';
                },
                
                leaveGame() {
                    if (confirm('确定要离开游戏吗？')) {
                        window.location.href = '/';
                    }
                },

                // 新增方法 - 融合三个文件的功能
                selectBaguaPosition(bagua) {
                    this.selectedBagua = bagua;
                    this.addGameLog(`选择了八卦位置: ${this.getBaguaName(bagua)}`, false);
                    this.showFeedback(`已选择位置: ${this.getBaguaName(bagua)}`, 'info', 2000);
                    
                    // 四人对战模式下的玩家移动逻辑
                    if (this.fourPlayerDemoData && this.fourPlayerDemoData.players) {
                        const chineseBagua = this.getChineseBaguaName(bagua);
                        this.onBaguaPositionClick(chineseBagua);
                        return;
                    }
                    
                    if (this.selectedCard) {
                        this.showHint(`点击"出牌"按钮来放置 ${this.selectedCard.name}`);
                    } else {
                        this.showHint('请先选择一张卡牌');
                    }
                    
                    console.log('选择八卦位置:', bagua);
                },

                // 将英文八卦名称转换为中文
                getChineseBaguaName(bagua) {
                    const mapping = {
                        'qian': '乾',
                        'dui': '兑', 
                        'li': '离',
                        'zhen': '震',
                        'xun': '巽',
                        'kan': '坎',
                        'gen': '艮',
                        'kun': '坤'
                    };
                    return mapping[bagua] || bagua;
                },

                getBaguaName(bagua) {
                    const names = {
                        'qian': '乾 (天)',
                        'dui': '兑 (泽)',
                        'li': '离 (火)',
                        'zhen': '震 (雷)',
                        'xun': '巽 (风)',
                        'kan': '坎 (水)',
                        'gen': '艮 (山)',
                        'kun': '坤 (地)'
                    };
                    return names[bagua] || bagua;
                },

                getCurrentPlayerName() {
                    if (!this.gameState || !this.gameState.current_player) return '';
                    const currentPlayer = this.otherPlayers.find(p => p.id === this.gameState.current_player) || this.currentPlayer;
                    return currentPlayer?.name || '未知玩家';
                },

                getBaguaName(baguaKey) {
                    const baguaNames = {
                        'qian': '乾卦 (天)',
                        'kun': '坤卦 (地)', 
                        'zhen': '震卦 (雷)',
                        'xun': '巽卦 (风)',
                        'kan': '坎卦 (水)',
                        'li': '离卦 (火)',
                        'gen': '艮卦 (山)',
                        'dui': '兑卦 (泽)'
                    };
                    return baguaNames[baguaKey] || baguaKey;
                },

                addGameLog(message, important = false) {
                    this.gameLogs.push({
                        timestamp: new Date(),
                        message: message,
                        important: important
                    });
                    
                    // 保持日志数量在合理范围内
                    if (this.gameLogs.length > 50) {
                        this.gameLogs = this.gameLogs.slice(-50);
                    }
                },

                formatTime(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return date.toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit' 
                    });
                },

                toggleBoardView() {
                    this.boardView = this.boardView === 'circle' ? 'jiugongge' : 'circle';
                    this.addGameLog(`切换到${this.boardView === 'circle' ? '圆形' : '九宫格'}视图`, false);
                },

                startSimulation() {
                    if (this.isSimulating) return;
                    
                    this.isSimulating = true;
                    this.simulationStep = 0;
                    this.addGameLog('🎮 开始游戏模拟演示...', true);
                    
                    this.runSimulationStep();
                },

                runSimulationStep() {
                    if (!this.isSimulating) return;

                    const simulationSteps = [
                        () => {
                            this.addGameLog('📍 步骤1: 观察当前位置和状态', false);
                            this.addGameLog(`当前位置: ${this.selectedBagua || '未选择'}`, false);
                            this.addGameLog(`阴气: ${this.gameState.yin}, 阳气: ${this.gameState.yang}`, false);
                        },
                        () => {
                            this.addGameLog('🃏 步骤2: 查看可用手牌', false);
                            this.addGameLog(`手牌数量: ${this.gameState.hand.length}`, false);
                            if (this.gameState.hand.length > 0) {
                                this.addGameLog(`示例卡牌: ${this.gameState.hand[0].name}`, false);
                            }
                        },
                        () => {
                            this.addGameLog('🔥 步骤3: 移动到离位（南方火位）', false);
                            this.selectBagua('li');
                            this.addGameLog('移动到离位，增强阳气', false);
                        },
                        () => {
                            this.addGameLog('⚡ 步骤4: 使用卡牌增强能力', false);
                            if (this.gameState.hand.length > 0) {
                                this.playCard(0);
                                this.addGameLog(`使用了卡牌: ${this.gameState.hand[0]?.name || '未知卡牌'}`, false);
                            }
                        },
                        () => {
                            this.addGameLog('⚖️ 步骤5: 观察阴阳平衡变化', false);
                            this.gameState.yang += 2;
                            this.gameState.yin += 1;
                            this.addGameLog(`阴阳平衡更新 - 阴气: ${this.gameState.yin}, 阳气: ${this.gameState.yang}`, false);
                        },
                        () => {
                            this.addGameLog('🔄 步骤6: 结束回合，准备下一轮', false);
                            this.gameState.turn++;
                            this.addGameLog(`进入第 ${this.gameState.turn} 回合`, false);
                        }
                    ];

                    if (this.simulationStep < simulationSteps.length) {
                        simulationSteps[this.simulationStep]();
                        this.simulationStep++;
                        
                        this.simulationTimer = setTimeout(() => {
                            this.runSimulationStep();
                        }, 2000);
                    } else {
                        this.addGameLog('✅ 游戏模拟演示完成！', true);
                        this.isSimulating = false;
                        this.simulationStep = 0;
                    }
                },

                stopSimulation() {
                    this.isSimulating = false;
                    if (this.simulationTimer) {
                        clearTimeout(this.simulationTimer);
                        this.simulationTimer = null;
                    }
                    this.addGameLog('⏹️ 模拟演示已停止', true);
                },

                // 教育功能方法
                getHexagramMeaning(cardName) {
                    const meanings = {
                        '乾为天': '纯阳之卦，象征天道刚健，代表创造力和领导力',
                        '坤为地': '纯阴之卦，象征地道柔顺，代表包容和承载',
                        '水雷屯': '初生之卦，象征万物初生的艰难，需要坚持和积累',
                        '山水蒙': '启蒙之卦，象征教育和学习，代表智慧的开启',
                        '水天需': '等待之卦，象征耐心等待时机，代表智慧的等待'
                    };
                    return meanings[cardName] || '深奥的易经智慧，需要细心体悟';
                },

                getLifeWisdom(cardName) {
                    const wisdom = {
                        '乾为天': '自强不息，勇于承担责任，以正道领导他人',
                        '坤为地': '厚德载物，以包容之心待人，以柔克刚',
                        '水雷屯': '困难是成长的机会，坚持不懈必有收获',
                        '山水蒙': '保持学习之心，虚心求教，智慧自然增长',
                        '水天需': '急躁无益，耐心等待，时机成熟自然成功'
                    };
                    return wisdom[cardName] || '每一卦都蕴含着深刻的人生哲理';
                },

                getStrategyAdvice(cardName) {
                    const advice = {
                        '乾为天': '适合主动出击，发挥领导作用，增强阳气',
                        '坤为地': '适合防守反击，积累资源，增强阴气',
                        '水雷屯': '适合稳扎稳打，不宜冒进，注重基础建设',
                        '山水蒙': '适合学习观察，积累经验，提升技能',
                        '水天需': '适合等待时机，保存实力，准备后发制人'
                    };
                    return advice[cardName] || '根据卦象特点制定相应策略';
                },

                getBaguaName(bagua) {
                    const names = {
                        'qian': '乾（天）',
                        'kun': '坤（地）',
                        'zhen': '震（雷）',
                        'xun': '巽（风）',
                        'kan': '坎（水）',
                        'li': '离（火）',
                        'gen': '艮（山）',
                        'dui': '兑（泽）'
                    };
                    return names[bagua] || bagua;
                },

                getBaguaDirection(bagua) {
                    const directions = {
                        'qian': '西北方，天门之位',
                        'kun': '西南方，地户之位',
                        'zhen': '东方，日出之位',
                        'xun': '东南方，风起之位',
                        'kan': '北方，水源之位',
                        'li': '南方，火明之位',
                        'gen': '东北方，山止之位',
                        'dui': '西方，泽润之位'
                    };
                    return directions[bagua] || '神秘方位';
                },

                getBaguaElement(bagua) {
                    const elements = {
                        'qian': '金 - 刚健坚固',
                        'kun': '土 - 包容承载',
                        'zhen': '木 - 生发向上',
                        'xun': '木 - 柔顺渗透',
                        'kan': '水 - 流动智慧',
                        'li': '火 - 光明热情',
                        'gen': '土 - 稳定厚重',
                        'dui': '金 - 喜悦交流'
                    };
                    return elements[bagua] || '五行奥秘';
                },

                getBaguaSymbol(bagua) {
                    const symbols = {
                        'qian': '天道运行，刚健不息，象征父亲和权威',
                        'kun': '大地承载，柔顺包容，象征母亲和滋养',
                        'zhen': '雷声震动，惊醒万物，象征长子和行动',
                        'xun': '风行天下，无孔不入，象征长女和渗透',
                        'kan': '水流不息，险中求进，象征中男和智慧',
                        'li': '火光明亮，照耀四方，象征中女和文明',
                        'gen': '高山巍峨，止于至善，象征少男和稳重',
                        'dui': '泽水喜悦，润泽万物，象征少女和快乐'
                    };
                    return symbols[bagua] || '深奥象征';
                },

                getBalanceStatus() {
                    if (!this.gameState) return { text: '未知', class: 'text-gray-400' };
                    
                    const diff = Math.abs(this.gameState.yin - this.gameState.yang);
                    if (diff <= 1) {
                        return { text: '完美平衡', class: 'text-green-400' };
                    } else if (diff <= 3) {
                        return { text: '基本平衡', class: 'text-yellow-400' };
                    } else {
                        return { text: '失衡状态', class: 'text-red-400' };
                    }
                },

                getBalanceAdvice() {
                    if (!this.gameState) return '观察阴阳变化，寻找平衡之道';
                    
                    if (this.gameState.yang > this.gameState.yin + 2) {
                        return '阳气过盛，建议使用阴性卡牌或移动到阳位调和';
                    } else if (this.gameState.yin > this.gameState.yang + 2) {
                        return '阴气过盛，建议使用阳性卡牌或移动到阳位调和';
                    } else {
                        return '阴阳相对平衡，可以根据战略需要适当调整';
                    }
                },

                // 四人演示游戏控制方法
                startFourPlayerDemo() {
                    if (this.isRunning) {
                        this.pauseGame();
                        return;
                    }
                    
                    this.isRunning = true;
                    this.gameState.status = '四人演示中';
                    this.addGameLog('🎮 四人演示开始！所有AI玩家已就位', false);
                    
                    // 初始化所有玩家
                    for (let i = 1; i <= 4; i++) {
                        this.addGameLog(`${this.players[i].personality.symbol} ${this.players[i].name}已准备就绪`, false);
                    }
                    
                    if (this.autoPlay) {
                        this.runAutoDemo();
                    }
                },

                pauseGame() {
                    this.isRunning = false;
                    this.gameState.status = '已暂停';
                    this.addGameLog('⏸️ 游戏已暂停', false);
                    if (this.simulationTimer) {
                        clearTimeout(this.simulationTimer);
                        this.simulationTimer = null;
                    }
                },

                runAutoDemo() {
                    if (!this.isRunning) return;
                    
                    // 使用TianJiBianGame实例的runAutoDemo方法
                    if (this.tianJiBianGame) {
                        this.tianJiBianGame.runAutoDemo();
                        // 同步游戏状态到Vue实例
                        this.syncGameStateFromTianJiBian();
                    } else {
                        // 备用逻辑
                        const speed = this.demoSpeed === 'fast' ? 1000 : this.demoSpeed === 'slow' ? 3000 : 2000;
                        
                        this.simulationTimer = setTimeout(() => {
                            this.nextTurn();
                            if (this.isRunning && this.autoPlay) {
                                this.runAutoDemo();
                            }
                        }, speed);
                    }
                },

                nextTurn() {
                    if (!this.isRunning) return;
                    
                    // 执行当前玩家的行动
                    this.executePlayerAction(this.gameState.current_player);
                    
                    // 切换到下一个玩家
                    const currentPlayerNum = parseInt(this.gameState.current_player.replace('player_', ''));
                    const nextPlayerNum = currentPlayerNum % 4 + 1;
                    this.gameState.current_player = `player_${nextPlayerNum}`;
                    
                    // 如果回到玩家1，增加回合数
                    if (nextPlayerNum === 1) {
                        this.currentRound++;
                        this.gameState.turn = this.currentRound;
                        
                        // 每3回合变化季节
                        if (this.currentRound % 3 === 0) {
                            this.currentSeason = (this.currentSeason + 1) % 4;
                            this.gameState.season = this.seasons[this.currentSeason];
                            this.addGameLog(`🌸 季节变化：${this.seasons[this.currentSeason]}季`, false);
                        }
                    }
                },

                executePlayerAction(playerId) {
                    const playerNum = parseInt(playerId.replace('player_', ''));
                    
                    // 优先使用TianJiBianGame实例
                    if (this.tianJiBianGame) {
                        this.tianJiBianGame.executePlayerAction(playerNum);
                        this.syncGameStateFromTianJiBian();
                        return;
                    }
                    
                    // 备用逻辑
                    const player = this.players[playerNum];
                    if (player.type === 'ai') {
                        this.executeAIAction(playerNum, player);
                    } else {
                        this.addGameLog(`${player.personality.symbol} ${player.name}正在思考...`, false);
                    }
                },

                executeAIAction(playerNum, player) {
                    // 备用AI行动逻辑（当TianJiBianGame不可用时）
                    const actions = ['移动', '使用技能', '调整状态', '观察形势'];
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    
                    // 随机选择八卦位置
                    const positions = Object.keys(this.baguaPositions);
                    const newPosition = positions[Math.floor(Math.random() * positions.length)];
                    
                    // 更新玩家位置
                    player.position = newPosition;
                    
                    // 根据位置获得加成
                    const positionInfo = this.baguaPositions[newPosition];
                    if (positionInfo) {
                        player.health = Math.min(100, player.health + positionInfo.bonus.health);
                        player.energy = Math.min(100, player.energy + positionInfo.bonus.energy);
                    }
                    
                    // 记录行动日志
                    this.addGameLog(
                        `${player.personality.symbol} ${player.name}${action}，移动到${positionInfo.name}位 - ${positionInfo.meaning}`, 
                        false
                    );
                    
                    // 随机调整阴阳气
                    if (Math.random() > 0.5) {
                        this.gameState.yin += Math.floor(Math.random() * 3) - 1;
                        this.gameState.yang += Math.floor(Math.random() * 3) - 1;
                        this.gameState.qi += Math.floor(Math.random() * 5) - 2;
                        
                        // 确保数值在合理范围内
                        this.gameState.yin = Math.max(0, Math.min(20, this.gameState.yin));
                        this.gameState.yang = Math.max(0, Math.min(20, this.gameState.yang));
                        this.gameState.qi = Math.max(0, Math.min(50, this.gameState.qi));
                    }
                },

                getCurrentPlayerName() {
                    if (!this.gameState || !this.gameState.current_player) return '未知';
                    const playerNum = parseInt(this.gameState.current_player.replace('player_', ''));
                    return this.players[playerNum]?.name || '未知玩家';
                },

                addGameLog(message, isUserAction = true) {
                    const timestamp = new Date().toLocaleTimeString();
                    this.gameLogs.unshift({
                        id: Date.now(),
                        message: message,
                        timestamp: timestamp,
                        isUserAction: isUserAction
                    });
                    
                    // 限制日志数量
                    if (this.gameLogs.length > 50) {
                        this.gameLogs = this.gameLogs.slice(0, 50);
                    }
                },

                setDemoSpeed(speed) {
                    this.demoSpeed = speed;
                    this.addGameLog(`⚡ 演示速度调整为：${speed === 'fast' ? '快速' : speed === 'slow' ? '慢速' : '正常'}`, false);
                },

                toggleAutoPlay() {
                    this.autoPlay = !this.autoPlay;
                    if (this.tianJiBianGame) {
                        this.tianJiBianGame.autoPlay = this.autoPlay;
                    }
                    if (this.autoPlay && this.isRunning) {
                        this.runAutoDemo();
                    }
                    this.addGameLog(`🔄 自动演示：${this.autoPlay ? '开启' : '关闭'}`, false);
                },

                // 四人自动模拟功能
                startFourPlayerDemo() {
                    this.autoPlay = true;
                    this.isRunning = true;
                    this.currentRound = 1;
                    this.playedCards = 0;
                    this.playerActionRecords = [];
                    
                    // 初始化四个玩家
                    this.initializeFourPlayers();
                    
                    // 开始自动演示
                    this.addGameLog('🎮 四人自动对战开始！', true);
                    this.runAutoDemo();
                },

                stopAutoPlay() {
                    this.autoPlay = false;
                    this.isRunning = false;
                    if (this.simulationTimer) {
                        clearTimeout(this.simulationTimer);
                        this.simulationTimer = null;
                    }
                    this.addGameLog('⏹️ 自动对战已停止', true);
                },

                initializeFourPlayers() {
                    // 定义四个AI角色的性格和位置
                    const aiPersonalities = [
                        { name: '火灵', symbol: '🔥', element: '火', position: '离' },
                        { name: '水仙', symbol: '💧', element: '水', position: '坎' },
                        { name: '木精', symbol: '🌿', element: '木', position: '震' },
                        { name: '雷神', symbol: '⚡', element: '雷', position: '乾' }
                    ];

                    // 初始化四人模拟数据
                    this.fourPlayerDemoData.players = [];
                    
                    // 重置所有玩家状态
                    for (let i = 1; i <= 4; i++) {
                        if (this.players[i]) {
                            this.players[i].health = 100;
                            this.players[i].energy = 50;
                            this.players[i].dao_xing = 0;
                            this.players[i].cheng_yi = 0;
                            this.players[i].qi = 3;
                            this.players[i].hand = this.generatePlayerHand();
                        }

                        // 添加到四人模拟数据中
                        const personality = aiPersonalities[i - 1];
                        this.fourPlayerDemoData.players.push({
                            id: i,
                            name: personality.name,
                            personality: personality,
                            position: personality.position,
                            health: 100,
                            energy: 50
                        });
                    }
                    
                    // 重置游戏状态
                    this.currentWuxing = '木';
                    this.currentTiangan = '甲';
                    this.currentDizhi = '子';
                    this.currentJieqi = '立春';
                    this.currentYinyang = '阳';
                    this.currentGameState = '进行中';
                    
                    this.addGameLog('🔄 四个AI角色已初始化并分配到八卦位置', false);
                },

                generatePlayerHand() {
                    // 生成玩家手牌 - 天机变完整卡牌系统（包含完整64卦）
                    const cards = [
                        // === 完整64卦系统 ===
                        // 乾宫八卦
                        { id: 1, name: '乾为天', type: '六十四卦', category: '乾宫', element: '金', cost: 3, power: 5, description: '天行健，君子以自强不息。乾卦纯阳，象征刚健、创造、领导。', effect: '获得3点道行，下回合行动优先，激活领导力', link: 'https://baike.baidu.com/item/乾卦' },
                        { id: 2, name: '天风姤', type: '六十四卦', category: '乾宫', element: '金', cost: 2, power: 3, description: '天下有风，姤。一阴始生，阳气渐消。', effect: '削弱对手1点威力，获得1点气', link: 'https://baike.baidu.com/item/姤卦' },
                        { id: 3, name: '天山遁', type: '六十四卦', category: '乾宫', element: '金', cost: 2, power: 2, description: '天下有山，遁。君子以远小人，不恶而严。', effect: '回避攻击，下回合获得反击机会', link: 'https://baike.baidu.com/item/遁卦' },
                        { id: 4, name: '天地否', type: '六十四卦', category: '乾宫', element: '金', cost: 3, power: 1, description: '天地不交，否。内阴外阳，闭塞不通。', effect: '阻止对手下回合行动，自身获得防护', link: 'https://baike.baidu.com/item/否卦' },
                        { id: 5, name: '风地观', type: '六十四卦', category: '乾宫', element: '木', cost: 2, power: 2, description: '风行地上，观。君子以省方观民设教。', effect: '查看所有玩家状态，获得洞察加成', link: 'https://baike.baidu.com/item/观卦' },
                        { id: 6, name: '山地剥', type: '六十四卦', category: '乾宫', element: '土', cost: 3, power: 4, description: '山附于地，剥。上以厚下安宅。', effect: '剥夺对手1张手牌，获得其效果', link: 'https://baike.baidu.com/item/剥卦' },
                        { id: 7, name: '火地晋', type: '六十四卦', category: '乾宫', element: '火', cost: 2, power: 4, description: '明出地上，晋。君子以自昭明德。', effect: '提升自身威力+2，照亮隐藏信息', link: 'https://baike.baidu.com/item/晋卦' },
                        { id: 8, name: '火天大有', type: '六十四卦', category: '乾宫', element: '火', cost: 4, power: 6, description: '火在天上，大有。君子以遏恶扬善，顺天休命。', effect: '获得大量资源，威力+3，道行+2', link: 'https://baike.baidu.com/item/大有卦' },
                        
                        // 坤宫八卦
                        { id: 9, name: '坤为地', type: '六十四卦', category: '坤宫', element: '土', cost: 3, power: 3, description: '地势坤，君子以厚德载物。坤卦纯阴，象征柔顺、包容、承载。', effect: '恢复3点生命值，获得厚德载物效果', link: 'https://baike.baidu.com/item/坤卦' },
                        { id: 10, name: '地雷复', type: '六十四卦', category: '坤宫', element: '土', cost: 2, power: 3, description: '雷在地中，复。先王以至日闭关，商旅不行。', effect: '重置冷却时间，获得新生机会', link: 'https://baike.baidu.com/item/复卦' },
                        { id: 11, name: '地泽临', type: '六十四卦', category: '坤宫', element: '土', cost: 2, power: 4, description: '泽上有地，临。君子以教思无穷，容保民无疆。', effect: '临近胜利，威力+2，影响相邻玩家', link: 'https://baike.baidu.com/item/临卦' },
                        { id: 12, name: '地天泰', type: '六十四卦', category: '坤宫', element: '土', cost: 3, power: 5, description: '天地交，泰。后以财成天地之道，辅相天地之宜。', effect: '天地交泰，所有属性+1，获得和谐加成', link: 'https://baike.baidu.com/item/泰卦' },
                        { id: 13, name: '雷天大壮', type: '六十四卦', category: '坤宫', element: '木', cost: 3, power: 6, description: '雷在天上，大壮。君子以非礼弗履。', effect: '威力大增+3，震慑所有对手', link: 'https://baike.baidu.com/item/大壮卦' },
                        { id: 14, name: '泽天夬', type: '六十四卦', category: '坤宫', element: '金', cost: 4, power: 5, description: '泽上于天，夬。君子以施禄及下，居德则忌。', effect: '决断执行，立即解决一个问题', link: 'https://baike.baidu.com/item/夬卦' },
                        { id: 15, name: '水天需', type: '六十四卦', category: '坤宫', element: '水', cost: 2, power: 2, description: '云上于天，需。君子以饮食宴乐。', effect: '等待时机，下回合获得双倍效果', link: 'https://baike.baidu.com/item/需卦' },
                        { id: 16, name: '水地比', type: '六十四卦', category: '坤宫', element: '水', cost: 2, power: 3, description: '地上有水，比。先王以建万国，亲诸侯。', effect: '与其他玩家结盟，共享部分效果', link: 'https://baike.baidu.com/item/比卦' },
                        
                        // 震宫八卦
                        { id: 17, name: '震为雷', type: '六十四卦', category: '震宫', element: '木', cost: 2, power: 4, description: '洊雷，震。君子以恐惧修省。震卦象征震动、觉醒、行动。', effect: '震动全场，对所有敌人造成1点伤害', link: 'https://baike.baidu.com/item/震卦' },
                        { id: 18, name: '雷地豫', type: '六十四卦', category: '震宫', element: '木', cost: 2, power: 3, description: '雷出地奋，豫。先王以作乐崇德，殷荐之上帝。', effect: '获得愉悦状态，下回合威力+2', link: 'https://baike.baidu.com/item/豫卦' },
                        { id: 19, name: '雷水解', type: '六十四卦', category: '震宫', element: '木', cost: 3, power: 3, description: '雷雨作，解。君子以赦过宥罪。', effect: '解除所有负面状态，获得新开始', link: 'https://baike.baidu.com/item/解卦' },
                        { id: 20, name: '雷风恒', type: '六十四卦', category: '震宫', element: '木', cost: 3, power: 4, description: '雷风，恒。君子以立不易方。', effect: '获得恒久效果，持续3回合威力+1', link: 'https://baike.baidu.com/item/恒卦' },
                        { id: 21, name: '地风升', type: '六十四卦', category: '震宫', element: '土', cost: 2, power: 3, description: '地中生木，升。君子以顺德，积小以高大。', effect: '逐步提升，每回合威力+1', link: 'https://baike.baidu.com/item/升卦' },
                        { id: 22, name: '水风井', type: '六十四卦', category: '震宫', element: '水', cost: 2, power: 2, description: '木上有水，井。君子以劳民劝相。', effect: '提供持续资源，每回合恢复1点生命', link: 'https://baike.baidu.com/item/井卦' },
                        { id: 23, name: '泽风大过', type: '六十四卦', category: '震宫', element: '金', cost: 4, power: 7, description: '泽灭木，大过。君子以独立不惧，遁世无闷。', effect: '超越极限，威力大幅提升+4', link: 'https://baike.baidu.com/item/大过卦' },
                        { id: 24, name: '泽雷随', type: '六十四卦', category: '震宫', element: '金', cost: 2, power: 3, description: '泽中有雷，随。君子以向晦入宴息。', effect: '跟随强者，复制目标玩家的上一个效果', link: 'https://baike.baidu.com/item/随卦' },
                        
                        // 巽宫八卦
                        { id: 25, name: '巽为风', type: '六十四卦', category: '巽宫', element: '木', cost: 1, power: 2, description: '随风，巽。君子以申命行事。巽卦象征风、顺从、渗透。', effect: '灵活移动，获得1点气，无视阻挡', link: 'https://baike.baidu.com/item/巽卦' },
                        { id: 26, name: '风天小畜', type: '六十四卦', category: '巽宫', element: '木', cost: 2, power: 2, description: '风行天上，小畜。君子以懿文德。', effect: '小有积蓄，获得1点道行和1点诚意', link: 'https://baike.baidu.com/item/小畜卦' },
                        { id: 27, name: '风火家人', type: '六十四卦', category: '巽宫', element: '木', cost: 2, power: 3, description: '风自火出，家人。君子以言有物，而行有恒。', effect: '家和万事兴，与盟友共享效果', link: 'https://baike.baidu.com/item/家人卦' },
                        { id: 28, name: '风雷益', type: '六十四卦', category: '巽宫', element: '木', cost: 3, power: 4, description: '风雷，益。君子以见善则迁，有过则改。', effect: '获得增益，威力+2，道行+1', link: 'https://baike.baidu.com/item/益卦' },
                        { id: 29, name: '天雷无妄', type: '六十四卦', category: '巽宫', element: '金', cost: 3, power: 3, description: '天下雷行，无妄。先王以茂对时，育万物。', effect: '无妄之灾，随机效果（可能有利或不利）', link: 'https://baike.baidu.com/item/无妄卦' },
                        { id: 30, name: '火雷噬嗑', type: '六十四卦', category: '巽宫', element: '火', cost: 3, power: 5, description: '雷电噬嗑，噬嗑。先王以明罚敕法。', effect: '咬合决断，对目标造成4点伤害', link: 'https://baike.baidu.com/item/噬嗑卦' },
                        { id: 31, name: '山雷颐', type: '六十四卦', category: '巽宫', element: '土', cost: 2, power: 2, description: '山下有雷，颐。君子以慎言语，节饮食。', effect: '颐养生息，恢复2点生命值，获得养生效果', link: 'https://baike.baidu.com/item/颐卦' },
                        { id: 32, name: '山风蛊', type: '六十四卦', category: '巽宫', element: '土', cost: 3, power: 3, description: '山下有风，蛊。君子以振民育德。', effect: '整顿革新，清除负面状态，获得新机', link: 'https://baike.baidu.com/item/蛊卦' },
                        
                        // 坎宫八卦
                        { id: 33, name: '坎为水', type: '六十四卦', category: '坎宫', element: '水', cost: 2, power: 3, description: '习坎，有孚。维心亨，行有尚。坎卦象征水、险阻、智慧。', effect: '智慧如水，查看对手手牌，抽取1张卡', link: 'https://baike.baidu.com/item/坎卦' },
                        { id: 34, name: '水泽节', type: '六十四卦', category: '坎宫', element: '水', cost: 2, power: 2, description: '泽上有水，节。君子以制数度，议德行。', effect: '节制有度，减少消耗，获得节约效果', link: 'https://baike.baidu.com/item/节卦' },
                        { id: 35, name: '水雷屯', type: '六十四卦', category: '坎宫', element: '水', cost: 3, power: 4, description: '云雷屯，君子以经纶。屯卦象征初生艰难。', effect: '屯积力量，抽取2张卡，获得1点诚意', link: 'https://baike.baidu.com/item/屯卦' },
                        { id: 36, name: '水火既济', type: '六十四卦', category: '坎宫', element: '水', cost: 4, power: 5, description: '水在火上，既济。君子以思患而豫防之。', effect: '水火既济，完美平衡，所有效果+1', link: 'https://baike.baidu.com/item/既济卦' },
                        { id: 37, name: '泽火革', type: '六十四卦', category: '坎宫', element: '金', cost: 3, power: 4, description: '泽中有火，革。君子以治历明时。', effect: '革故鼎新，改变游戏规则1回合', link: 'https://baike.baidu.com/item/革卦' },
                        { id: 38, name: '雷火丰', type: '六十四卦', category: '坎宫', element: '木', cost: 3, power: 5, description: '雷电皆至，丰。君子以折狱致刑。', effect: '丰收时节，获得丰厚奖励，威力+3', link: 'https://baike.baidu.com/item/丰卦' },
                        { id: 39, name: '地火明夷', type: '六十四卦', category: '坎宫', element: '土', cost: 2, power: 2, description: '明入地中，明夷。君子以莅众，用晦而明。', effect: '明夷待时，隐藏实力，下回合威力翻倍', link: 'https://baike.baidu.com/item/明夷卦' },
                        { id: 40, name: '地水师', type: '六十四卦', category: '坎宫', element: '土', cost: 3, power: 4, description: '地中有水，师。君子以容民畜众。', effect: '统帅军队，召集援军，获得额外行动', link: 'https://baike.baidu.com/item/师卦' },
                        
                        // 离宫八卦
                        { id: 41, name: '离为火', type: '六十四卦', category: '离宫', element: '火', cost: 2, power: 3, description: '明两作，离。大人以继明照于四方。离卦象征火、光明、文明。', effect: '光明照耀，揭示隐藏信息，造成2点伤害', link: 'https://baike.baidu.com/item/离卦' },
                        { id: 42, name: '火山旅', type: '六十四卦', category: '离宫', element: '火', cost: 2, power: 3, description: '山上有火，旅。君子以明慎用刑，而不留狱。', effect: '旅途奔波，移动灵活，获得探索奖励', link: 'https://baike.baidu.com/item/旅卦' },
                        { id: 43, name: '火风鼎', type: '六十四卦', category: '离宫', element: '火', cost: 3, power: 4, description: '木上有火，鼎。君子以正位凝命。', effect: '鼎新革故，提升品质，威力+2，道行+1', link: 'https://baike.baidu.com/item/鼎卦' },
                        { id: 44, name: '火水未济', type: '六十四卦', category: '离宫', element: '火', cost: 3, power: 3, description: '火在水上，未济。君子以慎辨物居方。', effect: '未济待成，蓄势待发，下回合效果翻倍', link: 'https://baike.baidu.com/item/未济卦' },
                        { id: 45, name: '山水蒙', type: '六十四卦', category: '离宫', element: '土', cost: 2, power: 2, description: '山下出泉，蒙。君子以果行育德。', effect: '启蒙教育，学习技能，下次出牌效果翻倍', link: 'https://baike.baidu.com/item/蒙卦' },
                        { id: 46, name: '风水涣', type: '六十四卦', category: '离宫', element: '木', cost: 2, power: 3, description: '风行水上，涣。先王以享于帝立庙。', effect: '涣散聚合，重新分配资源', link: 'https://baike.baidu.com/item/涣卦' },
                        { id: 47, name: '天水讼', type: '六十四卦', category: '离宫', element: '金', cost: 4, power: 5, description: '天与水违行，讼。君子以作事谋始。', effect: '争讼冲突，强制对手弃牌，造成3点伤害', link: 'https://baike.baidu.com/item/讼卦' },
                        { id: 48, name: '天火同人', type: '六十四卦', category: '离宫', element: '金', cost: 3, power: 4, description: '天与火，同人。君子以类族辨物。', effect: '同人协力，与所有盟友共享效果', link: 'https://baike.baidu.com/item/同人卦' },
                        
                        // 艮宫八卦
                        { id: 49, name: '艮为山', type: '六十四卦', category: '艮宫', element: '土', cost: 3, power: 1, description: '兼山，艮。君子以思不出其位。艮卦象征山、静止、稳定。', effect: '稳如泰山，获得护盾，免疫下次攻击', link: 'https://baike.baidu.com/item/艮卦' },
                        { id: 50, name: '山火贲', type: '六十四卦', category: '艮宫', element: '土', cost: 2, power: 3, description: '山下有火，贲。君子以明庶政，无敢折狱。', effect: '文饰美化，提升形象，获得魅力加成', link: 'https://baike.baidu.com/item/贲卦' },
                        { id: 51, name: '山天大畜', type: '六十四卦', category: '艮宫', element: '土', cost: 3, power: 4, description: '天在山中，大畜。君子以多识前言往行，以畜其德。', effect: '大有积蓄，获得2点道行，2点诚意', link: 'https://baike.baidu.com/item/大畜卦' },
                        { id: 52, name: '山泽损', type: '六十四卦', category: '艮宫', element: '土', cost: 2, power: 2, description: '山下有泽，损。君子以惩忿窒欲。', effect: '损己利人，牺牲1点生命值，盟友获得2点', link: 'https://baike.baidu.com/item/损卦' },
                        { id: 53, name: '火泽睽', type: '六十四卦', category: '艮宫', element: '火', cost: 3, power: 3, description: '上火下泽，睽。君子以同而异。', effect: '睽违分离，分化对手联盟', link: 'https://baike.baidu.com/item/睽卦' },
                        { id: 54, name: '天泽履', type: '六十四卦', category: '艮宫', element: '金', cost: 2, power: 3, description: '上天下泽，履。君子以辨上下，定民志。', effect: '履行正道，获得正义加成，威力+1', link: 'https://baike.baidu.com/item/履卦' },
                        { id: 55, name: '风泽中孚', type: '六十四卦', category: '艮宫', element: '木', cost: 2, power: 3, description: '泽上有风，中孚。君子以议狱缓死。', effect: '中心诚信，获得信任，与所有玩家和解', link: 'https://baike.baidu.com/item/中孚卦' },
                        { id: 56, name: '风山渐', type: '六十四卦', category: '艮宫', element: '木', cost: 2, power: 2, description: '山上有木，渐。君子以居贤德善俗。', effect: '渐进发展，每回合威力+1，持续3回合', link: 'https://baike.baidu.com/item/渐卦' },
                        
                        // 兑宫八卦
                        { id: 57, name: '兑为泽', type: '六十四卦', category: '兑宫', element: '金', cost: 1, power: 2, description: '丽泽，兑。君子以朋友讲习。兑卦象征泽、喜悦、交流。', effect: '喜悦和谐，与其他玩家交换卡牌或资源', link: 'https://baike.baidu.com/item/兑卦' },
                        { id: 58, name: '泽水困', type: '六十四卦', category: '兑宫', element: '金', cost: 3, power: 2, description: '泽无水，困。君子以致命遂志。', effect: '困境求生，在危机中获得突破机会', link: 'https://baike.baidu.com/item/困卦' },
                        { id: 59, name: '泽地萃', type: '六十四卦', category: '兑宫', element: '金', cost: 2, power: 4, description: '泽上于地，萃。君子以除戎器，戒不虞。', effect: '聚集力量，召集所有盟友共同行动', link: 'https://baike.baidu.com/item/萃卦' },
                        { id: 60, name: '泽山咸', type: '六十四卦', category: '兑宫', element: '金', cost: 2, power: 3, description: '山上有泽，咸。君子以虚受人。', effect: '感应相通，与目标玩家心意相通', link: 'https://baike.baidu.com/item/咸卦' },
                        { id: 61, name: '水山蹇', type: '六十四卦', category: '兑宫', element: '水', cost: 3, power: 2, description: '山上有水，蹇。君子以反身修德。', effect: '蹇难困顿，反思修德，下回合获得智慧加成', link: 'https://baike.baidu.com/item/蹇卦' },
                        { id: 62, name: '地山谦', type: '六十四卦', category: '兑宫', element: '土', cost: 1, power: 2, description: '地中有山，谦。君子以裒多益寡，称物平施。', effect: '谦逊美德，获得所有人好感，免疫攻击1回合', link: 'https://baike.baidu.com/item/谦卦' },
                        { id: 63, name: '雷山小过', type: '六十四卦', category: '兑宫', element: '木', cost: 2, power: 3, description: '山上有雷，小过。君子以行过乎恭，丧过乎哀，用过乎俭。', effect: '小有过错，谨慎行事，获得谨慎加成', link: 'https://baike.baidu.com/item/小过卦' },
                        { id: 64, name: '雷泽归妹', type: '六十四卦', category: '兑宫', element: '木', cost: 3, power: 4, description: '泽上有雷，归妹。君子以永终知敝。', effect: '归妹成家，获得伴侣支持，威力+2', link: 'https://baike.baidu.com/item/归妹卦' },
                        
                        // === 天时地利人和卡牌（保留精华部分）===
                        // 天时卡牌（精选）
                        { id: 101, name: '立春', type: '天时卡', category: '节气', element: '木', cost: 1, power: 2, description: '万物复苏，生机勃发。春季第一个节气，象征新的开始。', effect: '所有玩家获得1点气，木属性卡牌效果+1', link: 'https://baike.baidu.com/item/立春' },
                        { id: 102, name: '夏至', type: '天时卡', category: '节气', element: '火', cost: 3, power: 4, description: '阳气最盛，白昼最长。夏季顶峰，火元素达到极致。', effect: '火属性卡牌威力翻倍，获得3点道行', link: 'https://baike.baidu.com/item/夏至' },
                        { id: 103, name: '秋分', type: '天时卡', category: '节气', element: '金', cost: 2, power: 3, description: '秋高气爽，收获时节。金秋时节，收获智慧。', effect: '抽取3张卡，金属性效果增强', link: 'https://baike.baidu.com/item/秋分' },
                        { id: 104, name: '冬至', type: '天时卡', category: '节气', element: '水', cost: 3, power: 2, description: '阴气最盛，一阳来复。冬季深处，蕴含新生。', effect: '获得护盾，下回合行动力翻倍', link: 'https://baike.baidu.com/item/冬至' },
                        { id: 105, name: '甲子', type: '天时卡', category: '干支', element: '木', cost: 2, power: 4, description: '六十甲子之首，象征新的轮回开始。', effect: '重置所有冷却，获得额外回合', link: 'https://baike.baidu.com/item/甲子' },
                        
                        // 地利卡牌（精选）
                        { id: 201, name: '中央土', type: '地利卡', category: '方位', element: '土', cost: 3, power: 5, description: '中央戊己土，四方之主。土气最为厚重。', effect: '所有属性平衡增强，获得稳定核心', link: 'https://baike.baidu.com/item/中央' },
                        { id: 202, name: '高山', type: '地利卡', category: '地形', element: '土', cost: 3, power: 4, description: '巍峨高山，不可撼动。提供强大的防御力。', effect: '获得山岳护盾，免疫物理攻击', link: 'https://baike.baidu.com/item/高山' },
                        { id: 203, name: '江河', type: '地利卡', category: '地形', element: '水', cost: 2, power: 3, description: '奔流不息的江河，带来生命活力。', effect: '持续恢复生命值，水属性增强', link: 'https://baike.baidu.com/item/江河' },
                        
                        // 人和卡牌（精选）
                        { id: 301, name: '兵法三十六计', type: '人和卡', category: '策略', element: '无', cost: 4, power: 6, description: '古代兵法智慧结晶，包含三十六种战略战术。', effect: '选择一种计策执行，效果随机但强大', link: 'https://baike.baidu.com/item/三十六计' },
                        { id: 302, name: '知己知彼', type: '人和卡', category: '策略', element: '无', cost: 2, power: 2, description: '孙子兵法核心思想，了解敌我双方情况。', effect: '查看所有对手手牌和状态', link: 'https://baike.baidu.com/item/知己知彼' },
                        { id: 303, name: '琴棋书画', type: '人和卡', category: '技能', element: '无', cost: 2, power: 3, description: '文人四艺，修身养性之道。', effect: '获得文化加成，诚意+2，道行+1', link: 'https://baike.baidu.com/item/琴棋书画' }
                    ];
                    
                    // 随机选择7张卡作为手牌（包含完整64卦系统）
                    const shuffled = cards.sort(() => 0.5 - Math.random());
                    return shuffled.slice(0, 7);
                },

                runAutoDemo() {
                    if (!this.autoPlay || !this.isRunning) return;
                    
                    const currentPlayerNum = ((this.currentRound - 1) % 4) + 1;
                    const currentPlayer = this.players[currentPlayerNum];
                    
                    if (!currentPlayer) return;
                    
                    // 执行玩家行动
                    this.executePlayerAction(currentPlayerNum, currentPlayer);
                    
                    // 更新游戏状态
                    this.updateGameState();
                    
                    // 检查游戏是否结束
                    if (this.checkGameEnd()) {
                        this.endGame();
                        return;
                    }
                    
                    // 继续下一回合
                    this.currentRound++;
                    
                    // 设置下一次执行的延迟
                    const delay = this.demoSpeed === 'fast' ? 1000 : this.demoSpeed === 'slow' ? 3000 : 2000;
                    this.simulationTimer = setTimeout(() => {
                        this.runAutoDemo();
                    }, delay);
                },

                executePlayerAction(playerNum, player) {
                    // 随机选择一个行动
                    const actions = ['出牌', '移动', '修炼', '观察'];
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    
                    let actionResult = '';
                    let cardName = '';
                    let position = '';
                    
                    switch (action) {
                        case '出牌':
                            if (player.hand && player.hand.length > 0) {
                                const card = player.hand[Math.floor(Math.random() * player.hand.length)];
                                cardName = card.name;
                                position = this.getRandomBaguaPosition();
                                actionResult = `打出${card.name}到${position}`;
                                this.playedCards++;
                                // 从手牌中移除
                                player.hand = player.hand.filter(c => c.id !== card.id);
                            } else {
                                action = '观察';
                                actionResult = '手牌为空，进行观察';
                            }
                            break;
                        case '移动':
                            position = this.getRandomBaguaPosition();
                            player.position = position;
                            actionResult = `移动到${position}`;
                            break;
                        case '修炼':
                            player.dao_xing += Math.floor(Math.random() * 3) + 1;
                            player.cheng_yi += Math.floor(Math.random() * 2) + 1;
                            actionResult = `道行+${Math.floor(Math.random() * 3) + 1}，诚意+${Math.floor(Math.random() * 2) + 1}`;
                            break;
                        case '观察':
                            actionResult = '观察局势，积蓄力量';
                            player.qi = Math.min(10, player.qi + 1);
                            break;
                    }
                    
                    // 记录玩家操作
                    this.recordPlayerAction(player.name, action, cardName, position, actionResult);
                    
                    // 添加游戏日志
                    this.addGameLog(`${player.personality.symbol} ${player.name} ${actionResult}`, false);
                },

                recordPlayerAction(playerName, action, cardName, position, result) {
                    const record = {
                        playerName: playerName,
                        action: action,
                        cardName: cardName,
                        position: position,
                        result: result,
                        timestamp: new Date()
                    };
                    
                    this.playerActionRecords.unshift(record);
                    console.log('记录玩家操作:', record);
                    console.log('当前记录总数:', this.playerActionRecords.length);
                    
                    // 限制记录数量
                    if (this.playerActionRecords.length > 100) {
                        this.playerActionRecords = this.playerActionRecords.slice(0, 100);
                    }
                },

                getRandomBaguaPosition() {
                    const positions = ['乾', '坤', '震', '巽', '坎', '离', '艮', '兑'];
                    return positions[Math.floor(Math.random() * positions.length)];
                },

                updateGameState() {
                    // 更新季节（每4回合一个季节）
                    this.currentSeason = Math.floor((this.currentRound - 1) / 4) % 4;
                    
                    // 更新五行主导
                    const wuxingCycle = ['木', '火', '土', '金', '水'];
                    this.currentWuxing = wuxingCycle[Math.floor((this.currentRound - 1) / 2) % 5];
                    
                    // 更新天干地支
                    const tiangan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                    const dizhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                    this.currentTiangan = tiangan[(this.currentRound - 1) % 10];
                    this.currentDizhi = dizhi[(this.currentRound - 1) % 12];
                    
                    // 更新节气
                    const jieqi = ['立春', '雨水', '惊蛰', '春分', '清明', '谷雨', '立夏', '小满', '芒种', '夏至', '小暑', '大暑', '立秋', '处暑', '白露', '秋分', '寒露', '霜降', '立冬', '小雪', '大雪', '冬至', '小寒', '大寒'];
                    this.currentJieqi = jieqi[Math.floor((this.currentRound - 1) / 2) % 24];
                    
                    // 更新阴阳
                    this.currentYinyang = this.currentRound % 2 === 1 ? '阳' : '阴';
                    
                    // 更新游戏状态
                    this.gameState.turn = this.currentRound;
                    this.gameState.season = this.seasons[this.currentSeason];
                    this.gameState.current_player = `player_${((this.currentRound - 1) % 4) + 1}`;
                },

                checkGameEnd() {
                    // 检查游戏结束条件
                    return this.currentRound > 20 || this.playedCards >= this.totalCards * 0.8;
                },

                endGame() {
                    this.autoPlay = false;
                    this.isRunning = false;
                    this.currentGameState = '已结束';
                    
                    // 计算获胜者
                    let winner = null;
                    let maxScore = -1;
                    
                    for (let i = 1; i <= 4; i++) {
                        const player = this.players[i];
                        const score = player.dao_xing + player.cheng_yi + player.qi;
                        if (score > maxScore) {
                            maxScore = score;
                            winner = player;
                        }
                    }
                    
                    this.addGameLog(`🏆 游戏结束！获胜者：${winner.name}（总分：${maxScore}）`, true);
                },

                formatTime(timestamp) {
                    if (!timestamp) return '';
                    return new Date(timestamp).toLocaleTimeString();
                },

                // 获取详细游戏状态的方法
                getCurrentWuxing() {
                    return this.currentWuxing || '木';
                },

                getCurrentGanzhi() {
                    return `${this.currentTiangan}${this.currentDizhi}` || '甲子';
                },

                getCurrentJieqi() {
                    return this.currentJieqi || '立春';
                },

                getCurrentYinyang() {
                    return this.currentYinyang || '阳';
                },

                getCurrentGameState() {
                return this.currentGameState || '准备中';
            },
            getCurrentSeason() {
                const seasons = ['春', '夏', '秋', '冬'];
                return seasons[this.currentSeason] || '春';
            },

                // 同步TianJiBianGame状态到Vue实例
                syncGameStateFromTianJiBian() {
                    if (!this.tianJiBianGame) return;
                    
                    const game = this.tianJiBianGame;
                    
                    // 同步基本游戏状态
                    this.currentPlayer = game.currentPlayer;
                    this.currentRound = game.currentRound;
                    this.gameState.current_player = `player_${game.currentPlayer}`;
                    this.gameState.turn = game.currentRound;
                    this.gameState.status = game.gameState;
                    this.isRunning = game.isRunning;
                    this.autoPlay = game.autoPlay;
                    this.demoSpeed = game.demoSpeed;
                    
                    // 同步季节和五行状态
                    this.currentSeason = game.currentSeason;
                    this.currentWuxing = game.currentWuxing;
                    this.gameState.season = game.seasons[game.currentSeason];
                    this.gameState.wuxing = game.wuxingElements[game.currentWuxing];
                    
                    // 同步玩家数据（包括新的卡牌游戏属性）
                    for (let i = 1; i <= 4; i++) {
                        if (game.players[i] && this.players[i]) {
                            this.players[i].health = game.players[i].health;
                            this.players[i].energy = game.players[i].energy;
                            this.players[i].status = game.players[i].status;
                            this.players[i].position = game.players[i].position;
                            
                            // 同步新的卡牌游戏属性
                            this.players[i].dao_xing = game.players[i].dao_xing || 0;
                            this.players[i].cheng_yi = game.players[i].cheng_yi || 0;
                            this.players[i].qi = game.players[i].qi || 3;
                            this.players[i].hand = game.players[i].hand || [];
                        }
                    }
                    
                    // 同步胜利条件
                    if (game.victoryCondition) {
                        this.victoryCondition = game.victoryCondition;
                    }
                },

                // 同步Vue状态到TianJiBianGame实例
                syncGameStateToTianJiBian() {
                    if (!this.tianJiBianGame) return;
                    
                    const game = this.tianJiBianGame;
                    
                    // 同步基本状态
                    game.autoPlay = this.autoPlay;
                    game.demoSpeed = this.demoSpeed;
                    game.isRunning = this.isRunning;
                },

                // 启动四人演示（使用TianJiBianGame）
                startFourPlayerDemo() {
                    if (this.tianJiBianGame) {
                        this.tianJiBianGame.startFourPlayerDemo();
                        this.syncGameStateFromTianJiBian();
                        this.addGameLog('🎮 四人演示开始！', false);
                    } else {
                        // 备用逻辑
                        if (this.isRunning) {
                            this.pauseGame();
                            return;
                        }
                        
                        this.isRunning = true;
                        this.gameState.status = '进行中';
                        this.addGameLog('🎮 四人演示开始！', false);
                        
                        if (this.autoPlay) {
                            this.runAutoDemo();
                        }
                    }
                },

                // 更新nextTurn方法
                nextTurn() {
                    if (this.tianJiBianGame) {
                        this.tianJiBianGame.nextTurn();
                        this.syncGameStateFromTianJiBian();
                    } else {
                        // 备用逻辑保持不变
                        if (!this.isRunning) return;
                        
                        this.executePlayerAction(this.gameState.current_player);
                        
                        const currentPlayerNum = parseInt(this.gameState.current_player.replace('player_', ''));
                        const nextPlayerNum = currentPlayerNum % 4 + 1;
                        this.gameState.current_player = `player_${nextPlayerNum}`;
                        
                        if (nextPlayerNum === 1) {
                            this.currentRound++;
                            this.gameState.turn = this.currentRound;
                            
                            if (this.currentRound % 3 === 0) {
                                this.currentSeason = (this.currentSeason + 1) % 4;
                                this.gameState.season = this.seasons[this.currentSeason];
                                this.addGameLog(`🌸 季节变化：${this.seasons[this.currentSeason]}季`, false);
                            }
                        }
                    }
                },

                // 更新executePlayerAction方法
                executePlayerAction(playerId) {
                    if (this.tianJiBianGame) {
                        const playerNum = typeof playerId === 'string' ? 
                            parseInt(playerId.replace('player_', '')) : playerId;
                        this.tianJiBianGame.executePlayerAction(playerNum);
                        this.syncGameStateFromTianJiBian();
                    } else {
                        // 备用逻辑保持不变
                        const playerNum = parseInt(playerId.replace('player_', ''));
                        const player = this.players[playerNum];
                        
                        if (player.type === 'ai') {
                            // AI行动逻辑
                            const actions = ['调息', '修炼', '感悟', '突破'];
                            const action = actions[Math.floor(Math.random() * actions.length)];
                            this.addGameLog(`${player.personality.symbol} ${player.name} 执行了 ${action}`, false);
                        }
                    }
                },

                // 新增卡牌游戏方法
                playCard(cardIndex, boardPosition) {
                    if (!this.tianJiBianGame) return;
                    
                    const currentPlayer = this.tianJiBianGame.currentPlayer;
                    const player = this.tianJiBianGame.players[currentPlayer];
                    
                    if (!player.hand[cardIndex]) {
                        this.addGameLog('无效的卡牌选择', true);
                        return;
                    }
                    
                    const card = player.hand[cardIndex];
                    
                    // 检查气是否足够
                    if (player.qi < card.cost) {
                        this.addGameLog(`气不足，需要 ${card.cost} 气`, true);
                        return;
                    }
                    
                    // 检查棋盘位置是否可用
                    if (this.tianJiBianGame.gameBoard[boardPosition].card) {
                        this.addGameLog('该位置已被占用', true);
                        return;
                    }
                    
                    // 执行出牌
                    this.tianJiBianGame.executePlayCard(currentPlayer, cardIndex, boardPosition);
                    this.syncGameStateFromTianJiBian();
                    
                    this.addGameLog(`${player.name} 出牌：${card.name}`, false);
                },

                selectCard(cardIndex) {
                    this.selectedCard = cardIndex;
                    console.log('选择卡牌:', cardIndex);
                },

                selectBoardPosition(position) {
                    if (this.selectedCard !== null) {
                        this.playCard(this.selectedCard, position);
                        this.selectedCard = null;
                        this.selectedPosition = null;
                    } else {
                        this.selectedPosition = position;
                        console.log('选择棋盘位置:', position);
                    }
                },

                meditation() {
                    if (!this.tianJiBianGame) return;
                    
                    const currentPlayer = this.tianJiBianGame.currentPlayer;
                    this.tianJiBianGame.executeMeditation(currentPlayer);
                    this.syncGameStateFromTianJiBian();
                    
                    this.addGameLog(`${this.tianJiBianGame.players[currentPlayer].name} 进行冥想`, false);
                },

                study() {
                    if (!this.tianJiBianGame) return;
                    
                    const currentPlayer = this.tianJiBianGame.currentPlayer;
                    this.tianJiBianGame.executeStudy(currentPlayer);
                    this.syncGameStateFromTianJiBian();
                    
                    this.addGameLog(`${this.tianJiBianGame.players[currentPlayer].name} 进行研习`, false);
                },

                getCardCostColor(cost) {
                    if (cost <= 1) return 'green';
                    if (cost <= 2) return 'orange';
                    return 'red';
                },

                getPlayerHandSize(playerId) {
                    return this.players[playerId]?.hand?.length || 0;
                },

                checkGameEnd() {
                    if (!this.tianJiBianGame) return;
                    
                    const winner = this.tianJiBianGame.checkVictoryConditions();
                    if (winner) {
                        this.showGameEnd = true;
                        this.gameResult = {
                            winner: this.players[winner].name,
                            type: 'victory'
                        };
                        this.addGameLog(`🎉 游戏结束！${this.players[winner].name} 获胜！`, false);
                    }
                },

                // 添加玩家操作记录
                addPlayerActionRecord(record) {
                    if (!this.playerActionRecords) {
                        this.playerActionRecords = [];
                    }
                    
                    // 添加时间戳格式化
                    const formattedRecord = {
                        ...record,
                        time: record.timestamp ? record.timestamp.toLocaleTimeString() : new Date().toLocaleTimeString(),
                        id: Date.now() + Math.random()
                    };
                    
                    this.playerActionRecords.unshift(formattedRecord);
                    
                    // 限制记录数量，保持最新的50条
                    if (this.playerActionRecords.length > 50) {
                        this.playerActionRecords = this.playerActionRecords.slice(0, 50);
                    }
                },

                // 获取指定八卦位置的玩家
                getPlayersAtPosition(position) {
                    if (!this.fourPlayerDemoData || !this.fourPlayerDemoData.players) {
                        return [];
                    }
                    
                    return this.fourPlayerDemoData.players.filter(player => 
                        player.position === position
                    );
                },

                // 获取玩家头像样式
                getPlayerAvatarStyle(player) {
                    const colors = {
                        '🔥': '#ff4444', // 火红色
                        '💧': '#4488ff', // 水蓝色  
                        '🌿': '#44ff44', // 草绿色
                        '⚡': '#ffff44'  // 雷黄色
                    };
                    
                    const bgColor = colors[player.personality?.symbol] || '#888888';
                    
                    return {
                        backgroundColor: bgColor,
                        boxShadow: `0 0 10px ${bgColor}40`
                    };
                },

                // 获取当前玩家名称
                getCurrentPlayerName() {
                    if (!this.fourPlayerDemoData || !this.fourPlayerDemoData.players) {
                        return '未知玩家';
                    }
                    
                    const currentPlayerNum = ((this.currentRound - 1) % 4) + 1;
                    const currentPlayer = this.fourPlayerDemoData.players.find(p => p.id === currentPlayerNum);
                    return currentPlayer ? currentPlayer.name : `玩家${currentPlayerNum}`;
                },

                // 判断是否为当前玩家
                isCurrentPlayer(player) {
                    if (!this.fourPlayerDemoData || !this.fourPlayerDemoData.players) {
                        return false;
                    }
                    
                    const currentPlayerNum = ((this.currentRound - 1) % 4) + 1;
                    return player.id === currentPlayerNum;
                },

                // 移动玩家到新位置
                movePlayerToPosition(playerId, newPosition) {
                    if (!this.fourPlayerDemoData || !this.fourPlayerDemoData.players) {
                        return;
                    }
                    
                    const player = this.fourPlayerDemoData.players.find(p => p.id === playerId);
                    if (!player) {
                        return;
                    }
                    
                    const oldPosition = player.position;
                    player.position = newPosition;
                    
                    // 添加移动日志
                    this.addGameLog(`🚶 ${player.name} 从 ${oldPosition} 移动到 ${newPosition}`, false);
                    
                    // 添加玩家操作记录
                    this.addPlayerActionRecord({
                        playerId: playerId,
                        playerName: player.name,
                        action: 'move',
                        details: `从 ${oldPosition} 移动到 ${newPosition}`,
                        timestamp: new Date()
                    });
                },

                // 处理八卦位置点击
                onBaguaPositionClick(position) {
                    if (!this.fourPlayerDemoData || !this.fourPlayerDemoData.players) {
                        return;
                    }
                    
                    const currentPlayerNum = ((this.currentRound - 1) % 4) + 1;
                    const currentPlayer = this.fourPlayerDemoData.players.find(p => p.id === currentPlayerNum);
                    
                    if (!currentPlayer) {
                        return;
                    }
                    
                    // 检查位置是否已被占用
                    const playersAtPosition = this.getPlayersAtPosition(position);
                    if (playersAtPosition.length > 0 && playersAtPosition[0].id !== currentPlayerNum) {
                        this.showFeedback(`位置 ${position} 已被 ${playersAtPosition[0].name} 占用`, 'warning');
                        return;
                    }
                    
                    // 移动当前玩家到新位置
                    this.movePlayerToPosition(currentPlayerNum, position);
                    
                    // 自动进入下一回合
                    this.nextRound();
                },

                // 下一回合
                nextRound() {
                    this.currentRound++;
                    
                    // 添加回合日志
                    this.addGameLog(`🔄 第 ${this.currentRound} 回合开始`, false);
                    
                    // 显示当前玩家
                    const currentPlayerName = this.getCurrentPlayerName();
                    this.showFeedback(`轮到 ${currentPlayerName} 行动`, 'info');
                },

                // 获取对战进度百分比
                getProgressPercentage() {
                    if (!this.autoPlay) return 0;
                    
                    // 假设最大回合数为20，可以根据需要调整
                    const maxRounds = 20;
                    const progress = Math.min((this.currentRound / maxRounds) * 100, 100);
                    return progress;
                },

                // 反馈系统方法
                showFeedback(message, type = 'info', duration = 3000) {
                    this.feedbackMessage = message;
                    this.feedbackType = type;
                    
                    // 清除之前的定时器
                    if (this.feedbackTimeout) {
                        clearTimeout(this.feedbackTimeout);
                    }
                    
                    // 设置自动清除
                    this.feedbackTimeout = setTimeout(() => {
                        this.clearFeedback();
                    }, duration);
                },

                clearFeedback() {
                    this.feedbackMessage = '';
                    if (this.feedbackTimeout) {
                        clearTimeout(this.feedbackTimeout);
                        this.feedbackTimeout = null;
                    }
                },

                // 确认对话框方法
                showConfirm(title, message, onConfirm, options = {}) {
                    this.confirmDialog = {
                        title: title,
                        message: message,
                        icon: options.icon || '❓',
                        type: options.type || 'normal',
                        onConfirm: onConfirm
                    };
                    this.showConfirmDialog = true;
                },

                executeConfirm() {
                    if (this.confirmDialog.onConfirm) {
                        this.confirmDialog.onConfirm();
                    }
                    this.cancelConfirm();
                },

                cancelConfirm() {
                    this.showConfirmDialog = false;
                    this.confirmDialog = {
                        title: '',
                        message: '',
                        icon: '',
                        type: 'normal',
                        onConfirm: null
                    };
                },

                // 操作提示方法
                showHint(message, duration = 2000) {
                    this.actionHint = message;
                    
                    // 清除之前的定时器
                    if (this.hintTimeout) {
                        clearTimeout(this.hintTimeout);
                    }
                    
                    // 设置自动清除
                    this.hintTimeout = setTimeout(() => {
                        this.actionHint = '';
                    }, duration);
                },

                // 状态颜色方法
                getGameStatusColor() {
                    if (!this.gameState) return 'text-white';
                    
                    switch (this.gameState.status) {
                        case '进行中':
                        case 'playing':
                            return 'text-green-400 font-semibold';
                        case '等待':
                        case 'waiting':
                            return 'text-yellow-400 font-semibold';
                        case '已结束':
                        case 'ended':
                            return 'text-red-400 font-semibold';
                        case '暂停':
                        case 'paused':
                            return 'text-orange-400 font-semibold';
                        default:
                            return 'text-white';
                    }
                },

                getConnectionStatusColor() {
                    switch (this.connectionStatus) {
                        case 'connected':
                            return 'text-green-400 font-semibold';
                        case 'connecting':
                            return 'text-yellow-400 font-semibold';
                        case 'disconnected':
                        default:
                            return 'text-red-400 font-semibold';
                    }
                }
            }
        });
        
        // 挂载Vue应用并保存引用
        window.vueApp = app.mount('#app');
    </script>
</body>
</html>