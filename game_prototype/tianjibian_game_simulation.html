<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æœºå˜ - æ¸¸æˆè¿‡ç¨‹æ¨¡æ‹Ÿæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            font-family: 'Microsoft YaHei', sans-serif;
            color: #fff;
            overflow-x: hidden;
        }

        .simulation-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #ccc;
            margin-bottom: 20px;
        }

        .game-area {
            display: flex;
            gap: 20px;
            height: 800px;
        }

        .game-board {
            flex: 2;
            position: relative;
            background: radial-gradient(circle, #2c3e50, #34495e);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 20px;
        }

        .info-panel {
            flex: 1;
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        /* æ¸¸æˆçŠ¶æ€æ˜¾ç¤º */
        .game-status {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
        }

        /* ç©å®¶åŒºåŸŸ */
        .players-area {
            position: absolute;
            top: 100px;
            left: 20px;
            right: 20px;
            bottom: 200px;
        }

        .player {
            position: absolute;
            width: 120px;
            height: 80px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: 3px solid #fff;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            transition: all 0.5s ease;
            cursor: pointer;
        }

        .player.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .player.ai {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .player-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-stats {
            font-size: 10px;
            display: flex;
            justify-content: space-between;
        }

        .player-cards {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }

        .card-mini {
            width: 15px;
            height: 20px;
            background: #ffd700;
            border-radius: 2px;
            border: 1px solid #fff;
        }

        /* ç©å®¶ä½ç½® */
        .player-1 { top: 10%; left: 40%; }
        .player-2 { top: 20%; right: 10%; }
        .player-3 { bottom: 20%; right: 10%; }
        .player-4 { bottom: 10%; left: 40%; }

        /* ä¸­å¤®åŒºåŸŸ */
        .center-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .deck, .discard {
            width: 80px;
            height: 120px;
            border: 2px solid #fff;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .deck {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
        }

        .discard {
            background: linear-gradient(45deg, #34495e, #2c3e50);
        }

        .deck:hover, .discard:hover {
            transform: scale(1.05);
        }

        .current-card {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 140px;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            border: 3px solid #fff;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 10;
        }

        .current-card.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
        }

        /* å­£èŠ‚æŒ‡ç¤ºå™¨ */
        .season-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 15px 30px;
            border-radius: 20px;
            border: 2px solid #ffd700;
            text-align: center;
        }

        .season-name {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .season-effect {
            font-size: 12px;
            color: #ccc;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .control-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }

        /* ä¿¡æ¯é¢æ¿æ ·å¼ */
        .info-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 4px solid #ffd700;
        }

        .info-title {
            color: #ffd700;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .info-content {
            font-size: 14px;
            line-height: 1.5;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            border-left: 3px solid #3498db;
            font-size: 12px;
        }

        .log-entry.action {
            border-left-color: #e74c3c;
        }

        .log-entry.system {
            border-left-color: #f39c12;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        @keyframes cardDraw {
            0% { transform: translate(-50%, -50%) scale(0) rotate(180deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5) rotate(90deg); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .game-area {
                flex-direction: column;
                height: auto;
            }
            
            .game-board {
                height: 600px;
                margin-bottom: 20px;
            }
            
            .info-panel {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="simulation-container">
        <div class="header">
            <h1 class="title">å¤©æœºå˜ - æ¸¸æˆè¿‡ç¨‹æ¨¡æ‹Ÿ</h1>
            <p class="subtitle">è§‚çœ‹å®Œæ•´çš„æ¸¸æˆæµç¨‹æ¼”ç¤ºï¼Œæ·±å…¥ç†è§£æ¸¸æˆæœºåˆ¶</p>
        </div>

        <div class="game-area">
            <div class="game-board">
                <!-- æ¸¸æˆçŠ¶æ€ -->
                <div class="game-status">
                    <div class="status-item">
                        <div class="status-label">å›åˆæ•°</div>
                        <div class="status-value" id="turn-count">1</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">å½“å‰ç©å®¶</div>
                        <div class="status-value" id="current-player">ç©å®¶1</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">å‰©ä½™å¡ç‰Œ</div>
                        <div class="status-value" id="deck-count">52</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">æ¸¸æˆé˜¶æ®µ</div>
                        <div class="status-value" id="game-phase">æŠ½ç‰Œé˜¶æ®µ</div>
                    </div>
                </div>

                <!-- ç©å®¶åŒºåŸŸ -->
                <div class="players-area">
                    <div class="player player-1 active" id="player-1">
                        <div class="player-name">ç©å®¶1</div>
                        <div class="player-stats">
                            <span>æ°”: <span id="p1-qi">6</span></span>
                            <span>é“: <span id="p1-dao">0</span></span>
                        </div>
                        <div class="player-cards">
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                        </div>
                    </div>

                    <div class="player player-2 ai" id="player-2">
                        <div class="player-name">AI-æ™ºè€…</div>
                        <div class="player-stats">
                            <span>æ°”: <span id="p2-qi">6</span></span>
                            <span>é“: <span id="p2-dao">0</span></span>
                        </div>
                        <div class="player-cards">
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                        </div>
                    </div>

                    <div class="player player-3 ai" id="player-3">
                        <div class="player-name">AI-è´¤äºº</div>
                        <div class="player-stats">
                            <span>æ°”: <span id="p3-qi">6</span></span>
                            <span>é“: <span id="p3-dao">0</span></span>
                        </div>
                        <div class="player-cards">
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                        </div>
                    </div>

                    <div class="player player-4 ai" id="player-4">
                        <div class="player-name">AI-å­¦è€…</div>
                        <div class="player-stats">
                            <span>æ°”: <span id="p4-qi">6</span></span>
                            <span>é“: <span id="p4-dao">0</span></span>
                        </div>
                        <div class="player-cards">
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                            <div class="card-mini"></div>
                        </div>
                    </div>
                </div>

                <!-- ä¸­å¤®åŒºåŸŸ -->
                <div class="center-area">
                    <div class="deck" id="deck" title="ç‚¹å‡»æŠ½ç‰Œ">
                        <div>ç‰Œå †</div>
                        <div id="deck-count-display">52å¼ </div>
                    </div>

                    <div class="current-card" id="current-card">
                        <div id="card-name">ä¹¾å¦</div>
                        <div id="card-cost">æ¶ˆè€—: 3æ°”</div>
                        <div id="card-reward">å¥–åŠ±: 2é“è¡Œ</div>
                    </div>

                    <div class="discard" id="discard" title="å¼ƒç‰Œå †">
                        <div>å¼ƒç‰Œ</div>
                        <div id="discard-count-display">0å¼ </div>
                    </div>
                </div>

                <!-- å­£èŠ‚æŒ‡ç¤ºå™¨ -->
                <div class="season-indicator">
                    <div class="season-name" id="season-name">æ˜¥å­£ ğŸŒ¸</div>
                    <div class="season-effect" id="season-effect">ä¸‡ç‰©å¤è‹ï¼Œæ°”æ¢å¤+1</div>
                </div>

                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="controls">
                    <button class="control-btn" id="auto-play" onclick="toggleAutoPlay()">å¼€å§‹è‡ªåŠ¨æ¼”ç¤º</button>
                    <button class="control-btn" id="next-step" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
                    <button class="control-btn" onclick="resetSimulation()">é‡æ–°å¼€å§‹</button>
                    <button class="control-btn" onclick="skipToEnd()">è·³åˆ°ç»“æŸ</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-section">
                    <div class="info-title">ğŸ® å½“å‰çŠ¶æ€</div>
                    <div class="info-content" id="current-status">
                        æ¸¸æˆå¼€å§‹ï¼Œç©å®¶1çš„å›åˆã€‚ç‚¹å‡»"å¼€å§‹è‡ªåŠ¨æ¼”ç¤º"è§‚çœ‹å®Œæ•´æ¸¸æˆæµç¨‹ã€‚
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-title">ğŸ“‹ æ¸¸æˆæ—¥å¿—</div>
                    <div class="info-content" id="game-log">
                        <div class="log-entry system">æ¸¸æˆå¼€å§‹ï¼Œ4åç©å®¶å‚ä¸</div>
                        <div class="log-entry system">åˆå§‹èµ„æºï¼šæ¯äºº6ç‚¹æ°”ï¼Œ0ç‚¹é“è¡Œ</div>
                        <div class="log-entry system">å½“å‰å­£èŠ‚ï¼šæ˜¥å­£ï¼Œæ°”æ¢å¤+1</div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-title">ğŸƒ å¡ç‰Œè¯´æ˜</div>
                    <div class="info-content" id="card-explanation">
                        é€‰æ‹©æˆ–æŠ½å–å¡ç‰Œåï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„å¡ç‰Œè¯´æ˜å’Œæ•ˆæœã€‚
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-title">ğŸ“Š æ¸¸æˆç»Ÿè®¡</div>
                    <div class="info-content" id="game-stats">
                        <div>æ€»å›åˆæ•°: <span id="total-turns">0</span></div>
                        <div>å·²ä½¿ç”¨å¡ç‰Œ: <span id="cards-played">0</span></div>
                        <div>é¢†å…ˆç©å®¶: <span id="leading-player">æš‚æ— </span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentPlayer: 0,
            turn: 1,
            phase: 'draw', // draw, action, end
            deckCount: 52,
            discardCount: 0,
            season: 0,
            autoPlay: false,
            players: [
                { name: 'ç©å®¶1', qi: 6, dao: 0, cards: 5, isAI: false },
                { name: 'AI-æ™ºè€…', qi: 6, dao: 0, cards: 5, isAI: true },
                { name: 'AI-è´¤äºº', qi: 6, dao: 0, cards: 5, isAI: true },
                { name: 'AI-å­¦è€…', qi: 6, dao: 0, cards: 5, isAI: true }
            ]
        };

        // å¡ç‰Œæ•°æ®
        const cards = [
            { name: 'ä¹¾å¦', cost: 3, reward: 2, effect: 'å¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯' },
            { name: 'å¤å¦', cost: 2, reward: 3, effect: 'åœ°åŠ¿å¤ï¼Œå›å­ä»¥åšå¾·è½½ç‰©' },
            { name: 'éœ‡å¦', cost: 4, reward: 1, effect: 'é›·å£°éœ‡éœ‡ï¼Œå¯å‘æ™ºæ…§' },
            { name: 'å·½å¦', cost: 2, reward: 2, effect: 'é£è¡Œå¤©ä¸‹ï¼Œä¼ æ’­é“ç†' },
            { name: 'åå¦', cost: 3, reward: 2, effect: 'æ°´æµä¸æ¯ï¼Œå…‹æœå›°éš¾' },
            { name: 'ç¦»å¦', cost: 3, reward: 3, effect: 'ç«å…‰æ˜äº®ï¼Œç…§äº®å‰è·¯' },
            { name: 'è‰®å¦', cost: 2, reward: 1, effect: 'å±±å²³ç¨³é‡ï¼ŒåšæŒä¸æ‡ˆ' },
            { name: 'å…‘å¦', cost: 1, reward: 2, effect: 'æ³½æ¶¦ä¸‡ç‰©ï¼Œå’Œè°å…±å¤„' }
        ];

        // å­£èŠ‚æ•°æ®
        const seasons = [
            { name: 'æ˜¥å­£ ğŸŒ¸', effect: 'ä¸‡ç‰©å¤è‹ï¼Œæ°”æ¢å¤+1' },
            { name: 'å¤å­£ â˜€ï¸', effect: 'é˜³æ°”æ—ºç››ï¼Œæ”»å‡»æ•ˆæœ+1' },
            { name: 'ç§‹å­£ ğŸ‚', effect: 'æ”¶è·å­£èŠ‚ï¼Œé“è¡Œè·å¾—+1' },
            { name: 'å†¬å­£ â„ï¸', effect: 'è›°ä¼æœŸé—´ï¼Œæ‰‹ç‰Œä¸Šé™+1' }
        ];

        let autoPlayInterval;
        let stepCount = 0;

        // åˆå§‹åŒ–
        function init() {
            updateDisplay();
            addLog('system', 'æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼Œå‡†å¤‡å¼€å§‹');
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ›´æ–°çŠ¶æ€æ 
            document.getElementById('turn-count').textContent = gameState.turn;
            document.getElementById('current-player').textContent = gameState.players[gameState.currentPlayer].name;
            document.getElementById('deck-count').textContent = gameState.deckCount;
            document.getElementById('deck-count-display').textContent = gameState.deckCount + 'å¼ ';
            document.getElementById('discard-count-display').textContent = gameState.discardCount + 'å¼ ';
            
            // æ›´æ–°é˜¶æ®µ
            const phases = { draw: 'æŠ½ç‰Œé˜¶æ®µ', action: 'è¡ŒåŠ¨é˜¶æ®µ', end: 'ç»“æŸé˜¶æ®µ' };
            document.getElementById('game-phase').textContent = phases[gameState.phase];

            // æ›´æ–°ç©å®¶çŠ¶æ€
            gameState.players.forEach((player, index) => {
                const playerElement = document.getElementById(`player-${index + 1}`);
                playerElement.classList.toggle('active', index === gameState.currentPlayer);
                
                document.getElementById(`p${index + 1}-qi`).textContent = player.qi;
                document.getElementById(`p${index + 1}-dao`).textContent = player.dao;
                
                // æ›´æ–°æ‰‹ç‰Œæ˜¾ç¤º
                const cardsContainer = playerElement.querySelector('.player-cards');
                cardsContainer.innerHTML = '';
                for (let i = 0; i < player.cards; i++) {
                    const cardMini = document.createElement('div');
                    cardMini.className = 'card-mini';
                    cardsContainer.appendChild(cardMini);
                }
            });

            // æ›´æ–°å­£èŠ‚
            const season = seasons[gameState.season];
            document.getElementById('season-name').textContent = season.name;
            document.getElementById('season-effect').textContent = season.effect;

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('total-turns').textContent = Math.floor(stepCount / 4);
            document.getElementById('cards-played').textContent = 52 - gameState.deckCount;
            
            const leadingPlayer = gameState.players.reduce((max, player) => 
                player.dao > max.dao ? player : max
            );
            document.getElementById('leading-player').textContent = leadingPlayer.dao > 0 ? leadingPlayer.name : 'æš‚æ— ';
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(type, message) {
            const logContainer = document.getElementById('game-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type} fade-in`;
            logEntry.textContent = message;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            if (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // æ˜¾ç¤ºå¡ç‰Œ
        function showCard(card) {
            const cardElement = document.getElementById('current-card');
            document.getElementById('card-name').textContent = card.name;
            document.getElementById('card-cost').textContent = `æ¶ˆè€—: ${card.cost}æ°”`;
            document.getElementById('card-reward').textContent = `å¥–åŠ±: ${card.reward}é“è¡Œ`;
            
            cardElement.classList.add('show');
            cardElement.style.animation = 'cardDraw 1s ease';
            
            // æ›´æ–°å¡ç‰Œè¯´æ˜
            document.getElementById('card-explanation').innerHTML = `
                <strong>${card.name}</strong><br>
                æ¶ˆè€—æ°”å€¼: ${card.cost}<br>
                è·å¾—é“è¡Œ: ${card.reward}<br>
                æ•ˆæœ: ${card.effect}
            `;
            
            setTimeout(() => {
                cardElement.classList.remove('show');
                cardElement.style.animation = '';
            }, 3000);
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            stepCount++;
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            switch (gameState.phase) {
                case 'draw':
                    // æŠ½ç‰Œé˜¶æ®µ
                    if (gameState.deckCount > 0) {
                        const card = cards[Math.floor(Math.random() * cards.length)];
                        showCard(card);
                        gameState.deckCount--;
                        currentPlayer.cards++;
                        addLog('action', `${currentPlayer.name} æŠ½å–äº† ${card.name}`);
                        
                        // å­£èŠ‚æ•ˆæœï¼šæ˜¥å­£æ°”æ¢å¤+1
                        if (gameState.season === 0) {
                            currentPlayer.qi = Math.min(currentPlayer.qi + 1, 10);
                            addLog('system', `æ˜¥å­£æ•ˆæœï¼š${currentPlayer.name} æ¢å¤1ç‚¹æ°”`);
                        }
                    }
                    gameState.phase = 'action';
                    break;
                    
                case 'action':
                    // è¡ŒåŠ¨é˜¶æ®µ
                    if (currentPlayer.isAI) {
                        // AIè¡ŒåŠ¨é€»è¾‘
                        if (currentPlayer.qi >= 2 && Math.random() > 0.3) {
                            const card = cards[Math.floor(Math.random() * cards.length)];
                            if (currentPlayer.qi >= card.cost) {
                                currentPlayer.qi -= card.cost;
                                let daoGain = card.reward;
                                
                                // ç§‹å­£æ•ˆæœï¼šé“è¡Œè·å¾—+1
                                if (gameState.season === 2) {
                                    daoGain += 1;
                                    addLog('system', `ç§‹å­£æ•ˆæœï¼šé“è¡Œè·å¾—+1`);
                                }
                                
                                currentPlayer.dao += daoGain;
                                currentPlayer.cards--;
                                gameState.discardCount++;
                                addLog('action', `${currentPlayer.name} ä½¿ç”¨äº† ${card.name}ï¼Œè·å¾—${daoGain}ç‚¹é“è¡Œ`);
                                showCard(card);
                            } else {
                                addLog('action', `${currentPlayer.name} æ°”ä¸è¶³ï¼Œé€‰æ‹©å†¥æƒ³æ¢å¤æ°”å€¼`);
                                currentPlayer.qi = Math.min(currentPlayer.qi + 2, 10);
                            }
                        } else {
                            addLog('action', `${currentPlayer.name} é€‰æ‹©å†¥æƒ³ï¼Œæ¢å¤2ç‚¹æ°”`);
                            currentPlayer.qi = Math.min(currentPlayer.qi + 2, 10);
                        }
                    } else {
                        // ç©å®¶è¡ŒåŠ¨ï¼ˆæ¨¡æ‹Ÿï¼‰
                        if (Math.random() > 0.5) {
                            const card = cards[Math.floor(Math.random() * cards.length)];
                            if (currentPlayer.qi >= card.cost) {
                                currentPlayer.qi -= card.cost;
                                let daoGain = card.reward;
                                
                                if (gameState.season === 2) {
                                    daoGain += 1;
                                }
                                
                                currentPlayer.dao += daoGain;
                                currentPlayer.cards--;
                                gameState.discardCount++;
                                addLog('action', `${currentPlayer.name} ä½¿ç”¨äº† ${card.name}ï¼Œè·å¾—${daoGain}ç‚¹é“è¡Œ`);
                                showCard(card);
                            } else {
                                addLog('action', `${currentPlayer.name} æ°”ä¸è¶³ï¼Œå†¥æƒ³æ¢å¤æ°”å€¼`);
                                currentPlayer.qi = Math.min(currentPlayer.qi + 2, 10);
                            }
                        } else {
                            addLog('action', `${currentPlayer.name} é€‰æ‹©å†¥æƒ³ï¼Œæ¢å¤2ç‚¹æ°”`);
                            currentPlayer.qi = Math.min(currentPlayer.qi + 2, 10);
                        }
                    }
                    gameState.phase = 'end';
                    break;
                    
                case 'end':
                    // ç»“æŸé˜¶æ®µ
                    gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;
                    if (gameState.currentPlayer === 0) {
                        gameState.turn++;
                        // æ¯4å›åˆæ¢å­£èŠ‚
                        if (gameState.turn % 4 === 1) {
                            gameState.season = (gameState.season + 1) % 4;
                            addLog('system', `å­£èŠ‚å˜åŒ–ï¼š${seasons[gameState.season].name}`);
                        }
                    }
                    gameState.phase = 'draw';
                    
                    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
                    const winner = gameState.players.find(p => p.dao >= 20);
                    if (winner || gameState.deckCount <= 0 || gameState.turn > 20) {
                        endGame(winner);
                        return;
                    }
                    break;
            }
            
            updateDisplay();
            updateCurrentStatus();
        }

        // æ›´æ–°å½“å‰çŠ¶æ€è¯´æ˜
        function updateCurrentStatus() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const phaseTexts = {
                draw: `${currentPlayer.name} çš„æŠ½ç‰Œé˜¶æ®µï¼Œå‡†å¤‡æŠ½å–æ–°å¡ç‰Œ`,
                action: `${currentPlayer.name} çš„è¡ŒåŠ¨é˜¶æ®µï¼Œå¯ä»¥ä½¿ç”¨å¡ç‰Œæˆ–å†¥æƒ³`,
                end: `${currentPlayer.name} çš„å›åˆç»“æŸï¼Œå‡†å¤‡åˆ‡æ¢åˆ°ä¸‹ä¸€ä½ç©å®¶`
            };
            
            document.getElementById('current-status').textContent = phaseTexts[gameState.phase];
        }

        // ç»“æŸæ¸¸æˆ
        function endGame(winner) {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                gameState.autoPlay = false;
                document.getElementById('auto-play').textContent = 'å¼€å§‹è‡ªåŠ¨æ¼”ç¤º';
            }
            
            if (winner) {
                addLog('system', `ğŸ‰ æ¸¸æˆç»“æŸï¼${winner.name} è·å¾—èƒœåˆ©ï¼é“è¡Œ: ${winner.dao}`);
                document.getElementById('current-status').textContent = `æ¸¸æˆç»“æŸï¼${winner.name} è·å¾—èƒœåˆ©ï¼`;
            } else if (gameState.deckCount <= 0) {
                const topPlayer = gameState.players.reduce((max, player) => 
                    player.dao > max.dao ? player : max
                );
                addLog('system', `ğŸ‰ å¡ç‰Œç”¨å°½ï¼${topPlayer.name} ä»¥${topPlayer.dao}ç‚¹é“è¡Œè·èƒœï¼`);
                document.getElementById('current-status').textContent = `å¡ç‰Œç”¨å°½ï¼${topPlayer.name} è·èƒœï¼`;
            } else {
                const topPlayer = gameState.players.reduce((max, player) => 
                    player.dao > max.dao ? player : max
                );
                addLog('system', `ğŸ‰ è¾¾åˆ°å›åˆé™åˆ¶ï¼${topPlayer.name} ä»¥${topPlayer.dao}ç‚¹é“è¡Œè·èƒœï¼`);
                document.getElementById('current-status').textContent = `è¾¾åˆ°å›åˆé™åˆ¶ï¼${topPlayer.name} è·èƒœï¼`;
            }
            
            document.getElementById('next-step').disabled = true;
        }

        // è‡ªåŠ¨æ¼”ç¤º
        function toggleAutoPlay() {
            gameState.autoPlay = !gameState.autoPlay;
            const button = document.getElementById('auto-play');
            
            if (gameState.autoPlay) {
                button.textContent = 'æš‚åœæ¼”ç¤º';
                autoPlayInterval = setInterval(nextStep, 2000);
                document.getElementById('next-step').disabled = true;
            } else {
                button.textContent = 'å¼€å§‹è‡ªåŠ¨æ¼”ç¤º';
                clearInterval(autoPlayInterval);
                document.getElementById('next-step').disabled = false;
            }
        }

        // é‡ç½®æ¨¡æ‹Ÿ
        function resetSimulation() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
            }
            
            gameState = {
                currentPlayer: 0,
                turn: 1,
                phase: 'draw',
                deckCount: 52,
                discardCount: 0,
                season: 0,
                autoPlay: false,
                players: [
                    { name: 'ç©å®¶1', qi: 6, dao: 0, cards: 5, isAI: false },
                    { name: 'AI-æ™ºè€…', qi: 6, dao: 0, cards: 5, isAI: true },
                    { name: 'AI-è´¤äºº', qi: 6, dao: 0, cards: 5, isAI: true },
                    { name: 'AI-å­¦è€…', qi: 6, dao: 0, cards: 5, isAI: true }
                ]
            };
            
            stepCount = 0;
            document.getElementById('auto-play').textContent = 'å¼€å§‹è‡ªåŠ¨æ¼”ç¤º';
            document.getElementById('next-step').disabled = false;
            document.getElementById('game-log').innerHTML = `
                <div class="log-entry system">æ¸¸æˆé‡æ–°å¼€å§‹ï¼Œ4åç©å®¶å‚ä¸</div>
                <div class="log-entry system">åˆå§‹èµ„æºï¼šæ¯äºº6ç‚¹æ°”ï¼Œ0ç‚¹é“è¡Œ</div>
                <div class="log-entry system">å½“å‰å­£èŠ‚ï¼šæ˜¥å­£ï¼Œæ°”æ¢å¤+1</div>
            `;
            
            updateDisplay();
            updateCurrentStatus();
        }

        // è·³åˆ°ç»“æŸ
        function skipToEnd() {
            // å¿«é€Ÿæ¨¡æ‹Ÿåˆ°æ¸¸æˆç»“æŸ
            while (gameState.deckCount > 0 && gameState.turn <= 20) {
                const winner = gameState.players.find(p => p.dao >= 20);
                if (winner) break;
                
                // å¿«é€Ÿæ‰§è¡Œæ­¥éª¤
                const currentPlayer = gameState.players[gameState.currentPlayer];
                
                if (gameState.phase === 'draw') {
                    gameState.deckCount--;
                    currentPlayer.cards++;
                    if (gameState.season === 0) {
                        currentPlayer.qi = Math.min(currentPlayer.qi + 1, 10);
                    }
                    gameState.phase = 'action';
                } else if (gameState.phase === 'action') {
                    if (currentPlayer.qi >= 3) {
                        const card = cards[Math.floor(Math.random() * cards.length)];
                        currentPlayer.qi -= card.cost;
                        let daoGain = card.reward;
                        if (gameState.season === 2) daoGain += 1;
                        currentPlayer.dao += daoGain;
                        currentPlayer.cards--;
                        gameState.discardCount++;
                    } else {
                        currentPlayer.qi = Math.min(currentPlayer.qi + 2, 10);
                    }
                    gameState.phase = 'end';
                } else {
                    gameState.currentPlayer = (gameState.currentPlayer + 1) % 4;
                    if (gameState.currentPlayer === 0) {
                        gameState.turn++;
                        if (gameState.turn % 4 === 1) {
                            gameState.season = (gameState.season + 1) % 4;
                        }
                    }
                    gameState.phase = 'draw';
                }
            }
            
            const winner = gameState.players.find(p => p.dao >= 20);
            updateDisplay();
            endGame(winner);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        init();
    </script>
</body>
</html>